# AliceLM 1204PLAN（Alice One 能力蓝图）

> 版本：v1.0  
> 日期：2024-12-04  
> 作用：作为 AliceLM / Alice One 的**核心产品与技术蓝图**，给 DESIGN / ROADMAP 提供上位约束。

---

## 1. 总体目标

- 从「视频批处理工具」升级为「**Alice One：一个统一人格、跨入口、长记忆的学习伙伴**」。
- 能持续理解同一个用户 / 团队在看什么、关心什么、如何提问，给出稳定、可追溯、可进化的支持。
- 架构上：在现有多租户 + Pipeline 基础上，增加三层：
  - **知识与信息底座（Knowledge & Information Base）**
  - **Agent Brain（推理 + 工具调用）**
  - **Alice One 层（Persona + Timeline + Context）**

本 PLAN 只做「能力树 + Level 演进」规划，不落到具体 Sprint 任务；具体实现节奏由 `docs/ROADMAP.md` 负责。

---

## 2. 能力树

### 2.1 知识与信息底座（Knowledge & Information Base）

**目标：** 用尽可能简单的技术栈，支撑 Alice One 所需的全部「原始事实」：视频、转写、向量、图谱、时间线事件。

#### 2.1.1 视频与转写管道

- Watcher：监控收藏夹 / 列表 / 订阅源，发现新视频。
- Processor：下载 → 抽音频 → ASR → 存转写 → 调用 AI 生成摘要 / 关键点 / 概念 → 向量化入库。
- 多租户：所有业务表带 `tenant_id`，通过中间件自动注入查询条件。

#### 2.1.2 结构化数据库

- 关系模型（与 DESIGN 对齐）：
  - Tenant / TenantConfig / User（多租户 + 用户体系）
  - Video / Tag / VideoTag / WatchedFolder
  - LearningRecord（将演化为 TimelineEvent）
- 存储：开发用 SQLite，生产用 PostgreSQL。

#### 2.1.3 向量与知识检索

- ChromaDB 作为默认向量存储；可替换为 Qdrant/Milvus。
- RAGFlow 作为托管知识库：负责多格式解析、分块、Embedding、检索；AliceLM 提供轻量客户端封装。
- 检索能力：
  - 单视频内语义检索（基于 TranscriptChunk）。
  - 跨视频语义检索（向量 + 元数据过滤）。
  - 概念级检索（基于「概念向量集合」）。

#### 2.1.4 图谱与关系

- 基于关系型表 + 向量库的「轻量图谱」：
  - 概念节点：name / description / embedding / related_videos。
  - 边关系：概念-视频、概念-概念、概念-标签等。
- 不引入 Neo4j，避免过度复杂的数据面；图谱存储复用现有 DB + Chroma 元数据。

---

### 2.2 Alice One 层（Persona + Timeline + Context）

**目标：** 在统一的时间线和配置之上，塑造一个「可解释、一致的 Alice One 人格」，对所有入口暴露相同语义。

#### 2.2.1 数据视图

- **TenantProfile（逻辑视图）**
  - 来源：Tenant + TenantConfig 中 `alice.*` 命名空间（persona、工具集、偏好等）。
  - 不单独建表，而是服务层组合视图。

- **TimelineEvent（统一时间线）**
  - 由 LearningRecord 演化：增加 `event_type` / `scene` / `context(JSON)` 字段。
  - 表示「某时间点 Alice / 用户发生的一件事」，例如：
    - watch_video / ask_question / insight / highlight / plan_created ...
    - scene: chat / library / video / graph / timeline / tasks / console。
  - 所有入口在关键动作后都通过 TimelineService 写入这里，形成单一事实时间线。

- **PersonaSnapshot（派生画像）**
  - 从 TimelineEvent + 视频/概念/对话中按时间窗口聚合：
    - 主题分布
    - 问题模式
    - 兴趣/观点变化
  - 初期实时计算，后续可落缓存表，明确为物化视图。

#### 2.2.2 三大服务

- AliceIdentityService
  - 输入：tenant_id / user_id? / scene。
  - 输出：system_prompt / tool_scopes / settings / tenant_profile。

- TimelineService
  - append_event / query / summarize，统一管理 TimelineEvent 与 PersonaSnapshot。

- ContextAssembler
  - 输入：AgentTask（tenant/user/scene/query/video_id/selection/extra_context）。
  - 从对话、向量检索、图谱、PersonaSnapshot 汇总上下文，生成：
    - messages（给 LLM/Agent）
    - citations（给前端展示）。

---

### 2.3 Agent Brain（推理 + 工具调用）

**目标：** 在 Alice One 层之上，通过可观测的 ReAct 循环 + 语义化工具集合，让 Alice 能真正「思考和调用能力」，而不是一次性 RAG 问答。

#### 2.3.1 统一任务模型：AgentTask

- 所有入口统一构造 AgentTask：
  - 必填：tenant_id / scene / query。
  - 可选：user_id / video_id / selection / extra_context。
- AgentTask 是 Alice One / Agent Brain 的唯一入口契约。

#### 2.3.2 Agent 执行模型

- 核心对象：
  - AgentStep：每一步 thought + tool 调用 + observation。
  - AgentResult：answer + citations + steps。
  - AgentRun：一次完整执行的持久化记录（用于回放与评估）。

- 执行策略：
  - 使用 OpenAI Function Calling 作为工具调用协议。
  - AgentOrchestrator 运行单 Agent ReAct 循环：
    - LLM 输出 thought + function_call → ToolsRegistry 执行 → observation → 继续。
  - 设置 MAX_STEPS + per-run timeout，保证可控性。

#### 2.3.3 ToolsRegistry 与 Provider 分层

- Tool：
  - 面向 Agent 暴露语义接口：search_videos / ask_video / search_graph / timeline_query ...
  - handler 内部只调用领域服务（ai/knowledge/timeline/...）。

- Provider：
  - 在 services/ai、services/asr 等层对接 OpenAI / Claude / DeepSeek / Whisper / RAGFlow ...
  - 通过 TenantConfig 选择具体 Provider，实现多租户差异化配置。

---

### 2.4 横切能力（Cross-cutting Capabilities）

**目标：** 为 Alice One 与 Agent Brain 提供稳定运行基础：多租户、权限、插件、可观测性与评估等。

#### 2.4.1 多租户与配置

- Tenant / TenantConfig / User / UserRole（owner/admin/member/viewer）。
- 租户上下文中间件（基于 contextvars），自动注入 tenant_id 查询条件。

#### 2.4.2 插件与外部集成

- 插件式 Provider（Source/ASR/LLM/Notify/Store/Export）。
- MCP Server：将 AliceLM 暴露为其它 Agent 的数据/工具源。

#### 2.4.3 可观测性与评估

- AgentRun：记录每次 Agent 执行的 steps / answer / tokens / 时间 / 错误等。
- EvalCase / EvalResult：用于回归测试与自动评估；未来由 Eval Console 展示。

#### 2.4.4 权限与协作（预留）

- 不在当前迭代实现细节，但在能力树中预留：
  - 租户内不同角色看到的工具集合不同（工具级权限）。
  - 共享 Board / Plan / Timeline 视图，实现团队协作。

---

## 3. Level 分层演进

### 3.1 Level 0：稳定底座（已完成为主）

- 视频管道：Watcher + Processor 全链路打通，支持 Bilibili 收藏夹 → 视频下载 → ASR → 摘要 → 向量化。
- 多租户：Tenant / User / TenantConfig 与租户上下文中间件可用。
- RAG 能力：
  - 单视频/跨视频 Q&A（固定 prompt + RAG 流程）。
  - RAGFlow 集成完成（或可用 Chroma fallback）。
- 前端：
  - Web UI 基础页面（Library / Video / 基本 Chat / Stats）。

### 3.2 Level 1：统一时间线 + 最小 Alice One

- LearningRecord 演化为 TimelineEvent 表，打通事件时间线：
  - 统一记录视频观看、提问、复习、导出等行为。
- 初版 Alice One：
  - TenantConfig 中增加 `alice.persona` / `alice.tools`，构造 TenantProfile。
  - AliceIdentityService + TimelineService v1 实现。
- 前端：
  - Timeline 基础视图（按时间展示事件）。

### 3.3 Level 2：Context-aware Alice One + 简化 Agent Brain

- ContextAssembler v1：
  - 基于 AgentTask，从对话/向量/图谱/时间线中组合上下文。
- AgentOrchestrator v1：
  - 自建简化 ReAct 循环，支持：
    - 对比两个视频。
    - 跨视频总结某概念。
- ToolsRegistry v1：
  - 统一工具定义 + OpenAI Function Calling 封装。
- AgentRun v1：
  - 每次执行记录 steps / answer / tokens / duration，支持基本回放。

### 3.4 Level 3：Eval / Console / 权限基础

- EvalCase / EvalResult v1：
  - 为典型场景（跨视频总结、对比视频、写学习报告）定义评测用例。
  - 定期运行回归评估，记录通过率/得分。
- Console（开发/运营视角）：
  - 展示 AgentRun 轨迹与 Eval 结果。
- 权限基础：
  - 不同 UserRole 拥有不同工具 scope（例如 viewer 不能修改配置，不能调用危险工具）。

### 3.5 Level 4：协作 / 插件生态（远期）

- 多人协作：
  - 共享 Plan / Board / Timeline 视图，支持多用户共同操作。
- 插件生态：
  - 对外公开 Tool 定义与 MCP 接入规范，让第三方可以为 Alice One 写工具。
  - 在 Console 中安装/配置插件。

---

## 4. 与代码结构的映射

> 这部分不重复 DESIGN.md 的细节，只给出 Layer → 目录 的宏观对应，方便导航。

- 知识与信息底座：
  - apps/api/（Routers + Services）
  - services/watcher, services/processor, services/asr, services/ai
  - packages/db, packages/rag, data/

- Alice One 层：
  - services/alice/（AliceIdentityService / TimelineService / ContextAssembler）
  - packages/db.models 中的 TenantConfig / LearningRecord（TimelineEvent 视图）。

- Agent Brain：
  - services/agent/（AgentOrchestrator / ToolsRegistry / tools/*）
  - packages/db.models 中的 AgentRun / EvalCase / EvalResult。

- 横切能力：
  - packages/config, packages/logging, packages/queue
  - services/mcp（对外 MCP Server）。

---

## 5. 与其他文档的关系

- **DESIGN.md**：
  - 1204PLAN → 设计；
  - DESIGN 负责把本 PLAN 中的能力 / Level 转化为具体架构与模块设计。

- **ALICE_VISION_ANALYSIS.md**：
  - 对 1204PLAN 的解构与补充说明，记录了为什么这样设计，以及和竞品/参考项目的对比。

- **AGENT_RESEARCH.md**：
  - 针对 Agent 相关项目（Gemini CLI / graph-rag-agent / OpenManus / SurfSense）的调研，
  - 为本 PLAN 中的 Agent Brain 设计提供参考与反例，指导我们采用「自建简化版」策略。

- **ROADMAP.md**：
  - 按 Phase/时间线组织具体实现路径，需基于本 PLAN 中的 Level 与能力树进行更新。

本文件始终作为「最上层能力蓝图」，当 DESIGN / ROADMAP 与本文件冲突时，
应优先更新下层文档，使其重新与 1204PLAN 对齐。

仔细查看下这个文档



功能思维导图（文字版）
技术架构图（带“大 Alice / 对话 Alice”）
前端 / 后端结构图




0. 先对齐一个核心抽象：
大 Alice vs 对话里的 Alice


大 Alice = 租户级人格 + 记忆 + 能力总线
对话 Alice = 在某个入口/页面里的“一次具体使用形态”

实现上可以这样理解：

每个 tenant_id 对应 唯一一个“大 Alice 实例”：

有自己的 persona / 偏好 / 全局设置；
有自己的知识库（视频、文档、图谱、时间线）；
有自己的插件、权限、Agent 能力开关。

每个对话窗口（Web / 微信 / MCP / 视频详情侧栏…）只是：

对这个“大 Alice”的一个 “视图 + 会话工作记忆”；
所有对话最终都往“大 Alice”的时间线 + 记忆里写。



也就是说：

永远只有一个 Alice，UI 里出现的是她的不同“面具”和“工作模式”。

下面所有设计，都围绕这个前提来想。



1. 能力视角：这 10 个点，如何组合成一个完整能力树


你提到的“5 个主干 + 另外 5 个（可观测/评测/权限/扩展/协作）”，我把它们合在一张能力树里：


1.1 知识 & 信息底座（SurfSense + graph-rag-agent）


**目标：**让 Alice 拥有“世界观级”的记忆，而不仅是向量检索。

信息采集（SurfSense 风格）：

Source Connectors：Bilibili / YouTube / 本地文件 / Web / Podcast…
统一的 Ingestion Pipeline：解析 → 智能分块 → 嵌入 → 元数据入库。
RAGFlow 作为文档层知识库（你设计里已有，继续沿用）。

知识图谱（graph-rag-agent 风格）：

从转写/文档里抽取：

实体（人/项目/概念/工具…）
关系（引用/对立/演化/依赖…）

存在 knowledge_graph_nodes / edges 这样的结构表（或图数据库）。
提供统一接口：graph.search, graph.neighbors, graph.walk_path 等。



**作用：**支持“跨视频概念地图”“沿概念跳转”“多 hop 问答”。



1.2 Agent 大脑（OpenManus + Gemini CLI）


目标：让 Alice 会规划、多步推理、用工具，而不是一发 prompt 就完了。

Agent Orchestrator（核心）：

统一入口：AgentOrchestrator.run(task: AgentTask)；
内部支持：

Base LLM（直接生成）
ReAct（思考 → 行动 → 观察）
Tool Calling（Gemini CLI 风格 Function Calling 循环）
Planning（OpenManus 曰 Manus 层：拆子任务 / 编排多工具）。


工具层（Tools Registry）：

把现有服务封装成工具：

search_videos / get_video_detail / ask_video / compare_videos
search_graph / get_concept_map
search_ragflow / chat_ragflow
timeline.query / timeline.append_insight

每个工具有：

明确的输入 schema（JSON）
安全规则（权限 / 租户边界）
可观测日志。




**作用：**支持“复杂跨知识任务”，比如：

看 10 个视频做一份研究报告
找出你最近观念的变化
根据知识 + 你的状态帮你排学习/项目计划




1.3 大 Alice 层（租户共生 + 时间线）


**目标：**从“工具”升级成“长期陪伴者”。

Tenant Persona / User Persona：

TenantProfile：这个 tenant 想要什么样的 Alice（语气、领域、权限范畴）；
UserProfile：每个用户自己的偏好（节奏、关注主题、语言…）。

时间线 & 自我变化（你很在意的那块）：

user_timeline_events：

watch_video / ask_question / highlight / plan_created / plan_done…

定期生成 PersonaSnapshot：

某一段时间内的：主题分布 / 问题模式 / 观点变化；

Agent 工具：timeline.analyze_change(user_id)：

用来支持“你最近在变什么”的主动对话 & 页面。




作用：让所有入口看到的都是“同一个 Alice”，并且她记得你在变什么。



1.4 横切能力：可观测 / 评测 / 权限 / 扩展 / 协作


1）可观测性 & 调试（Dev 向）：

agent_runs：

每次 LLM 调用 / 工具调用 / 中间 reasoning 记录；

Dev Console 页面：

可以看到某个回答背后的“执行轨迹”（类似 LangGraph 画出来的 DAG）；

对话 UI：给用户一个简化版：“本次回答使用了：xx 视频 / xx 工具 / xx 概念”。


2）评测体系：

eval_cases：一组固定问题（跨视频 QA / 概念总结 / 对比…）；
eval_runs：每次改模型/改 prompt/改流程后自动跑一遍；
把“升级 Alice”变成可回归的工程，而不是玄学。


3）权限 & 安全：

工具级别 scope 定义：

只读知识 vs 写操作（改日历、发消息…）；

Tenant 级的白名单/黑名单工具集；
危险操作（删数据/对外发东西）强制“用户确认”。


4）扩展性（插件）：

外部开发者/你自己可以新增：

Source Provider（新的数据源）
Tool Provider（新的能力）

通过 manifest 注册，挂到 Tools Registry 里。


5）协作（多用户）：

支持：

tenant 层共享知识库/图谱；
用户层私有视图 + 可控共享；

将来：团队级 Alice vs 个人 Alice。




2. 大 Alice 和 对话 Alice：无缝的一条链路



2.1 数据/服务层分工


可以把“大 Alice”拆成三个服务视角：

AliceIdentityService（人格生成器）

输入：tenant_id, user_id
输出：

system prompt（Alice 的人格 + 当前角色）
可用工具列表（按权限过滤）
当前重要设置（语言、风格、简洁度…）


ContextAssembler（上下文装配器）

输入：task（chat / library / graph / timeline…）
输出：

本会话最近 N 条对话（短期记忆）
与当前场景相关的知识（视频 / graph / RAGFlow）
与当前用户/时间段相关的 snapshot（长期记忆精简版）


TimelineService（事件 & 自我变化）

对前端/Agent 暴露：

append_event(event)：记录你刚干的事；
query(user_id, filters)：时间线查询；
analyze_change(user_id, period)：分析变化（Agent 通过 tool 调用）。






2.2 一次“对话 Alice”的完整请求链（示意）

[前端对话窗口]  输入问题
       |
       v
[API Gateway + Auth]  注入 tenant_id / user_id / session_id
       |
       v
[Conversation API]
   1) 调 AliceIdentityService
   2) 调 ContextAssembler
       |
       v
[AgentOrchestrator.run(task)]
   - 用 Persona + Context 构造 messages
   - ReAct / Tools / Planning 循环
       |
       v
[Agent 输出答案]
   |
   +--> TimelineService.append_event()  # 记录“你问了什么/做了什么”
   +--> KnowledgeHub/GraphService 可选更新 insight
       |
       v
[前端展示]
   - 主回答
   - 引用的视频/片段/概念
   - （可选）简化版执行轨迹：本次用到啥
同一个 tenant 下：

Web 对话 / 微信 / 视频详情页侧栏 / Graph 页“问 Alice”按钮
→ 全部走同样的链，只是 task.scene 不同（chat/library/video/graph/timeline…）。


这样就保证：

不论你从哪里和她说话，她都是同一个 Alice，有同一套记忆与能力。



3. 具备这些能力后的“功能展现 & 前端调整”



3.1 功能思维导图（文字版）


用一个树结构看功能（已经假定这些能力都具备）：
Alice（租户级）

├─ 一、聊「世界」
│   ├─ 普通对话 / 提问
│   ├─ 跨视频 / 跨文档深度研究
│   │   ├─ 多视频对比
│   │   ├─ 某一概念的观点谱系
│   │   └─ 生成学习 / 调研报告
│   └─ 概念地图 & 知识图谱导航
│       ├─ 查看概念关系图
│       ├─ 从概念跳到所有相关片段
│       └─ 多 hop 问答（沿图谱推理）

├─ 二、聊「我自己」
│   ├─ 时间线（我看了/问了/标记了什么）
│   ├─ 自我变化分析
│   │   ├─ 兴趣/主题的变化
│   │   ├─ 观点的反转/演进
│   │   └─ 一直绕圈的问题
│   └─ 阶段性小复盘 / 给未来自己的信

├─ 三、一起「做事情」
│   ├─ 学习路径设计
│   ├─ 项目规划（比如做 Alice 产品）
│   ├─ 将知识转成 TODO / 日历（视权限）
│   └─ 长期目标跟踪（结合时间线）

├─ 四、知识管理（Library / Graph）
│   ├─ 视频库 / 文档库
│   ├─ 知识图谱可视化
│   └─ RAGFlow 知识库管理

└─ 五、开发者 & 运维视角
    ├─ Agent 运行日志 & 可视化轨迹
    ├─ 评测集 & 回归测试
    ├─ 插件管理（Source/Tool）
    └─ 权限 / 审计面板

3.2 前端结构：在现有 apps/web 上怎么改


你现在有：
apps/web/src/app/
├── page.tsx            # Landing
├── login/
├── register/
└── home/
    ├── page.tsx        # Dashboard + 对话
    ├── library/
    ├── video/[id]/
    ├── graph/
    └── settings/
我建议演化为（不改变技术栈，只是信息架构升级）：
/home/
├── page.tsx              # 「Alice Home」总览
│   - 顶部：与 Alice 的快速对话输入框
│   - 中部：最近 insight / 推荐行动 / 处理中的任务
│   - 侧边：时间线快照（你最近在关心什么）
│
├── chat/                 # 专注对话（原来的对话部分拆出）
│   └── page.tsx
│       - 左：会话列表（session）
│       - 中：对话区（支持工具调用、引用展示）
│       - 右：上下文面板
│           · 当前使用的视频/文档/概念
│           · 本轮 Agent 轨迹简略（dev 模式）
│
├── library/              # 知识库视图（视频/文档）
│   └── page.tsx
│       - 列表 + 筛选 + 「问 Alice 关于这些内容」入口
│
├── video/[id]/           # 视频详情
│   └── page.tsx
│       - 上：播放器 + 基本信息
│       - 中：摘要 / 要点 / 时间轴
│       - 右：“问 Alice 关于这个视频”的对话侧栏
│
├── graph/                # 知识图谱
│   └── page.tsx
│       - 概念网络可视化
│       - 点击节点：弹出 “与 Alice 聊这个概念”
│
├── timeline/             # 「我和 Alice 的时间线」
│   └── page.tsx
│       - 以时间轴展示：看过/问过/标记过的事件
│       - 顶部按钮：“让 Alice 总结我最近在变什么”
│
├── console/              # Dev Console（可选，只对自己开放）
│   └── page.tsx
│       - Agent run 列表 / 细节
│       - Eval 结果 / 回归历史
│
└── settings/
    └── page.tsx
        - 租户级 Alice Persona 设置
        - 插件/工具开关 & 权限
        - 模型/ASR/Embedding 配置
关键点：

所有这些页面上，右上角都是同一个 Alice 头像 + 名字 → 强化“大 Alice”感。
“chat / video / graph / timeline”的右侧都可以嵌统一的 对话侧栏：

同一个 session；
只是 scene 参数不同，后端 Agent 根据 scene 选不同 tool/上下文。





4. 技术架构图（融入大 Alice / Agent / 知识底座）



4.1 整体技术架构（逻辑层）

┌───────────────────────────────────────────────────────────────┐
│                           Clients                            │
│  Web UI  /  微信Bot  /  MCP  /  CLI  /  其它集成              │
└───────────────┬──────────────────────────────────────────────┘
                │ HTTP / WebSocket
                v
┌───────────────────────────────────────────────────────────────┐
│                    API Gateway + Auth                         │
│ - 认证 / 多租户鉴权                                          │
│ - 注入 tenant_id / user_id / session_id                      │
└───────────────┬──────────────────────────────────────────────┘
                v
┌───────────────────────────────────────────────────────────────┐
│                        Core Backend                           │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │  Conversation / Task API                               │  │
│  │  - /api/agent/chat                                     │  │
│  │  - /api/agent/task                                     │  │
│  └─────────────────────────────────────────────────────────┘  │
│               │                                                │
│               v                                                │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │      AliceIdentityService + ContextAssembler            │  │
│  │  - 生成 Persona / 可用工具列表                           │  │
│  │  - 组装：会话历史 + 知识上下文 + 时间线快照              │  │
│  └─────────────────────────────────────────────────────────┘  │
│               │                                                │
│               v                                                │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                  AgentOrchestrator                     │  │
│  │  - ReAct / Planning / Tool Calling 循环                │  │
│  │  - 调用 Tools Registry                                │  │
│  │  - 记录 AgentRun / ToolCall 日志                       │  │
│  └─────────────────────────────────────────────────────────┘  │
│               │                                                │
│               v                                                │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                  Domain Services                        │  │
│  │  - VideoService / Ingestion (SurfSense 风格)            │  │
│  │  - QAService / RAGFlowClient                            │  │
│  │  - GraphService (graph-rag-agent 风格)                  │  │
│  │  - TimelineService (用户时间线)                         │  │
│  │  - TenantProfileService / Settings                      │  │
│  │  - PluginRegistry / PermissionService                   │  │
│  └─────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────┘
                │
                v
┌───────────────────────────────────────────────────────────────┐
│                           Data Layer                          │
│  - Relational DB (多租户 schema: Tenant/User/Video/Events...) │
│  - Vector DB (chunks / semantic indexes)                      │
│  - Knowledge Graph Store (节点/边，或表结构)                  │
│  - File Storage (原视频/转写/中间文件)                        │
│  - RAGFlow (外部检索引擎)                                     │
│  - Logs / Eval Results / AgentRuns                            │
└───────────────────────────────────────────────────────────────┘



5. 前端 / 后端结构图（更贴工程）



5.1 前端模块 vs 后端接口

前端 (Next.js App Router)
────────────────────────────────────────
/home/page.tsx
    - 调 /api/home/overview
    - 拉 recent_insights / tasks / snapshots

/home/chat/page.tsx
    - 调 /api/agent/chat (stream)
    - 调 /api/conversation/list
    - 右侧上下文面板调 /api/context/current

/home/library/page.tsx
    - 调 /api/videos/list
    - 选视频后，调 /api/agent/task (scene=library)

/home/video/[id]/page.tsx
    - 调 /api/videos/detail
    - 右侧对话调 /api/agent/chat (scene=video, video_id)

/home/graph/page.tsx
    - 调 /api/graph/overview
    - 节点点击 → /api/agent/chat (scene=graph, concept)

/home/timeline/page.tsx
    - 调 /api/timeline/events
    - 「总结我最近在变什么」→ /api/agent/task (scene=timeline)

/home/console/page.tsx
    - 调 /api/admin/agent_runs, /api/admin/evals
后端可以保持 monorepo 的 packages 结构，在现有基础上新增几个核心模块：
packages/
├── api/                # FastAPI 路由
│   ├── routes/agent.py           # /api/agent/*
│   ├── routes/home.py            # /api/home/*
│   ├── routes/graph.py           # /api/graph/*
│   ├── routes/timeline.py        # /api/timeline/*
│   └── routes/admin.py           # /api/admin/*
│
├── services/
│   ├── agent/AgentOrchestrator.py
│   ├── alice/IdentityService.py
│   ├── alice/ContextAssembler.py
│   ├── alice/TimelineService.py
│   ├── knowledge/VideoService.py      # 现有+抽象
│   ├── knowledge/GraphService.py
│   ├── knowledge/RAGFlowClient.py
│   ├── eval/EvalService.py
│   └── plugins/PluginRegistry.py
│
├── db/
│   ├── models/tenant.py / user.py / video.py
│   ├── models/transcript_chunk.py
│   ├── models/graph_node.py / graph_edge.py
│   ├── models/timeline_event.py / persona_snapshot.py
│   └── models/agent_run.py / eval_case.py / eval_result.py
│
└── workers/
    ├── ingestion_worker.py     # SurfSense 风格 pipeline
    ├── graph_build_worker.py   # 知识图谱构建
    └── eval_worker.py          # 定期跑评测



6. “进步规划”：不是按时间，而是按能力层级


既然你不想分近期/远期，我们就按依赖关系来分层：


Level 0：你现在已有的（简要）


多租户后端 + 视频处理 pipeline + RAGFlow 集成基础；
基础 QAService（固定 RAG 流程）；
基础知识图谱（概念提取 + 简单可视化）；
Web + 微信 + MCP 多入口。



Level 1：打通“大 Alice”骨架


加上：

TenantProfile / UserProfile / Persona 配置；
TimelineEvent + PersonaSnapshot 基本表结构与服务；
AliceIdentityService（统一 persona 生成）；
ContextAssembler（把“会话 + 知识 + 时间线”组装在一起）；

前端：

home/page.tsx 做成 “Alice Home”；
timeline/page.tsx 初版；
所有对话请求都带上 scene / tenant_id / user_id。



**结果：**你已经有了完整意义上的“大 Alice”，对话只是视图。


Level 2：Agent 化 & 知识底座升级


AgentOrchestrator + Tools Registry（参考 OpenManus + Gemini CLI）；
Ingestion 流重构为 SurfSense 风格节点（便于加其它源）；
GraphService 升级，支持：

概念→相关片段；
多 hop 查询；

前端：

chat 页右侧上下文面板；
graph 页支持“和 Alice 聊这个概念”；
video 页右侧问答侧栏。



**结果：**Alice 能做复杂跨视频/跨概念任务，而不仅是单视频 QA。


Level 3：自我变化 & 评测 / 调试体系


TimelineService 加上：

“兴趣/观点变化”分析逻辑（rule + embedding）；
timeline.analyze_change 工具；

EvalService：

eval_cases / eval_result 表；
一键跑评测脚本；

可观测性：

agent_run / tool_call 记录；
console 页可视化。



结果：

Alice 能主动/被动地“聊你自己在变什么”；
你能安全地迭代她的大脑，不怕越改越差。



Level 4：权限 / 插件 / 协作（更偏平台化）


PluginRegistry：

外部 Source/Tool 集成机制；

PermissionService：

租户级工具白名单；
用户级权限策略；

多用户协作：

tenant 公共 Alice vs 用户私有 Alice 视图；
知识/时间线的共享策略。



**结果：**AliceLM 不只是你自己的 Her，也可以变成一个团队/社区的共享大脑平台。


Forweb

好，我们直接当成在给 “Alice OS” 做一整套前端体验设计说明书。

我会分 4 部分讲：
	1.	整体 UX 设计原则（结合 11labs / Manus / Lovart / ChatGPT）
	2.	VI / SI：视觉 + 人格一体化设计
	3.	核心页面 & 交互形态（大量具体想象）
	4.	前端框架 + ASCII 草图（线条版 wireframe）

⸻

1. 整体 UX 设计原则

结合你现在的规划 + 外部产品的启发，我觉得 Alice 前端可以围绕 4 个原则：
	1.	One Alice, Multi Surfaces：一体多面
	•	只有一个“大 Alice”（租户级人格），但在不同页面呈现不同“形态”：
	•	Chat 面：伙伴 / 合作者
	•	Library 面：研究助理
	•	Graph 面：知识制图师
	•	Timeline 面：人生观察者
	•	视觉上要能一眼看出“这是同一个人，只是换了工作场景”。
	2.	World × Me × We：世界 / 自我 / 共创 三重视角
	•	World：帮你理解「世界知识」（视频、文档…）
	•	Me：帮你理解「我在变什么」
	•	We：你 + Alice 一起做事（计划、项目、学习路径）
	•	UI 上三块都要有专门的 “home”，而且互相能跳转。
	3.	Agent 可见性：让“她在干嘛”可感知，但不打扰
	•	ElevenLabs 的 UI 很强调 agent 的状态组件（orb、波纹等） ￼
	•	ChatGPT Atlas 在浏览器侧边栏里给 AI 一块“并行空间” ￼
	•	Alice 也应该有：
	•	始终存在的“小存在感”（一个活的 orb / 头像）
	•	需要时可以展开看到“当前任务 / 工具调用 / 进度”的短面板（像 Manus 的执行视角） ￼
	4.	Calm Depth：深但不吓人
	•	Lovart 把复杂的设计 pipeline 包装成一句话驱动的界面 + 高级设置区 ￼
	•	Alice 也要类似：
	•	默认是“一个很柔和的聊天 / 首页”；
	•	深一点的东西（task board、graph、console）藏在一两级操作之后。

⸻

2. VI / SI：视觉 & 系统人格

2.1 视觉风格（VI）

关键词：温暖、系统感、轻科幻、不黑客
	•	配色建议：
	•	背景：偏暗的蓝灰 / 炭黑（#050814 / #0B1018）
	•	主色：暖一点的珊瑚 / 橘粉（Her 的那种情绪感）
	•	辅色：一条冷色 high-tech 线（青绿 / 蓝）用于图谱 & 线条
	•	保留浅色模式，但默认暗色，更像“个人操作系统”的感觉
	•	形状语言：
	•	圆角偏大，但布局偏网格，既有温度又有结构感
	•	大面积使用“带轻微光晕”的卡片 / 节点（类似 Lovart 的卡片 + ElevenLabs Agent orb 的发光感） ￼
	•	动效：
	•	Alice 的主头像 / orb：
	•	思考时轻微呼吸、旋转几何线条（受 ElevenLabs Orb 启发） ￼
	•	知识图谱节点：选中节点时有一圈扩散波纹；
	•	时间线节点：滚动时有轻微惯性和缓慢放大效果。
	•	字体：
	•	中文：优先用干净、现代感的黑体（类似 Inter/思源黑体风格）；
	•	英文：无衬线，偏几何（Inter, SF Pro, etc），统一大小节奏，整体更像“系统 UI”而非网页。

2.2 系统人格（SI）

Alice 的人格需要贯穿所有界面和文案，而不是只在 Chat 里体现。
	•	人格关键词：
	•	观察 / 诚实 / 伴随 / 不油腻
	•	会温柔地指出你在绕圈，但不说教。
	•	统一的“声音”出口：
	•	首页上的欢迎语
	•	timeline 页的总结卡片
	•	学习路径 / 计划卡片上的描述
	•	提示文字（例如空状态里的话）
	•	统一的“形象”：
	•	始终使用一个核心视觉：
	•	不是人形，而是一个有“情绪”的几何体/光球（不想太像人，略抽象一点，受 ElevenLabs Agent orb & Lovart 抽象图形启发） ￼
	•	这个光球出现在：
	•	顶部导航 / 左上
	•	Chat 气泡里的小头像
	•	视频侧栏 / Graph 页角落
	•	多场景人格的一致性：
	•	在 Library 中：说话更偏“学术 &研究”；
	•	在 Timeline 中：更偏“朋友式复盘”；
	•	在 Console 中：偏工程师视角。

⸻

3. 核心页面 & 交互形态（想象 + 细节）

3.1 全局 Shell：Alice OS 外壳

无论在哪个页面都沿用一个三栏结构（桌面端）：
	•	左：主导航（场景切换）
	•	中：当前场景主内容
	•	右：上下文 / Alice 侧边栏（可折叠）

ASCII 草图：

┌──────────────────────────────────────────────────────────────────┐
│  Alice logo/orb     搜索栏（搜视频/概念/对话/事件）      用户头像 │
├───────────────┬───────────────────────────────┬─────────────────┤
│  导航栏       │         主内容区域            │   右侧上下文    │
│  - Home       │                               │  - 当前场景信息 │
│  - Chat       │                               │  - Alice 状态   │
│  - Library    │                               │  - 引用/工具结果│
│  - Graph      │                               │  （可折叠）     │
│  - Timeline   │                               │                 │
│  - Tasks/Plan │                               │                 │
│  - Console    │                               │                 │
└───────────────┴───────────────────────────────┴─────────────────┘

右侧上下文是一个关键创新点：
像 ChatGPT Atlas 侧边栏那样，把 Alice 的“并行思考”放在一侧，不挡住主内容 ￼。

⸻

3.2 Alice Home（世界 & 自我总览）

这是你每天打开的“仪表盘”，不是冷冰冰的数据，而是 Alice 给你的一张「今天我们在哪」的首页。

布局想象：

┌─────────────────────────────────────────────────────────────┐
│  顶部：一句 Alice 的问候 + 快速输入框（问任何问题）        │
├─────────────────────────────────────────────────────────────┤
│  左列：最近的「世界」                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [最近的视频/文档]  [最近的概念热点]                 │   │
│  │ [继续上次的研究]  [推荐深入看的主题]               │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  右列：最近的「我」                                        │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 卡片：你最近在变什么（Alice 的小结）                │   │
│  │ 卡片：近期循环问题提醒                             │   │
│  │ 卡片：本周小目标 / 学习路径进度                     │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘

	•	上方大输入框类似 Lovart 的 “一句话驱动整个 pipeline” ￼
	•	左列偏“信息世界”，右列偏“自我 & 共创”，对齐 World / Me / We 的三重视角。

⸻

3.3 Chat 场景：多模态多场景对话

参考 ChatGPT 的经典“左侧对话列表 + 中间聊天区”布局 ￼，但要加入更多场景按钮 & agent 状态。

┌─────────────────────────────────────────────────────────────┐
│ 顶部：场景标签 [通用聊天] [关于这台设备] [关于我的世界观]  │
├───────────────┬───────────────────────────────────────────┤
│ 对话列表      │ 聊天区                                     │
│  - 会话A      │ ┌───────────────────────────────────────┐ │
│  - 会话B      │ │  用户气泡                              │ │
│  - …          │ ├───────────────────────────────────────┤ │
│               │ │  Alice 气泡 + 引用卡片                 │ │
│               │ │   [视频#1片段] [概念卡] [时间线事件]   │ │
│               │ └───────────────────────────────────────┘ │
│               │  底部输入框 + 模式开关（严谨/灵感/...）   │
└───────────────┴───────────────────────────────────────────┘

创新点：
	•	引用卡片统一样式：不再只是“[1][2]”脚注，而是可以点击的卡片：
	•	视频片段：预览标题 + 时间戳
	•	概念卡：节点 + 简短定义
	•	时间线事件：某月某日的你说过的一句话
	•	工具执行状态：
	•	Alice 气泡顶部有一行小字：
	•	“正在查 3 个视频 / 2 个概念 / 1 段时间线记录…”
	•	受 OpenManus/Manus “bridges minds and actions”的理念启发，让“行动”可感知 ￼

⸻

3.4 Library（知识库）：视频 / 文档 / 研究入口

这里会借一点 Lovart 的卡片式展示：每个视频是一个“作品卡”，同时是知识入口。 ￼

┌─────────────────────────────────────────────────────────────┐
│ 顶部：筛选（主题 / 来源 / 时间） + 按钮「让 Alice 研究选中的」 │
├─────────────────────────────────────────────────────────────┤
│ 卡片网格：                                                  │
│ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│ │ 缩略图       │  │ 缩略图       │  │ 缩略图       │ │
│ │ 标题         │  │ 标题         │  │ 标题         │ │
│ │ 标签/主题    │  │ 标签/主题    │  │ 标签/主题    │ │
│ │ [Alice 重点] │  │ [Alice 重点] │  │ [Alice 重点] │ │
│ └─────────────┘  └─────────────┘  └─────────────┘ │
│ ...                                                         │
└─────────────────────────────────────────────────────────────┘

	•	每个卡片上有一行「Alice 重点」：这是 Alice 给这个视频的一行“为何对你重要”的个人化描述。
	•	勾选多个卡片，右上角按钮「让 Alice 做一份研究」 → 跳转到 Chat / Task 场景，开始多视频分析。

⸻

3.5 Video 详情 + 侧边 Alice

这里重点是“视频播放器 + 结构化解读 + 侧边对话”三合一。

┌─────────────────────────────────────────────────────────────┐
│ [播放器]                │ 右侧： Alice 视频侧栏             │
│ ┌───────────────┐      │ ┌─────────────────────────────┐ │
│ │               │      │ │ 摘要 / 要点 / 时间轴         │ │
│ │   视频画面    │      │ │ - 一句话总结                │ │
│ │               │      │ │ - 3~5 个关键点             │ │
│ └───────────────┘      │ │ - 时间轴片段（可点播放）    │ │
│                        │ ├─────────────────────────────┤ │
│ 下方：转写 / 章节      │ │ Mini Chat：问这个视频       │ │
│ - 可选行               │ │ [输入框]                    │ │
└────────────────────────┴─┴─────────────────────────────┘

交互亮点：
	•	转写内容中，鼠标选中一段 → 自动弹出「问 Alice 关于这段」小浮层；
	•	在 mini Chat 中出现的回答引用段落，可以把转写滚动到对应位置，并点亮那几句。

⸻

3.6 Graph（知识图谱）：概念地图 & Chat 结合

参考 SurfSense 的“多节点工作流”和 graph-rag-agent 的图谱思路，这里是你“看自己知识地图”的地方。 ￼

┌─────────────────────────────────────────────────────────────┐
│ 顶部：搜索概念 / 选择视角（技术 / 产品 / 人生主题）        │
├─────────────────────────────────────────────────────────────┤
│ 左 2/3：交互式图谱                                         │
│  ┌───────────────────────────────────────────────────────┐ │
│  │   ○──○      ○                                         │ │
│  │  /    \    / \       （节点 + 边，可拖动/缩放）        │ │
│  │ ○      ○--○   ○                                       │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│ 右 1/3：概念详情 + Alice 聊这个概念                        │
│  ┌───────────────────────────────────────────────────────┐ │
│  │ [概念名称]                                            │ │
│  │ 简短定义 + 来源视频/文档列表                          │ │
│  │ 标签：相关主题                                        │ │
│  ├───────────────────────────────────────────────────────┤ │
│  │ Mini Chat：和 Alice 聊这个概念                       │ │
│  └───────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

	•	点击任意节点，右侧自动加载概念详情，同时你可以直接问：
“这个概念在我的世界观里扮演什么角色？”

⸻

3.7 Timeline（自我时间线）：聊「我在变什么」

这是你最在意的能力的可视化表现。

┌─────────────────────────────────────────────────────────────┐
│ 顶部：时间范围选择（最近一周 / 一月 / 一年） + 按钮        │
│      [让 Alice 总结我在变什么]                             │
├─────────────────────────────────────────────────────────────┤
│ 纵向时间线                                                 │
│   ●  今天  看了视频《...》，提问：xxx（标签：Agent）       │
│   │      选中：Alice 的短注释                              │
│   ●  昨天  标记了 insight：「我想做一个 OS 级 Her」        │
│   │                                                      │
│   ●  上周  提问：「我到底应不应该做产品 X」               │
│   │                                                      │
│   ...                                                    │
├─────────────────────────────────────────────────────────────┤
│ 底部：Alice 的阶段性总结卡片                               │
│  ┌───────────────────────────────────────────────────────┐ │
│  │ 「最近你在变什么」                                    │ │
│  │ - 兴趣从 A → B                                        │ │
│  │ - 对话中怀疑减少，规划类问题增多                     │ │
│  │ - 有一个绕圈问题：...                                │ │
│  │  [展开细节] [和 Alice 深聊这几点]                     │ │
│  └───────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

	•	时间线节点上可以用不同颜色表示事件类型（看内容 / 问问题 / highight / 计划）。
	•	最底部的总结卡片是 Agent + TimelineService 的产物，UI 上尽量简单，但语气要非常“Her”。

⸻

3.8 Tasks / Plan（共创区）

参考 OpenManus“行动导向”的理念，这里是你和 Alice 一起做项目 / 学习 / 计划的看板。 ￼

┌─────────────────────────────────────────────────────────────┐
│ 顶部：新建任务「帮我在 3 个月内做出 Alice Beta」           │
├─────────────────────────────────────────────────────────────┤
│ 看板风格：                                                 │
│ ┌───────────┬───────────┬───────────┐                    │
│ │  想法池   │ 进行中    │ 已完成    │                    │
│ │ [功能1]   │ [研究任务]│ [学习路径]│                    │
│ │ [学习主题]│ [实现任务]│ ...       │                    │
│ └───────────┴───────────┴───────────┘                    │
└─────────────────────────────────────────────────────────────┘

	•	每张卡背后都可以展开一个 mini Chat，看到 Alice 当时怎么想的 / 引用了哪些知识。

⸻

3.9 Console（开发者视角）

这是给你这种“造物者”用的，不必给所有用户开。

┌─────────────────────────────────────────────────────────────┐
│ Tabs: [Agent Runs] [Eval] [Tools] [Plugins]                │
├─────────────────────────────────────────────────────────────┤
│ Agent Runs:                                                 │
│ ┌───────────┬───────────┬───────────┬───────────────────┐ │
│ │ 时间      │ 场景      │ 状态      │ 入口（chat/video) │ │
│ ├───────────┴───────────┴───────────┴───────────────────┤ │
│ │ 点击进入：显示消息流 / 工具调用 / 中间思考摘要        │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

这里的 UI 可以大量借鉴 ElevenLabs UI / Open WebUI 那类 agent 面板：组件化、卡片化、有日志展开层。 ￼

⸻

4. 前端框架总结 + 结构草图

最后把整个前端信息架构 & 页面框架用一个简单“文件树 + 主布局线图”收束一下。

4.1 前端路由 / 模块结构（概念）

app/
└── home/
    ├── page.tsx           # Alice Home，总览（世界 + 自我）
    ├── chat/
    │   └── page.tsx       # 对话 Alice
    ├── library/
    │   └── page.tsx       # 知识库
    ├── video/[id]/
    │   └── page.tsx       # 视频详情 + 侧边 Alice
    ├── graph/
    │   └── page.tsx       # 知识图谱
    ├── timeline/
    │   └── page.tsx       # 时间线 & 自我变化
    ├── tasks/
    │   └── page.tsx       # 计划 / 项目共创
    ├── console/
    │   └── page.tsx       # Dev Console / Eval
    └── settings/
        └── page.tsx       # Persona / 工具 / 权限设置

4.2 全局布局线稿（再画一次更简洁的）

┌──────────────────────────────────────────────────────────────┐
│ Alice orb + logo   | 全局搜索栏                  | 用户菜单  │
├─────────────────────┬────────────────────────────┬───────────┤
│                     │                            │           │
│  左侧：场景导航     │      中间：当前场景        │ 右侧：    │
│  - Home             │      - chat / graph / ...  │  上下文   │
│  - Chat             │                            │  - Alice  │
│  - Library          │                            │    状态   │
│  - Graph            │                            │  - 引用   │
│  - Timeline         │                            │  - 工具   │
│  - Tasks / Plan     │                            │    结果   │
│  - Console          │                            │           │
│  - Settings         │                            │           │
└─────────────────────┴────────────────────────────┴───────────┘


