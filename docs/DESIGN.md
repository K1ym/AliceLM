# ğŸ—ï¸ AliceLM æŠ€æœ¯è®¾è®¡æ–‡æ¡£

---

## 1. è®¾è®¡åŸåˆ™

### 1.1 æ ¸å¿ƒåŸåˆ™

| åŸåˆ™ | è¯´æ˜ | å®è·µ |
|------|------|------|
| **æ¨¡å—åŒ–** | åŠŸèƒ½è§£è€¦ï¼Œç‹¬ç«‹æ¼”è¿› | æ’ä»¶å¼ASR/LLM/Notifier |
| **å¯æ‰©å±•** | é¢å‘æ¥å£ï¼Œæ˜“äºæ‰©å±• | ProvideræŠ½è±¡å±‚ |
| **å¤šç§Ÿæˆ·** | æ”¯æŒå¤šç”¨æˆ·éš”ç¦» | Tenant-awareæ•°æ®æ¨¡å‹ |
| **æ•°æ®åˆ†å±‚** | ç»“æ„åŒ–+å‘é‡åŒ–åˆ†ç¦» | SQL + VectorDB |
| **é…ç½®é©±åŠ¨** | è¡Œä¸ºå¯é…ç½®ï¼Œæ— éœ€æ”¹ä»£ç  | YAML/ENVé…ç½® |

### 1.2 æ‰©å±•æ€§è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Plugin Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Source Plugins â”‚  â”‚   ASR Plugins   â”‚  â”‚   LLM Plugins   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â€¢ Bilibili      â”‚  â”‚ â€¢ Whisper       â”‚  â”‚ â€¢ OpenAI        â”‚ â”‚
â”‚  â”‚ â€¢ YouTube       â”‚  â”‚ â€¢ Faster-Whisperâ”‚  â”‚ â€¢ Claude        â”‚ â”‚
â”‚  â”‚ â€¢ Podcast       â”‚  â”‚ â€¢ è®¯é£          â”‚  â”‚ â€¢ Ollama(æœ¬åœ°)  â”‚ â”‚
â”‚  â”‚ â€¢ Local File    â”‚  â”‚ â€¢ é˜¿é‡Œ          â”‚  â”‚ â€¢ DeepSeek      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                   â”‚                   â”‚             â”‚
â”‚           â–¼                   â–¼                   â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Core Engine (Provider Interface)               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚           â”‚                   â”‚                   â”‚             â”‚
â”‚           â–¼                   â–¼                   â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Notify Plugins  â”‚  â”‚  Store Plugins  â”‚  â”‚ Export Plugins  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â€¢ ä¼ä¸šå¾®ä¿¡      â”‚  â”‚ â€¢ SQLite        â”‚  â”‚ â€¢ Markdown      â”‚ â”‚
â”‚  â”‚ â€¢ Telegram      â”‚  â”‚ â€¢ PostgreSQL    â”‚  â”‚ â€¢ Notion        â”‚ â”‚
â”‚  â”‚ â€¢ é‚®ä»¶          â”‚  â”‚ â€¢ MySQL         â”‚  â”‚ â€¢ Obsidian      â”‚ â”‚
â”‚  â”‚ â€¢ Webhook       â”‚  â”‚ â€¢ MongoDB       â”‚  â”‚ â€¢ Anki          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„ï¼ˆå¤šç§Ÿæˆ·ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Clients                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ å¾®ä¿¡Bot  â”‚  â”‚  Web UI  â”‚  â”‚   MCP    â”‚  â”‚  CLI     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Gateway + Auth                          â”‚
â”‚                   (FastAPI + JWT/OAuth)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ è®¤è¯/æˆæƒ    â€¢ ç§Ÿæˆ·è¯†åˆ«    â€¢ é™æµ    â€¢ æ—¥å¿—                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Service Layer                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Alice One + Agent Engine                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚AliceIdentityâ”‚ â”‚ContextAssem â”‚ â”‚    AliceAgentCore       â”‚â”‚â”‚
â”‚  â”‚  â”‚  Service    â”‚ â”‚   bler      â”‚ â”‚ (Strategy/Planner/Exec) â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Watcher  â”‚ â”‚ Processor â”‚ â”‚ Knowledge â”‚ â”‚  Notifier â”‚       â”‚
â”‚  â”‚  Service  â”‚ â”‚  Service  â”‚ â”‚  Service  â”‚ â”‚  Service  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
â”‚        â”‚             â”‚             â”‚             â”‚              â”‚
â”‚        â–¼             â–¼             â–¼             â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Provider Layer (Pluggable)                     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  SourceProvider â”‚ ASRProvider â”‚ LLMProvider â”‚ RAGProvider  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Task Queue Layer                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚           Redis / APScheduler (Per-Tenant Queue)            â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚downloadâ”‚ â”‚  asr   â”‚ â”‚analyze â”‚ â”‚ embed  â”‚ â”‚ notify â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Relational DB (Per-Tenant)                 â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚ users  â”‚ â”‚ videos â”‚ â”‚  tags  â”‚ â”‚configs â”‚ â”‚ logs   â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚          SQLite (å•æœº) / PostgreSQL (ç”Ÿäº§)                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Vector DB (Per-Tenant)                     â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚â”‚
â”‚  â”‚  â”‚  embeddings    â”‚  â”‚   indexes      â”‚                     â”‚â”‚
â”‚  â”‚  â”‚  (chunks)      â”‚  â”‚  (HNSW/IVF)    â”‚                     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚â”‚
â”‚  â”‚          ChromaDB (å•æœº) / Qdrant/Milvus (ç”Ÿäº§)              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  File Storage (Per-Tenant)                  â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚â”‚
â”‚  â”‚  â”‚ videos â”‚ â”‚ audios â”‚ â”‚transcriptsâ”‚                        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚â”‚
â”‚  â”‚          Local (å•æœº) / S3/OSS (ç”Ÿäº§)                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç›®å½•ç»“æ„

```
AliceLM/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/                    # FastAPIåç«¯
â”‚   â”‚   â”œâ”€â”€ main.py
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ videos.py
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py
â”‚   â”‚   â”‚   â”œâ”€â”€ wechat.py
â”‚   â”‚   â”‚   â””â”€â”€ stats.py
â”‚   â”‚   â”œâ”€â”€ services/           # åº”ç”¨å±‚æœåŠ¡ï¼ˆHTTP è¯­ä¹‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ chat_service.py
â”‚   â”‚   â”‚   â””â”€â”€ video_service.py
â”‚   â”‚   â””â”€â”€ dependencies.py
â”‚   â”‚
â”‚   â””â”€â”€ web/                    # Next.jså‰ç«¯
â”‚       â”œâ”€â”€ app/
â”‚       â”‚   â”œâ”€â”€ page.tsx        # Dashboard
â”‚       â”‚   â”œâ”€â”€ chat/
â”‚       â”‚   â”œâ”€â”€ library/
â”‚       â”‚   â”œâ”€â”€ graph/
â”‚       â”‚   â”œâ”€â”€ timeline/
â”‚       â”‚   â”œâ”€â”€ tasks/
â”‚       â”‚   â”œâ”€â”€ console/
â”‚       â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ components/
â”‚
â”œâ”€â”€ alice/                      # â˜… Alice æ ¸å¿ƒæ¨¡å—ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ one/                    # Alice One å±‚
â”‚   â”‚   â”œâ”€â”€ identity.py         # AliceIdentityService
â”‚   â”‚   â”œâ”€â”€ context.py          # ContextAssembler
â”‚   â”‚   â””â”€â”€ timeline.py         # TimelineService
â”‚   â”‚
â”‚   â”œâ”€â”€ agent/                  # Agent å¼•æ“
â”‚   â”‚   â”œâ”€â”€ core.py             # AliceAgentCoreï¼ˆç»Ÿä¸€å…¥å£ï¼‰
â”‚   â”‚   â”œâ”€â”€ strategy.py         # StrategySelector + å„ Strategy
â”‚   â”‚   â”œâ”€â”€ task_planner.py     # TaskPlanner
â”‚   â”‚   â”œâ”€â”€ tool_executor.py    # ToolExecutor
â”‚   â”‚   â”œâ”€â”€ tool_router.py      # ToolRouter
â”‚   â”‚   â”œâ”€â”€ mcp_client.py       # MCP Client
â”‚   â”‚   â”œâ”€â”€ memory.py           # MemoryManager
â”‚   â”‚   â””â”€â”€ tools/              # Tool å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ video_tools.py  # ask_video / search_videos ç­‰
â”‚   â”‚       â”œâ”€â”€ graph_tools.py  # search_graph ç­‰
â”‚   â”‚       â”œâ”€â”€ timeline_tools.py
â”‚   â”‚       â”œâ”€â”€ search_tools.py # deep_web_research
â”‚   â”‚       â””â”€â”€ ext/            # å¤–éƒ¨è¿ç§»å·¥å…·
â”‚   â”‚           â””â”€â”€ strands_like/
â”‚   â”‚               â”œâ”€â”€ basic.py
â”‚   â”‚               â”œâ”€â”€ http_web.py
â”‚   â”‚               â””â”€â”€ unsafe.py
â”‚   â”‚
â”‚   â””â”€â”€ search/                 # SearchAgent æœåŠ¡
â”‚       â”œâ”€â”€ search_agent.py     # SearchAgentService
â”‚       â””â”€â”€ web_client.py       # Web æœç´¢å®¢æˆ·ç«¯å°è£…
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ watcher/                # æ”¶è—å¤¹ç›‘æ§æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ scanner.py
â”‚   â”‚   â””â”€â”€ scheduler.py
â”‚   â”‚
â”‚   â”œâ”€â”€ processor/              # è§†é¢‘å¤„ç†ç®¡é“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ downloader.py
â”‚   â”‚   â”œâ”€â”€ transcriber.py
â”‚   â”‚   â””â”€â”€ pipeline.py
â”‚   â”‚
â”‚   â”œâ”€â”€ asr/                    # ASRæ¨¡å‹é€‚é…å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ whisper_local.py
â”‚   â”‚   â”œâ”€â”€ faster_whisper.py
â”‚   â”‚   â””â”€â”€ api_provider.py     # äº‘ç«¯ ASR ç»Ÿä¸€æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ ai/                     # AIæœåŠ¡ï¼ˆProvider å±‚ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ llm/                # LLM Provider
â”‚   â”‚   â”œâ”€â”€ rag/                # RAG Provider
â”‚   â”‚   â”œâ”€â”€ summarizer.py
â”‚   â”‚   â””â”€â”€ embedder.py
â”‚   â”‚
â”‚   â”œâ”€â”€ knowledge/              # çŸ¥è¯†å›¾è°±æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ graph.py
â”‚   â”‚   â””â”€â”€ learning.py
â”‚   â”‚
â”‚   â”œâ”€â”€ mcp/                    # MCP Serverï¼ˆå¯¹å¤–æš´éœ²èƒ½åŠ›ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ server.py
â”‚   â”‚   â””â”€â”€ tools.py
â”‚   â”‚
â”‚   â””â”€â”€ notifier/               # é€šçŸ¥æœåŠ¡
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ wechat.py
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ db/                     # æ•°æ®åº“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ tenant.py
â”‚   â”‚   â”‚   â”œâ”€â”€ video.py
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.py        # AgentRun / AgentStep
â”‚   â”‚   â”‚   â”œâ”€â”€ timeline.py     # TimelineEvent
â”‚   â”‚   â”‚   â””â”€â”€ eval.py         # EvalCase / EvalResult
â”‚   â”‚   â”œâ”€â”€ crud.py
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚
â”‚   â”œâ”€â”€ queue/                  # ä»»åŠ¡é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ tasks.py
â”‚   â”‚   â””â”€â”€ worker.py
â”‚   â”‚
â”‚   â””â”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ settings.py
â”‚       â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ third_party/                # â˜… å¼€æºå‚è€ƒä»“åº“ï¼ˆæ–°å¢ï¼Œgitignoreï¼‰
â”‚   â”œâ”€â”€ mindsearch/             # MindSearch clone
â”‚   â”œâ”€â”€ openmanus/              # OpenManus clone
â”‚   â”œâ”€â”€ gemini_cli/             # Gemini CLI clone
â”‚   â””â”€â”€ strands_agents_tools/   # strands-agents/tools clone
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ scan_favlist.py
â”‚   â””â”€â”€ migrate.py
â”‚
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•ï¼ˆgitignoreï¼‰
â”‚   â”œâ”€â”€ videos/
â”‚   â”œâ”€â”€ audio/
â”‚   â”œâ”€â”€ transcripts/
â”‚   â””â”€â”€ db.sqlite
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ DESIGN.md
â”‚   â”œâ”€â”€ ROADMAP.md
â”‚   â”œâ”€â”€ 1204PLAN.md
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

### 2.3 Alice One ä¸ Agent åˆ†å±‚æ¶æ„

æœ¬å°èŠ‚åœ¨å‰é¢æ•´ä½“æ¶æ„çš„åŸºç¡€ä¸Šï¼Œæ˜ç¡® Alice One ä¸ Agent å¼•æ“åœ¨ç³»ç»Ÿä¸­çš„ä½ç½®ã€
åˆ†å±‚å…³ç³»ä»¥åŠä¸ç°æœ‰æ¨¡å—/æ•°æ®çš„äº¤äº’æ–¹å¼ã€‚

#### 2.3.1 åˆ†å±‚è§†å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Clients                             â”‚
â”‚  Web UI / å¾®ä¿¡Bot / MCP / CLI / å…¶ä»–å…¥å£                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ HTTP / WebSocket / MCP
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       API Gateway + Routers (apps/api/routers)             â”‚
â”‚  videos / chat / folders / auth / config ...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ è°ƒç”¨åº”ç”¨æœåŠ¡ï¼ˆApplication Servicesï¼‰        
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Application Services (apps/api/services)                  â”‚
â”‚   VideoService / ChatService / FolderService / ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ é¢å‘ç”¨ä¾‹ï¼Œå°è£… HTTP è¯­ä¹‰                   
                â”‚ ç»Ÿä¸€é€šè¿‡ Alice One å±‚è·å–äººæ ¼ + ä¸Šä¸‹æ–‡       
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Alice One Layer (alice/one)                 â”‚
â”‚   â€¢ AliceIdentityService    # äººæ ¼ & å·¥å…·é…ç½®              â”‚
â”‚   â€¢ ContextAssembler        # ä¸Šä¸‹æ–‡è£…é…                   â”‚
â”‚   â€¢ TimelineService         # ç»Ÿä¸€æ—¶é—´çº¿                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ æ„é€  AgentTask + ä¸Šä¸‹æ–‡                     
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Agent Engine (alice/agent)                     â”‚
â”‚   â€¢ AliceAgentCore         # ç»Ÿä¸€å…¥å£ + ReAct å¾ªç¯        â”‚
â”‚   â€¢ ToolRouter + tools/    # å·¥å…·è·¯ç”±ä¸æ‰§è¡Œ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ é€šè¿‡å·¥å…·è®¿é—®é¢†åŸŸæœåŠ¡                       
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Domain & Integration Services (services/*)             â”‚
â”‚   ai / knowledge / processor / asr / notifier / mcp ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ ä½¿ç”¨åŸºç¡€è®¾æ–½ï¼ˆDB/é˜Ÿåˆ—/é…ç½®/RAGFlow/æ–‡ä»¶ï¼‰   
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Infrastructure & Data (packages/*, data/*, Chromaâ€¦)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å…³é”®çº¦æŸï¼š

- Alice One å±‚ä¸ç›´æ¥å¤„ç† HTTP æˆ–å‰ç«¯çŠ¶æ€ï¼Œåªé¢å‘åº”ç”¨æœåŠ¡å’Œ Agent å¼•æ“ã€‚
- Agent å¼•æ“ä¸ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œåªé€šè¿‡å·¥å…·è°ƒç”¨ç°æœ‰ `services/ai`ã€`services/knowledge` ç­‰æ¨¡å—ã€‚
- Watcher / Processor / ASR / Notifier / RAGFlow ç­‰åŸæœ‰æ¨¡å—ä¿æŒèŒè´£ä¸å˜ï¼Œ
  è¢« Alice One + Agent ä½œä¸ºã€Œèƒ½åŠ›æä¾›è€…ã€ç»„åˆä½¿ç”¨ï¼Œè€Œä¸æ˜¯è¢«é‡å†™ã€‚

#### 2.3.2 æ•°æ®è§†å›¾ï¼ˆAlice One ä¾èµ–çš„æ•°æ®ï¼‰

Alice One ä¸å¼•å…¥æ–°çš„ã€Œå¹³è¡Œä¸–ç•Œã€æ•°æ®è¡¨ï¼Œè€Œæ˜¯å¯¹ç°æœ‰è¡¨åšè§†å›¾åŒ–ï¼š

- **TenantProfileï¼ˆé€»è¾‘è§†å›¾ï¼‰**
  - æ¥æºï¼š`Tenant` + `TenantConfig` ä¸­ `alice.*` å‘½åç©ºé—´ä¸‹çš„é…ç½®
  - å†…å®¹ï¼špersona åç§°/è¯­æ°”ã€è¯­è¨€ã€verbosityã€å¯ç”¨å·¥å…·é›†åˆã€åå¥½è®¾ç½®
  - å½¢å¼ï¼šPydantic/æ•°æ®ç±»æ¨¡å‹ï¼Œä¸æ–°å¢ä¸»è¡¨ï¼Œé¿å…ä¸ TenantConfig é‡å¤å­˜å‚¨

- **TimelineEventï¼ˆç»Ÿä¸€æ—¶é—´çº¿ï¼‰**
  - åŸºäº `LearningRecord` æ‰©å±•è¯­ä¹‰ï¼ŒæŠ½è±¡ä¸ºã€ŒæŸæ—¶é—´ç‚¹å‘ç”Ÿçš„ä¸€ä»¶äº‹ã€ï¼š
    - `event_type`: watch_video / ask_question / highlight / insight / plan_created ...
    - `scene`: chat / library / video / graph / timeline / tasks / console
    - `context`: JSONï¼ŒåŒ…å«è§†é¢‘/æ¦‚å¿µ/å¯¹è¯ ID ç­‰ä¸Šä¸‹æ–‡
  - æ‰€æœ‰å…¥å£ï¼ˆWeb / å¾®ä¿¡ / MCPï¼‰åœ¨å…³é”®åŠ¨ä½œç»“æŸåéƒ½è°ƒç”¨ `TimelineService.append_event`ï¼Œ
    æŠŠè¡Œä¸ºå†™å…¥åŒä¸€å¼ äº‹ä»¶è¡¨ï¼Œå½¢æˆä¸€æ¡ç»Ÿä¸€æ—¶é—´çº¿ã€‚

- **PersonaSnapshotï¼ˆæ´¾ç”Ÿè§†å›¾ï¼‰**
  - ä» TimelineEvent + è§†é¢‘/æ¦‚å¿µ/å¯¹è¯ä¸­ã€Œæ±‡æ€»ã€å‡ºä¸€æ®µæ—¶é—´å†…çš„ç”¨æˆ·ç”»åƒï¼š
    - ä¸»é¢˜åˆ†å¸ƒï¼ˆæœ€è¿‘å¸¸çœ‹çš„é¢†åŸŸï¼‰
    - é—®é¢˜æ¨¡å¼ï¼ˆè§„åˆ’ç±» / æ€€ç–‘ç±»ç­‰æ¯”ä¾‹ï¼‰
    - å…´è¶£/è§‚ç‚¹å˜åŒ–ï¼ˆä» A â†’ Bï¼‰
  - åˆæœŸå¯æŒ‰éœ€å®æ—¶è®¡ç®—ï¼›å¦‚æœ‰æ€§èƒ½å‹åŠ›ï¼Œå†è½ä¸€ä¸ªç¼“å­˜è¡¨ï¼Œæ˜ç¡®æ ‡ä¸ºç‰©åŒ–è§†å›¾è€Œéä¸»äº‹å®è¡¨ã€‚

#### 2.3.3 Alice One ä¸‰å¤§æœåŠ¡èŒè´£

- **AliceIdentityService**
  - è¾“å…¥ï¼š`tenant_id`ã€`user_id`ï¼ˆå¯é€‰ï¼‰ã€`scene`
  - è¾“å‡ºï¼š
    - `system_prompt`ï¼šAlice One çš„äººæ ¼ä¸è¡Œä¸ºè§„åˆ™
    - `tool_scopes`ï¼šåœ¨å½“å‰åœºæ™¯å…è®¸ä½¿ç”¨çš„å·¥å…· scope åˆ—è¡¨
    - `settings`ï¼šè¯­è¨€ã€è¯­æ°”ã€è¾“å‡ºé£æ ¼ç­‰
    - `tenant_profile`ï¼šåˆå¹¶åçš„ TenantProfile è§†å›¾

- **TimelineService**
  - `append_event(event)`ï¼šç»Ÿä¸€å†™å…¥æ—¶é—´çº¿äº‹ä»¶
  - `query(user_id, period, filters)`ï¼šæŒ‰æ—¶é—´/ç±»å‹/åœºæ™¯æŸ¥è¯¢äº‹ä»¶
  - `summarize(user_id, period)`ï¼šåŸºäºäº‹ä»¶ç”Ÿæˆ PersonaSnapshot

- **ContextAssembler**
  - è¾“å…¥ï¼š`AgentTask`ï¼ˆtenant/user/scene/query/video_id/å‰ç«¯é™„åŠ ä¸Šä¸‹æ–‡ï¼‰
  - å†…éƒ¨ç»„åˆï¼šæœ€è¿‘å¯¹è¯ + RAG æ£€ç´¢åˆ°çš„ç›¸å…³è§†é¢‘ç‰‡æ®µ + çŸ¥è¯†å›¾è°±æ¦‚å¿µ + ç²¾ç®€ PersonaSnapshot
  - è¾“å‡ºï¼š
    - `messages`ï¼šå·²ç»æ‹¼è£…å¥½ã€å¯ç›´æ¥å‘é€ç»™ LLM/Agent çš„ messages åˆ—è¡¨
    - `citations`ï¼šæ‰€æœ‰å¼•ç”¨çš„è§†é¢‘ç‰‡æ®µ/æ¦‚å¿µ/æ—¶é—´çº¿äº‹ä»¶ï¼Œå‰ç«¯å¯ä»¥ç»Ÿä¸€æ¸²æŸ“ä¸ºå¼•ç”¨å¡ç‰‡

#### 2.3.3.x Agent æ ¸å¿ƒæ•°æ®ç±»å®šä¹‰

ä»¥ä¸‹æ•°æ®ç±»è´¯ç©¿ Alice One + Agent å„æ¨¡å—ï¼Œæ˜¯ Claude å®ç°æ—¶çš„"åˆåŒ"ï¼š

```python
from dataclasses import dataclass, field
from typing import Optional, List, Dict, Any
from enum import Enum

class Scene(str, Enum):
    CHAT = "chat"
    RESEARCH = "research"
    TIMELINE = "timeline"
    LIBRARY = "library"
    VIDEO = "video"
    GRAPH = "graph"
    TASKS = "tasks"
    CONSOLE = "console"

@dataclass
class AgentTask:
    """Agent çš„ç»Ÿä¸€è¾“å…¥å¥‘çº¦"""
    tenant_id: str
    scene: Scene                          # å½“å‰åœºæ™¯
    query: str                            # ç”¨æˆ·è¾“å…¥
    user_id: Optional[str] = None
    video_id: Optional[int] = None        # å…³è”è§†é¢‘ï¼ˆè‹¥æœ‰ï¼‰
    selection: Optional[str] = None       # ç”¨æˆ·é€‰ä¸­çš„æ–‡æœ¬
    extra_context: Dict[str, Any] = field(default_factory=dict)

@dataclass
class AgentCitation:
    """å¼•ç”¨æ¥æº"""
    type: str                             # video / concept / timeline / web
    id: str
    title: str
    snippet: str
    url: Optional[str] = None

@dataclass
class AgentStep:
    """Agent æ‰§è¡Œçš„å•ä¸ªæ­¥éª¤ï¼ˆç”¨äºè°ƒè¯• / å›æ”¾ï¼‰"""
    step_idx: int
    thought: str                          # LLM çš„æ€è€ƒ
    tool_name: Optional[str] = None
    tool_args: Optional[Dict] = None
    observation: Optional[str] = None
    error: Optional[str] = None

@dataclass
class AgentResult:
    """Agent çš„ç»Ÿä¸€è¾“å‡ºå¥‘çº¦"""
    answer: str
    citations: List[AgentCitation] = field(default_factory=list)
    steps: List[AgentStep] = field(default_factory=list)  # å¯é€‰
    token_usage: Optional[Dict[str, int]] = None
```

#### 2.3.4 å…¸å‹è¯·æ±‚é“¾è·¯ï¼ˆä»¥ Chat ä¸ºä¾‹ï¼‰

1. å‰ç«¯ `/home/chat` å‘ `/api/chat` å‘é€è¯·æ±‚ï¼š
   - body ä¸­åŒ…å« `scene="chat"`ï¼Œå¯é€‰ `video_id` / é€‰ä¸­æ–‡æœ¬ / graph èŠ‚ç‚¹ç­‰é™„åŠ ä¸Šä¸‹æ–‡ã€‚
2. `chat` è·¯ç”±æ ¡éªŒå‚æ•°åè°ƒç”¨ `ChatService`ã€‚
3. `ChatService` æ„é€  `AgentTask`ï¼Œè°ƒç”¨ï¼š
   - `AliceIdentityService` è·å– Alice One çš„äººæ ¼ä¸å·¥å…·èŒƒå›´
   - `ContextAssembler` ç»„è£…çŸ­æœŸ / ä¸­æœŸ / é•¿æœŸä¸Šä¸‹æ–‡
4. å°† `AgentTask` + ä¸Šä¸‹æ–‡äº¤ç»™ `AliceAgentCore.run_task(task)`ï¼š
   - åŸºäº `tool_scopes` ä» `ToolRouter` è·å–å¯ç”¨å·¥å…·
   - è¿è¡Œ ReAct å¾ªç¯ï¼šLLM æ€è€ƒ â†’ é€‰æ‹©å·¥å…· â†’ æ‰§è¡Œ â†’ è¿½åŠ  observation
5. å¾—åˆ° `AgentResult` åï¼š
   - `ChatService` é€šè¿‡ `TimelineService.append_event` è®°å½• ask_question ç­‰äº‹ä»¶
   - Router å°† `{ answer, citations, steps? }` è¿”å›å‰ç«¯ã€‚

å…¶ä»–å…¥å£ï¼ˆå¾®ä¿¡ / MCP / è§†é¢‘è¯¦æƒ…é¡µ / Graph é¡µé¢ï¼‰ä»…åœ¨ **scene å’Œé™„åŠ ä¸Šä¸‹æ–‡** ä¸åŒï¼Œ
åç»­é“¾è·¯å…¨éƒ¨å¤ç”¨è¿™ä¸€å¥— Alice One + Agent æµç¨‹ã€‚

#### 2.3.4.x AliceAgentCore å†…éƒ¨ç»“æ„ä¸ Strategy

ä¸Šä¸€èŠ‚çš„ `AgentOrchestrator` åœ¨å®é™…å®ç°ä¸­ç»Ÿä¸€å‡çº§ä¸º **AliceAgentCore**ï¼Œ
ä½œä¸º Agent å¼•æ“çš„å”¯ä¸€å…¥å£ï¼Œå†…éƒ¨åŒ…å«ä»¥ä¸‹å­ç»„ä»¶ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AliceAgentCore              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ StrategySelector                   â”‚
â”‚  â€¢ TaskPlanner                        â”‚
â”‚  â€¢ ToolExecutor (ReAct loop)          â”‚
â”‚  â€¢ ToolRouter                         â”‚
â”‚  â€¢ MemoryManager                      â”‚
â”‚  â€¢ ResultCritic (å¯é€‰)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **StrategySelector**ï¼šæ ¹æ® `scene` + ç®€å•æ„å›¾è¯†åˆ«ï¼Œé€‰æ‹©åˆé€‚çš„æ‰§è¡Œç­–ç•¥ï¼š
  - `ChatStrategy`ï¼šåå¯¹è¯ã€è§£é‡Šå’Œè½»é‡é—®ç­”ï¼Œä¸å¯ç”¨é‡å‹å·¥å…·ï¼›
  - `ResearchStrategy`ï¼šåæ·±åº¦æ£€ç´¢ / å¤šè½®æ¨ç†ï¼Œå¯ç”¨ `deep_web_research` ç­‰å·¥å…·ï¼›
  - `TimelineStrategy`ï¼šåã€Œè‡ªæˆ‘å˜åŒ– / å­¦ä¹ è½¨è¿¹ã€ç±»é—®é¢˜ï¼Œä¼˜å…ˆèµ° TimelineService / Graphï¼›
  - æœªæ¥å¯æ‰©å±•ï¼š`PlanStrategy`ï¼ˆä»»åŠ¡è§„åˆ’ï¼‰ã€`ReflectionStrategy`ï¼ˆè‡ªæˆ‘å¤ç›˜ï¼‰ç­‰ã€‚

- **TaskPlanner**ï¼šå°†è‡ªç„¶è¯­è¨€ä»»åŠ¡æ‹†æˆå¤šä¸ª step çš„è§„åˆ’å™¨ï¼Œè¾“å‡º `AgentPlan`ã€‚

- **ToolExecutor**ï¼šæ‰§è¡Œ ReAct å¾ªç¯ï¼ˆLLM æ€è€ƒ â†’ è°ƒç”¨å·¥å…· â†’ æ³¨å…¥è§‚å¯Ÿ â†’ ç»§ç»­æ€è€ƒï¼‰ï¼Œæ”¯æŒæœ€å¤§æ­¥æ•°æ§åˆ¶ä¸é”™è¯¯å¤„ç†ã€‚

- **ToolRouter**ï¼šç»Ÿä¸€ç®¡ç†æœ¬åœ° Tool å’Œå¤–éƒ¨ MCP Tool çš„è°ƒç”¨åˆ†å‘ã€‚

- **MemoryManager**ï¼šç®¡ç†çŸ­æœŸå¯¹è¯è®°å¿†ä¸é•¿æœŸä¸Šä¸‹æ–‡ï¼ˆå¯¹æ¥ ContextAssemblerï¼‰ã€‚

- **ResultCritic**ï¼ˆå¯é€‰ï¼‰ï¼šå¯¹ Agent è¾“å‡ºåšè‡ªæˆ‘æ ¡éªŒï¼Œå‘ç°æ˜æ˜¾é”™è¯¯æ—¶é‡è¯•æˆ–ä¿®æ­£ã€‚

**æ ¸å¿ƒæ¥å£ï¼ˆä¼ªä»£ç ï¼‰ï¼š**

```python
class AliceAgentCore:
    async def run_task(self, task: AgentTask) -> AgentResult:
        strategy = self.strategy_selector.pick(task)       # chat / research / timeline / ...
        context  = self.memory_manager.build_context(task)
        plan     = self.task_planner.plan(task, context, strategy)
        result   = self.tool_executor.execute(plan, task, context, self.tool_router, strategy)
        self.result_critic.review(task, result, strategy)  # å¯é€‰
        return result
```

**è®¾è®¡çº¦æŸï¼š**

- ä¸å­˜åœ¨å¤šä¸ª Engineï¼›æ‰€æœ‰å…¥å£åœºæ™¯ï¼ˆchat / library / video / graph / timeline / tasks / consoleï¼‰æœ€ç»ˆéƒ½é€šè¿‡ `AliceAgentCore.run_task()` å¤„ç†ã€‚
- `web_search` / `deep_web_research` ç­‰èƒ½åŠ›éƒ½è¢«è§†ä¸º Toolï¼Œç”± TaskPlanner å†³å®šæ˜¯å¦ä½¿ç”¨ã€‚
- å°†æ¥ä»å¼€æºé¡¹ç›®è¿ç§»çš„ Planner / Executor é€»è¾‘ä¼šè¢«é‡å‘½åä¸º Alice è‡ªå·±çš„ TaskPlanner / ToolExecutorï¼Œå®ç°ç»†èŠ‚ä¸æš´éœ²ç¬¬ä¸‰æ–¹å·¥ç¨‹åã€‚

#### 2.3.5 Tools ä¸ Provider çš„å…³ç³»

ä¸Šå±‚çš„ **Tool** ä¸åº•å±‚çš„ **Provider** åˆ†å±‚å¦‚ä¸‹ï¼š

- Toolï¼ˆç”± `ToolRouter` ç®¡ç†ï¼‰ï¼š
  - é¢å‘ AliceAgentCore æš´éœ²ï¼š`name` / `description` / `input_schema` / `output_schema` / `scope`ã€‚
  - handler å†…éƒ¨åªè°ƒç”¨é¢†åŸŸæœåŠ¡ï¼Œä¾‹å¦‚ `QAService`ã€`KnowledgeGraphService`ã€`TimelineService` ç­‰ã€‚
  - Agent åªçœ‹åˆ° "ask_video" / "search_videos" / "search_graph" è¿™ç±»è¯­ä¹‰åŒ–å·¥å…·ï¼Œä¸å…³å¿ƒç”¨çš„æ˜¯å“ªå®¶äº‘ã€å“ªç§æ¨¡å‹ã€‚

- Providerï¼ˆåœ¨ `services/ai`ã€`services/asr`ã€`packages/config` ä¸­ï¼‰ï¼š
  - ä¾‹å¦‚ï¼š`LLMProvider`ã€`ASRProvider`ã€`EmbeddingProvider`ã€`RAGProvider`ã€‚
  - é€šè¿‡ç§Ÿæˆ·çº§ `TenantConfig` ä¸­çš„ `llm.*` / `asr.*` / `rag.*` é…ç½®é€‰æ‹©å…·ä½“å®ç°ï¼š
    - LLM: OpenAI / Claude / DeepSeek / æœ¬åœ° Ollama ...
    - ASR: Whisper æœ¬åœ° / Faster-Whisper / è®¯é£ / é˜¿é‡Œ / OpenAI Whisper API ...
    - RAG: RAGFlow / Chromaï¼ˆé™çº§ï¼‰

è¿™å±‚åˆ†ç¦»å¸¦æ¥çš„æ•ˆæœï¼š

- **åˆ‡æ¢åº•å±‚ Provider æ—¶**ï¼šåªæ”¹é…ç½®ï¼ˆæˆ– Provider å±‚å®ç°ï¼‰ï¼ŒTool å’Œ Agent è¡Œä¸ºä¿æŒç¨³å®šã€‚
- **æ–°å¢ä¸€ç§ Provider æ—¶**ï¼šåªéœ€è¦åœ¨ Provider å±‚æ³¨å†Œæ–°çš„å®ç°ï¼Œä¸éœ€è¦æ”¹ Agent è„‘å­ã€‚
- **å¤šç§Ÿæˆ·å·®å¼‚åŒ–**ï¼šä¸åŒç§Ÿæˆ·å¯ä»¥é…ç½®ä¸åŒ provider / æ¨¡å‹ï¼Œä½†ç”¨çš„ä»ç„¶æ˜¯ç›¸åŒçš„å·¥å…·é›†åˆã€‚

#### 2.3.6 å®¹é”™ä¸é™çº§ç­–ç•¥

Alice One + Agent å±‚å¯¹é”™è¯¯çš„å¤„ç†ç­–ç•¥ï¼š

- **Tool è°ƒç”¨çº§é”™è¯¯**ï¼ˆå•ä¸ªå·¥å…·å¤±è´¥ï¼‰ï¼š
  - å·¥å…· handler å†…æ•è·é¢†åŸŸæœåŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼Œè½¬åŒ–ä¸ºç»“æ„åŒ– observationï¼Œä¾‹å¦‚ï¼š
    - `{ "error": "RAGFlow timeout", "fallback": "chroma" }`
  - AliceAgentCore ä»ç„¶æŠŠè¿™ä¸ª observation ä½œä¸ºä¸€æ­¥ `AgentStep` è®°å½•ä¸‹æ¥ï¼Œ
    æ—¢æ–¹ä¾¿è°ƒè¯•ï¼Œä¹Ÿå…è®¸åç»­å°è¯•å…¶å®ƒå·¥å…·æˆ–å‘ç”¨æˆ·è§£é‡Šå¤±è´¥åŸå› ã€‚

- **Provider çº§é™çº§**ï¼š
  - RAGï¼šä¼˜å…ˆèµ° RAGFlowï¼Œå½“ RAGFlow ä¸å¯ç”¨æˆ–è¶…æ—¶æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ°æœ¬åœ° Chromaï¼ˆè§ `config/rag.yaml` çš„ `fallback` å­—æ®µï¼‰ã€‚
  - LLMï¼šå¦‚æœæŸä¸ªç§Ÿæˆ·é…ç½®çš„ä¸»æ¨¡å‹ä¸å¯ç”¨ï¼Œå¯åœ¨ Provider å±‚å®šä¹‰å¤‡ç”¨æ¨¡å‹ï¼ˆä¾‹å¦‚ä» gpt-4o é™çº§åˆ° gpt-4o-miniï¼‰ã€‚
  - ASRï¼šé•¿è§†é¢‘æˆ–æŒ‡å®šè¯­è¨€æ—¶ï¼ŒæŒ‰è§„åˆ™è‡ªåŠ¨åˆ‡æ¢åˆ°æ›´åˆé€‚çš„ Providerï¼ˆå·²æœ‰çš„ `asr.auto_switch` æœºåˆ¶ï¼‰ã€‚

- **Agent çº§é˜²å¾¡**ï¼š
  - ä¸º Agent å¾ªç¯è®¾ç½®ï¼š
    - æœ€å¤§æ­¥æ•°ï¼ˆMAX_STEPSï¼‰ï¼Œé˜²æ­¢æ­»å¾ªç¯ã€‚
    - æ€»è¶…æ—¶ï¼ˆper-run timeoutï¼‰ï¼Œé˜²æ­¢å•æ¬¡è¯·æ±‚æ‹–å®ç³»ç»Ÿã€‚
  - å½“è¿ç»­å¤šæ¬¡å·¥å…·è°ƒç”¨å¤±è´¥æ—¶ï¼ŒAgent ç›´æ¥ç”Ÿæˆã€Œå¤±è´¥è§£é‡Šã€å›ç­”ï¼Œå¹¶æç¤ºç”¨æˆ·ç¨åé‡è¯•æˆ–æ”¹å†™é—®é¢˜ã€‚

é€šè¿‡è¿™äº›ç­–ç•¥ï¼ŒAlice One èƒ½åœ¨åº•å±‚ç»„ä»¶ä¸ç¨³å®šæ—¶ï¼Œå°½å¯èƒ½ç»™å‡ºå¯è§£é‡Šçš„ç»“æœï¼Œ
è€Œä¸æ˜¯ç›´æ¥åœ¨ç”¨æˆ·ä½“éªŒå±‚é¢â€œé™é»˜å¤±è´¥â€ã€‚

#### 2.3.7 å¤šå…¥å£ç»Ÿä¸€å¥‘çº¦ä¸å‰ç«¯é›†æˆ

æ‰€æœ‰å…¥å£ï¼ˆWeb / å¾®ä¿¡ / MCP / æœªæ¥ç§»åŠ¨ç«¯ï¼‰ä¸åç«¯çš„ç»Ÿä¸€å¥‘çº¦æ˜¯ `AgentTask`ï¼š

- å¿…å¡«å­—æ®µï¼š`tenant_id`ã€`scene`ã€`query`
- å¯é€‰å­—æ®µï¼š`user_id`ã€`video_id`ã€`selection`ï¼ˆé€‰ä¸­æ–‡æœ¬/èŠ‚ç‚¹ï¼‰ã€`extra_context`ï¼ˆå‰ç«¯ç‰¹æœ‰ä¿¡æ¯ï¼‰

å‰ç«¯çš„èŒè´£æ˜¯æ ¹æ®å½“å‰é¡µé¢è·¯ç”±å’Œç”¨æˆ·æ“ä½œï¼Œæ­£ç¡®æ„é€ è¿™äº›å­—æ®µï¼›
åç«¯ä»ä¸å…³å¿ƒã€Œè¿™ä¸ªè¯·æ±‚æ¥è‡ªå“ªç§ UIã€ï¼Œåªå…³å¿ƒï¼šè¿™æ˜¯å“ªä¸ªç§Ÿæˆ·ã€åœ¨å“ªä¸ªåœºæ™¯ã€åœ¨é—®ä»€ä¹ˆé—®é¢˜ã€‚

è¿™ä¿è¯äº†ï¼š

- æ–°å¢ä¸€ä¸ªå…¥å£ï¼ˆæ¯”å¦‚ VSCode æ’ä»¶ï¼‰æ—¶ï¼Œåªè¦èƒ½æŒ‰çº¦å®šæ„é€  `AgentTask`ï¼Œå°±å¯ä»¥ç«‹åˆ»å¤ç”¨ Alice One + Agent å…¨é“¾è·¯ã€‚
- å‰ç«¯åªéœ€è¦å®ç°ç»Ÿä¸€çš„ç»“æœæ¸²æŸ“ï¼ˆanswer + citations + steps?ï¼‰ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ä¸ªå…¥å£å®šåˆ¶é—®ç­”/æ£€ç´¢é€»è¾‘ã€‚

#### 2.3.8 ä¸ 1204PLAN / AGENT_RESEARCH çš„å¯¹åº”å…³ç³»

æœ¬è®¾è®¡ä¸æ„¿æ™¯/ç ”ç©¶æ–‡æ¡£ä¸­çš„è§„åˆ’ä¸€ä¸€å¯¹åº”ï¼š

- **1204PLAN / Alice One èƒ½åŠ›å±‚**ï¼š
  - AliceIdentityService â‰ˆ ã€ŒAlice èº«ä»½ / äººæ ¼ã€æœåŠ¡
  - TimelineService â‰ˆ ã€Œç»Ÿä¸€æ—¶é—´çº¿ã€ä¸äº‹ä»¶è®°å½•
  - ContextAssembler â‰ˆ ã€Œä¸Šä¸‹æ–‡æ‹¼è£…å™¨ã€ï¼Œè´Ÿè´£ä»çŸ¥è¯†ã€æ—¶é—´çº¿ã€å¯¹è¯ä¸­æŠ½å–åˆé€‚çš„ä¿¡æ¯ç»™ Alice One ä½¿ç”¨

- **AGENT_RESEARCH ä¸­çš„ç®€åŒ– Agent å»ºè®®**ï¼š
  - é‡‡ç”¨è‡ªå»ºç®€åŒ–ç‰ˆ ReAct å¾ªç¯ï¼ˆAgentOrchestratorï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸Šæ¥å¼•å…¥å¤æ‚ Agent æ¡†æ¶ï¼›
  - ä»¥ OpenAI Function Calling ä¸ºå·¥å…·è°ƒç”¨åè®®ï¼Œç”± ToolRouter æŠŠé¢†åŸŸæœåŠ¡åŒ…è£…æˆå·¥å…·ï¼›
  - é€šè¿‡ AgentRun / AgentStep / EvalCase çš„æ•°æ®ç»“æ„ï¼Œä¸ºåç»­è¯„ä¼°ä¸å¯è§‚æµ‹æ€§æ‰“åŸºç¡€ã€‚

æ¢å¥è¯è¯´ï¼šå½“å‰ DESIGN ä¸­çš„ Alice One + Agent æ¶æ„ï¼Œå°±æ˜¯å°† vision æ–‡æ¡£é‡Œçš„è§„åˆ’
è½å®ä¸ºã€Œå¯è½åœ°çš„åˆ†å±‚ä»£ç ç»“æ„ã€ï¼Œè€Œä¸æ˜¯åœç•™åœ¨æ¦‚å¿µå±‚çš„ã€Œå¤§å›¾ã€ã€‚

#### 2.3.9 Tools / Service / Provider / MCP åˆ†å±‚è§„èŒƒ

> ç›®çš„ï¼šæŠŠã€ŒAlice One + Agentã€å±‚å’Œç°æœ‰ backend åˆ†å±‚ç»Ÿä¸€èµ·æ¥ï¼Œ  
> é¿å…ä»¥åæ‰€æœ‰ä¸œè¥¿éƒ½å¾€ Tool/MCP é‡Œå¡ï¼Œå˜æˆä¸å¯ç»´æŠ¤çš„å¾®å†…æ ¸åœ°ç‹±ã€‚

##### ä¸€ã€ä¸€å¥è¯å®šä¹‰

- **Service**ï¼šAlice çœŸÂ·ä¼šåšçš„äº‹  
  ä¸‹è½½ã€è½¬å†™ã€åˆ†æã€æ£€ç´¢ã€å›¾è°±ã€æ—¶é—´çº¿ã€é€šçŸ¥â€¦â€¦æ‰€æœ‰çœŸå®ä¸šåŠ¡æµç¨‹å’Œèµ„æºæ“ä½œéƒ½åœ¨è¿™é‡Œå®Œæˆã€‚

- **Tool**ï¼šæŠŠ Serviceï¼ˆæˆ–å…¶ä»–èƒ½åŠ›ï¼‰åšæˆã€ŒLLM å¯è°ƒç”¨çš„æŒ‰é’®ã€  
  ç»™ Agent/LLM çœ‹çš„ä¸€å±‚ï¼Œæœ‰ `name / description / parameters` schemaï¼Œå†…éƒ¨åªè°ƒ Serviceã€‚

- **MCP**ï¼šä¸€ç§"è¿œç¨‹å·¥å…·åè®®"  
  - æˆ‘å»ç”¨åˆ«äººçš„ MCP å·¥å…·ï¼ˆAlice ä½œä¸º MCP Clientï¼‰  
  - æˆ‘æŠŠè‡ªå·±çš„èƒ½åŠ›æš´éœ²ä¸º MCP å·¥å…·ï¼ˆAlice ä½œä¸º MCP Serverï¼‰  

åœ¨æ¶æ„å±‚é¢ï¼ŒMCP åªæ˜¯èƒ½åŠ›æ¥æºçš„ä¸€ç§å½¢å¼ï¼Œæœ€ç»ˆéƒ½è¢«åŒ…è£…æˆ Tool ä¾› Agent ä½¿ç”¨ã€‚

---

##### äºŒã€å†…éƒ¨ä¸–ç•Œï¼šå‰ç«¯ / Agent å¦‚ä½•ç”¨è‡ªå®¶ Service / Tool

å†…éƒ¨ä»ä¸Šåˆ°ä¸‹çš„è°ƒç”¨é“¾ï¼Œå¯¹åº”ç°æœ‰ä»£ç ç›®å½•ï¼š

1. **å‰ç«¯ / Clients**
   - Webï¼ˆapps/webï¼‰ã€æœªæ¥çš„å¾®ä¿¡ã€CLIã€Claude Desktopï¼ˆé€šè¿‡ MCPï¼‰ç­‰ã€‚
   - åªè°ƒç”¨ HTTP / WebSocketï¼Œä¸æ„ŸçŸ¥ Tool / Service ç»†èŠ‚ã€‚

2. **API Gateway + ä¼šè¯ / é‰´æƒï¼ˆapps/api/routersï¼‰**
   - ä¾‹å¦‚ `/api/chat`ã€`/api/agent/*` ç­‰è·¯ç”±ã€‚
   - è´Ÿè´£è®¤è¯ã€ç§Ÿæˆ·è§£æã€åŸºç¡€å¼‚å¸¸å¤„ç†ã€‚

3. **Conversation / Task APIï¼ˆapps/api/services ä¸­çš„åº”ç”¨å±‚ Serviceï¼‰**
   - æŠŠ HTTP è¯·æ±‚è½¬æˆå†…éƒ¨ DTO / AgentTaskï¼š
     - å¦‚ï¼š`ChatService` / `AgentTaskService`ã€‚
   - é¢å‘ä¸šåŠ¡ï¼šè¿™æ˜¯ä¸€æ¡ Chat è¯·æ±‚ï¼Ÿè¿˜æ˜¯ä¸€ä¸ª Agent ä»»åŠ¡ï¼Ÿ

4. **Alice One å±‚ï¼ˆalice/one/*ï¼‰**
   - Alice One å®ç°ä½äº `alice/one/`ï¼Œé€šè¿‡ Application Services (apps/api/services) å¯¹å¤–æš´éœ²ã€‚
   - **AliceIdentityService** (`alice/one/identity.py`)ï¼š  
     ä» `TenantConfig.alice.*` ç”Ÿæˆ persona / å·¥å…·ç™½åå• / åœºæ™¯ä¿¡æ¯ã€‚
   - **ContextAssembler** (`alice/one/context.py`)ï¼š  
     åŸºäº AgentTask + å†å²å¯¹è¯ + å‘é‡æ£€ç´¢ + å›¾è°± + Timeline æ‹¼è£… messages + åˆå§‹ä¸Šä¸‹æ–‡ã€‚

5. **AliceAgentCoreï¼ˆAgent å¤§è„‘ï¼Œalice/agentï¼‰**
   - åªè®¤ä¸¤ä»¶äº‹ï¼š
     - ä¸€ä¸ªæ”¯æŒ function calling çš„ LLMï¼›
     - ä¸€ç»„å¯ç”¨çš„ Toolsï¼ˆæ¥è‡ª ToolRouterï¼‰ã€‚
   - è´Ÿè´£å• Agent ReAct å¾ªç¯ï¼š
     - LLM è¾“å‡º thought + tool_callsï¼›
     - é¡ºåºæ‰§è¡Œ Toolï¼›
     - æ”¶é›† observationï¼Œå†å–‚å› LLMã€‚
   - **ä¸å…è®¸**åœ¨è¿™é‡Œç›´æ¥è°ƒç”¨ VideoService / QAService / Provider / MCP Clientã€‚

6. **Tool Layerï¼ˆæŒ‰é’®å±‚ï¼Œalice/agent/tools/*ï¼‰**
   - å¯¹ LLM/Agent æš´éœ²çš„æ¯ä¸€ä¸ªã€ŒæŒ‰é’®ã€ï¼š
     - `search_videos`
     - `get_video_detail`
     - `ask_knowledge`
     - `compare_videos`
     - `timeline_query`
     - `generate_report`
     - ç­‰ã€‚
   - ä¸€ä¸ª Tool handler çš„èŒè´£ï¼š
     - è§£æ + æ ¡éªŒ LLM ä¼ å…¥çš„å‚æ•°ï¼›
     - è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ª **é¢†åŸŸ Service**ï¼ˆservices/*ï¼‰ï¼›
     - æŠŠè¿”å›å€¼è½¬æˆå¹²å‡€ã€ç»“æ„åŒ–çš„ JSON ç»“æœã€‚

7. **Service Layerï¼ˆæœ¬äº‹å±‚ï¼Œservices/*ï¼‰**
   - çœŸæ­£å¹²æ´»çš„ä¸šåŠ¡å®ç°ï¼š
     - `services/watcher`ï¼šæ”¶è—å¤¹æ‰«æã€ä»»åŠ¡ä¸‹å‘ï¼›
     - `services/processor`ï¼šä¸‹è½½ / æŠ½éŸ³é¢‘ / ASR / æ–‡æœ¬é¢„å¤„ç†ï¼›
     - `services/asr`ï¼šå¯¹æ¥ä¸åŒ ASR Providerï¼›
     - `services/ai`ï¼šRAG / é—®ç­” / æ‘˜è¦ / æŠ¥å‘Šï¼›
     - `services/knowledge`ï¼šæ¦‚å¿µæŠ½å– / çŸ¥è¯†å›¾è°±æ“ä½œï¼›
     - `alice/one`ï¼šAliceIdentityService / ContextAssembler / TimelineServiceï¼›
     - `alice/search`ï¼šSearchAgentServiceï¼ˆæ·±åº¦ Web æœç´¢ / å¤šæºèšåˆé€»è¾‘ï¼‰ï¼›
     - `services/notifier`ï¼šé€šçŸ¥æ¸ é“ï¼›
     - â€¦â€¦
   - **æ³¨**ï¼šSearchAgentService æ ¸å¿ƒå®ç°ä½äº `alice/search/search_agent.py`ï¼Œä¾› `deep_web_research` Tool è°ƒç”¨ã€‚  
   - å¯ä»¥æ˜¯é•¿è€—æ—¶ã€æœ‰å‰¯ä½œç”¨ï¼ˆå†™ DB / å†™æ–‡ä»¶ / è°ƒå¤–éƒ¨ APIï¼‰ï¼Œé€šè¿‡é˜Ÿåˆ— / Scheduler é©±åŠ¨ã€‚

8. **Provider / åŸºç¡€è®¾æ–½å±‚**
   - `packages/rag`ã€`packages/db`ã€`services/ai` å†…éƒ¨çš„ Providerã€å¤–éƒ¨ APIï¼š
     - RAGFlow / ChromaDB / Qdrantï¼›
     - OpenAI / Claude / DeepSeekï¼›
     - Whisper / å…¶ä»– ASR APIï¼›
     - æ–‡ä»¶å­˜å‚¨ / DBï¼›
     - æœªæ¥çš„ MCP Clientï¼ˆå¤–éƒ¨ MCP Serversï¼‰ã€‚
   - ä¸åŒ…å«ä¸šåŠ¡è¯­ä¹‰ï¼Œä¸“æ³¨ã€Œå¦‚ä½•è¿ã€ã€Œæ€ä¹ˆè°ƒç”¨ã€ã€Œæ€ä¹ˆé™çº§ã€ã€‚

---

##### ä¸‰ã€è§†é¢‘åˆ†æä»»åŠ¡çš„å½’å±

- **Pipeline åˆ†æï¼ˆä¸‹è½½ / è½¬å†™ / åˆ†æ / å‘é‡åŒ–ï¼‰ï¼šä¸€å¾‹å½’ Serviceï¼Œä¸å½’ Tool**
  - ç”± `services/downloader`ã€`services/processor`ã€`services/asr` ç­‰è´Ÿè´£ï¼›
  - ä»»åŠ¡è°ƒåº¦å’Œé‡è¯•é€šè¿‡é˜Ÿåˆ— / Scheduler å¤„ç†ï¼›
  - ç‰¹ç‚¹ï¼šè€—æ—¶é•¿ã€IO å¯†é›†ã€é”™è¯¯/é‡è¯•é€»è¾‘å¤æ‚ã€‚

- **Tool åªåšä¸¤ä»¶äº‹ï¼šè¯»ç»“æœ + æ’é˜Ÿ**
  - è¯»ç»“æœç±» Toolï¼š
    - `ask_video` / `search_videos` / `compare_videos` / `summarize_range` ç­‰ï¼š
      - åªè¯»å– Video / Transcript / Summary / Concept / å‘é‡ / å›¾è°±ç­‰å·²æœ‰æ•°æ®ï¼›
      - ä¸è§¦å‘å®Œæ•´å¤„ç† Pipelineã€‚
  - æ§åˆ¶ç±» Toolï¼ˆå¦‚éœ€ Agent è§¦å‘å¤„ç†ï¼‰ï¼š
    - `request_video_analysis(video_id)`ï¼š
      - å†…éƒ¨åªå‘é˜Ÿåˆ—æ¨é€ä¸€ä¸ªä»»åŠ¡ IDï¼›
      - è¿”å› `task_id/status`ï¼Œä¸åœ¨ Tool ä¸­åŒæ­¥è·‘å®Œå…¨éƒ¨æµç¨‹ã€‚

---

##### å››ã€MCP åœ¨æ¶æ„ä¸­çš„ä½ç½®

1. **Alice ä½œä¸º MCP Serverï¼ˆå¯¹å¤–æš´éœ²èƒ½åŠ›ï¼‰**
   - åœ¨ `services/mcp` ä¸­ï¼ŒæŠŠä¸€éƒ¨åˆ†å†…éƒ¨ Tool/Service æš´éœ²ä¸º MCP å·¥å…·ï¼š
     - ä¾‹å¦‚ï¼š`search_videos`, `ask_knowledge`, `get_timeline_summary` ç­‰ã€‚
   - å¤–éƒ¨ Agent è°ƒç”¨è·¯å¾„ï¼š
     - MCP Toolï¼ˆå¤–éƒ¨è§†è§’ï¼‰â†’ æˆ‘ä»¬çš„ MCP Server â†’ å†…éƒ¨ Tool â†’ Service â†’ Providerã€‚
   - è§„èŒƒï¼šå¯¹å¤– MCP ä¸å¼•å…¥æ–°ä¸šåŠ¡æ¨¡å‹ï¼Œåªæ˜¯ç°æœ‰èƒ½åŠ›çš„åè®®åŒ…è£…ã€‚

2. **Alice ä½œä¸º MCP Clientï¼ˆæ¶ˆè´¹å¤–éƒ¨ MCP èƒ½åŠ›ï¼Œæœªæ¥æ‰©å±•ï¼‰**
   - å¤–éƒ¨ MCP Server è¢«è§†ä¸ºä¸€ç§ Providerï¼š
     - ç”± MCP Client å°è£…è¿æ¥ / é‰´æƒ / åè®®ï¼›
     - å°è£…åœ¨æŸä¸ª Service é‡Œï¼ˆå¦‚ `WebSearchService`ã€`NotionService`ã€`GithubService`ï¼‰ã€‚
   - å†…éƒ¨ Tool è°ƒç”¨è¿™äº› Serviceï¼Œå°±åƒè°ƒç”¨æœ¬åœ° Service ä¸€æ ·ï¼š
     - å¯¹ Agent/LLM è€Œè¨€ï¼Œåªæ˜¯å¤šäº†ä¸€äº› Toolï¼š
       - `web_search` / `notion_search` / `github_search_repo` â€¦
   - å…³é”®ç‚¹ï¼š**Agent ä¸æ„ŸçŸ¥"æ˜¯ä¸æ˜¯ MCP"ï¼Œåªçœ‹åˆ°å¹³å¦çš„ tools[] åˆ—è¡¨**ã€‚

---

##### äº”ã€è®¾è®¡é“å¾‹ï¼ˆçº¦æŸï¼‰

1. **é“å¾‹ 1ï¼šService å†™å®äº‹ï¼ŒTool åªåšé€‚é…**
   - æ‰€æœ‰çœŸå®ä¸šåŠ¡æµç¨‹ã€èµ„æºæ“ä½œã€ä¸€è‡´æ€§çº¦æŸï¼Œéƒ½å†™åœ¨ Service / Job / Pipeline å±‚ï¼›
   - Tool åªè´Ÿè´£ï¼š
     - è§£æå‚æ•°ï¼›
     - è°ƒç”¨ Serviceï¼›
     - æ•´ç†ç»“æœç»™ LLMã€‚

2. **é“å¾‹ 2ï¼šAliceAgentCore åªè®¤ Tool + LLM**
   - AliceAgentCore ä¸­ç¦æ­¢ç›´æ¥è°ƒç”¨ Service / Provider / MCP Clientï¼›
   - æ‰€æœ‰èƒ½åŠ›éƒ½å¿…é¡»é€šè¿‡ Tool æš´éœ²ã€‚

3. **é“å¾‹ 3ï¼šé•¿è€—æ—¶ / é‡å‰¯ä½œç”¨é€»è¾‘ä¸å¾—å‡ºç°åœ¨ Tool / Agent å±‚**
   - ä¸‹è½½ã€ASRã€Embeddingã€æ‰¹é‡åˆ†æç­‰ï¼Œå¿…é¡»åœ¨ Service/Job å±‚å®Œæˆï¼›
   - Tool æœ€å¤šåªè§¦å‘ã€Œæ’é˜Ÿã€æˆ–ã€ŒæŸ¥çœ‹è¿›åº¦ã€ã€‚

4. **é“å¾‹ 4ï¼šTool ä¸ç›´æ¥ç¢° Provider**
   - Providerï¼ˆOpenAI / Claude / ASR / RAGFlow / MCP Client ç­‰ï¼‰åªèƒ½è¢« Service ä½¿ç”¨ï¼›
   - Tool åªèƒ½è°ƒ Serviceï¼›
   - é™çº§ / é‡è¯• / ç›‘æ§é€»è¾‘å…¨éƒ¨åœ¨ Service / Provider å±‚è§£å†³ã€‚

5. **é“å¾‹ 5ï¼šMCP æ˜¯ Tool çš„å®ç°ç»†èŠ‚ï¼Œä¸æ˜¯æ–°æ¶æ„å±‚**
   - ä¸åœ¨ Agent å±‚å‡ºç°ã€Œè¿™æ˜¯ MCP å·¥å…· / é‚£æ˜¯æœ¬åœ°å·¥å…·ã€çš„åˆ†æ”¯ï¼›
   - æ³¨å†Œåˆ° Agent çš„å°±æ˜¯ç»Ÿä¸€çš„ `tools[]` åˆ—è¡¨ï¼ŒèƒŒåç”± Local Service æˆ– MCP Provider å®ç°ï¼›
   - è¿™æ ·å³ä¾¿å¤§è§„æ¨¡å¼•å…¥å¤–éƒ¨ MCPï¼Œæ•´ä½“æ¶æ„å¤æ‚åº¦ä»ç„¶å¯æ§ã€‚

---

##### å…­ã€SearchAgent ä¸æ·±åº¦ Web æœç´¢

ä¸ºäº†æ”¯æŒã€Œåƒäººä¸€æ ·ä¸Šç½‘æŸ¥èµ„æ–™ã€çš„èƒ½åŠ›ï¼Œç³»ç»Ÿå†…éƒ¨å®ç°ä¸€ä¸ª **SearchAgentService**ï¼Œå¹¶é€šè¿‡ Tool æš´éœ²ç»™ Agentã€‚

**å¯¹ Agent è€Œè¨€**ï¼šåªçœ‹åˆ°ä¸€ä¸ª Toolï¼š`deep_web_research`ã€‚

**å…¶ handler å†…éƒ¨å®ç°å¤šæ­¥æµç¨‹**ï¼š

1. **QueryInterpreter**ï¼šç†è§£ / é‡å†™ç”¨æˆ·é—®é¢˜ï¼Œæå–æ ¸å¿ƒæ„å›¾ï¼›
2. **QueryDecomposer**ï¼šç”Ÿæˆå¤šä¸ªå­æŸ¥è¯¢ï¼ˆé’ˆå¯¹ä¸åŒè§’åº¦æˆ–ä¿¡æ¯æºï¼‰ï¼›
3. **WebFetcher**ï¼šå¯¹æ¯ä¸ªå­æŸ¥è¯¢æ‰§è¡Œ Web æœç´¢ + æŠ“å–ç½‘é¡µæ­£æ–‡ï¼›
4. **PageAnalyzer**ï¼šä»ç½‘é¡µä¸­æŠ½å–ç»“è®º / å…³é”®å¥ / å…ƒæ•°æ®ï¼›
5. **EvidenceAggregator**ï¼šå¯¹å¤šæºç»“æœå»é‡ / èšåˆï¼›
6. **AnswerSynthesizer**ï¼šç”¨ LLM ç”Ÿæˆç»¼åˆå›ç­” + å¼•ç”¨åˆ—è¡¨ã€‚

**è°ƒç”¨å…³ç³»**ï¼š

```text
AliceAgentCore
  â””â”€(ResearchStrategy)â”€> TaskPlanner è®¡åˆ’ä½¿ç”¨ deep_web_research
                          â””â”€ ToolExecutor è°ƒç”¨ ToolRouter.deep_web_research()
                              â””â”€ SearchAgentService.run(...)  # å¤šæ­¥æœç´¢/èšåˆ
```

**è®¾è®¡è¦ç‚¹**ï¼š

- **SearchAgent æ˜¯ Service + Tool çš„ç»„åˆï¼Œä¸æ˜¯æ–°çš„ Engine**ï¼›
- å†…éƒ¨é‡‡ç”¨ã€Œå¤šå­æŸ¥è¯¢ â†’ å¤šè·¯æ£€ç´¢ â†’ èšåˆè¯æ® â†’ ç»¼åˆå›ç­”ã€çš„æ¨¡å¼ï¼ˆå‚è€ƒ MindSearch ç­‰å…¬å¼€ç ”ç©¶ï¼‰ï¼Œ
  ä½†å¯¹ Agent æ¥è¯´åªæ˜¯ä¸€ä¸ª `deep_web_research` Toolï¼›
- è¿™å¥—æµç¨‹çš„å®ç°ä¼šå‚è€ƒå½“å‰å…¬å¼€ç ”ç©¶ï¼ˆå¦‚å¤š Agent Web æœç´¢ / æ‹†è§£-æ£€ç´¢-èšåˆèŒƒå¼ï¼‰ï¼Œ
  ä½†åœ¨ä»£ç ç»“æ„å’Œå‘½åä¸Šå®Œå…¨å†…åŒ–ä¸º Alice è‡ªå·±çš„æ¨¡å—ï¼Œä¸æš´éœ²ç¬¬ä¸‰æ–¹å·¥ç¨‹åï¼›
- æ·±åº¦ Web æœç´¢å±äº **Service å±‚**èƒ½åŠ›ï¼Œå¯¹ Agent æš´éœ²ä¸º Toolï¼›
  Agent ä¸ Provider ä¸ç›´æ¥äº¤äº’ï¼Œåªé€šè¿‡ Tool è°ƒç”¨ Serviceï¼Œç”± Service å†è°ƒç”¨åº•å±‚ HTTP / MCP Client / æŠ“å–é€»è¾‘ã€‚

---
## 3. æ•°æ®æ¨¡å‹

### 3.1 æ•°æ®åº“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Relational DB (SQLite/PostgreSQL)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Tenant    â”‚â”€â”€â”¬â”€â”€â–ºâ”‚    User     â”‚      â”‚   Config    â”‚     â”‚
â”‚  â”‚  (ç§Ÿæˆ·è¡¨)   â”‚  â”‚   â”‚  (ç”¨æˆ·è¡¨)   â”‚      â”‚  (é…ç½®è¡¨)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                   â”‚                                             â”‚
â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                   â”œâ”€â”€â–ºâ”‚   Video     â”‚â—„â”€â”€â”€â”€â–ºâ”‚    Tag      â”‚     â”‚
â”‚                   â”‚   â”‚  (è§†é¢‘è¡¨)   â”‚      â”‚  (æ ‡ç­¾è¡¨)   â”‚     â”‚
â”‚                   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                   â”‚          â”‚                                  â”‚
â”‚                   â”‚          â–¼                                  â”‚
â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                   â”œâ”€â”€â–ºâ”‚WatchedFolderâ”‚      â”‚TimelineEventâ”‚     â”‚
â”‚                   â”‚   â”‚ (ç›‘æ§æ”¶è—å¤¹)â”‚      â”‚ (æ—¶é—´çº¿äº‹ä»¶)â”‚     â”‚
â”‚                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                   â”‚                                             â”‚
â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                   â”‚   â”‚         Agent & Eval ç›¸å…³è¡¨         â”‚  â”‚
â”‚                   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                   â”œâ”€â”€â–ºâ”‚ AgentRun   â”‚ AgentStep â”‚ AgentResultâ”‚  â”‚
â”‚                   â”‚   â”‚ (è¿è¡Œè®°å½•) â”‚ (æ‰§è¡Œæ­¥éª¤)â”‚ (è¿è¡Œç»“æœ) â”‚  â”‚
â”‚                   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                   â””â”€â”€â–ºâ”‚ EvalCase   â”‚ EvalResultâ”‚            â”‚  â”‚
â”‚                       â”‚ (è¯„æµ‹ç”¨ä¾‹) â”‚ (è¯„æµ‹ç»“æœ)â”‚            â”‚  â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vector DB (ChromaDB/Qdrant)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Collection: {tenant_id}_video_chunks                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  id | video_id | chunk_idx | content | embedding | metadata â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  Collection: {tenant_id}_concepts                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  id | name | description | embedding | related_videos       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **æ³¨**ï¼š`LearningRecord` æ¼”è¿›ä¸º `TimelineEvent`ï¼Œæ–°å¢ `event_type` / `scene` / `context` å­—æ®µï¼Œ
> è¯¦è§ ROADMAP Phase B ä»»åŠ¡ã€‚

### 3.2 å¤šç§Ÿæˆ·ä¸ç”¨æˆ·æ¨¡å‹

```python
# packages/db/models/tenant.py

from sqlalchemy import Column, Integer, String, Boolean, DateTime, Enum, ForeignKey
from sqlalchemy.orm import relationship
from datetime import datetime
import enum

class TenantPlan(enum.Enum):
    FREE = "free"           # å…è´¹ç‰ˆ
    PRO = "pro"             # ä¸“ä¸šç‰ˆ
    TEAM = "team"           # å›¢é˜Ÿç‰ˆ
    ENTERPRISE = "enterprise"  # ä¼ä¸šç‰ˆ

class Tenant(Base):
    """ç§Ÿæˆ·/ç»„ç»‡"""
    __tablename__ = "tenants"
    
    id = Column(Integer, primary_key=True)
    name = Column(String(100))
    slug = Column(String(50), unique=True, index=True)  # å”¯ä¸€æ ‡è¯†ç¬¦
    
    # è®¢é˜…è®¡åˆ’
    plan = Column(Enum(TenantPlan), default=TenantPlan.FREE)
    plan_expires_at = Column(DateTime, nullable=True)
    
    # é…é¢é™åˆ¶
    max_videos = Column(Integer, default=100)         # æœ€å¤§è§†é¢‘æ•°
    max_storage_gb = Column(Integer, default=10)      # æœ€å¤§å­˜å‚¨GB
    max_users = Column(Integer, default=1)            # æœ€å¤§ç”¨æˆ·æ•°
    
    # çŠ¶æ€
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # å…³ç³»
    users = relationship("User", back_populates="tenant")
    videos = relationship("Video", back_populates="tenant")
    configs = relationship("TenantConfig", back_populates="tenant")


class UserRole(enum.Enum):
    OWNER = "owner"         # æ‰€æœ‰è€…
    ADMIN = "admin"         # ç®¡ç†å‘˜
    MEMBER = "member"       # æˆå‘˜
    VIEWER = "viewer"       # åªè¯»

class User(Base):
    """ç”¨æˆ·"""
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)
    
    # åŸºæœ¬ä¿¡æ¯
    email = Column(String(255), unique=True, index=True)
    username = Column(String(50))
    password_hash = Column(String(255), nullable=True)  # å¯é€‰ï¼Œæ”¯æŒOAuth
    
    # ç¬¬ä¸‰æ–¹ç»‘å®š
    wechat_openid = Column(String(100), nullable=True, index=True)
    bilibili_uid = Column(String(50), nullable=True)
    bilibili_sessdata = Column(Text, nullable=True)  # åŠ å¯†å­˜å‚¨
    
    # è§’è‰²ä¸æƒé™
    role = Column(Enum(UserRole), default=UserRole.MEMBER)
    
    # çŠ¶æ€
    is_active = Column(Boolean, default=True)
    last_login_at = Column(DateTime, nullable=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # å…³ç³»
    tenant = relationship("Tenant", back_populates="users")
    learning_records = relationship("LearningRecord", back_populates="user")


class TenantConfig(Base):
    """ç§Ÿæˆ·é…ç½®"""
    __tablename__ = "tenant_configs"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)
    
    key = Column(String(100))   # é…ç½®é”®
    value = Column(Text)        # é…ç½®å€¼ (JSON)
    
    # é…ç½®ç±»å‹
    # asr_provider, asr_config, llm_provider, llm_config,
    # notify_channels, watched_folders, etc.
    
    tenant = relationship("Tenant", back_populates="configs")
    
    __table_args__ = (
        UniqueConstraint('tenant_id', 'key', name='uq_tenant_config'),
    )
```

### 3.3 æ ¸å¿ƒä¸šåŠ¡æ¨¡å‹ï¼ˆç§Ÿæˆ·éš”ç¦»ï¼‰

```python
# packages/db/models/video.py

class VideoStatus(enum.Enum):
    PENDING = "pending"           # å¾…å¤„ç†
    DOWNLOADING = "downloading"   # ä¸‹è½½ä¸­
    TRANSCRIBING = "transcribing" # è½¬å†™ä¸­
    ANALYZING = "analyzing"       # AIåˆ†æä¸­
    DONE = "done"                 # å®Œæˆ
    FAILED = "failed"             # å¤±è´¥

class Video(Base):
    __tablename__ = "videos"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)  # ç§Ÿæˆ·éš”ç¦»
    
    # è§†é¢‘ä¿¡æ¯
    bvid = Column(String(20), index=True)
    title = Column(String(500))
    author = Column(String(100))
    duration = Column(Integer)  # ç§’
    cover_url = Column(String(500))
    source_url = Column(String(500))
    source_type = Column(String(20), default="bilibili")  # bilibili/youtube/local
    
    # å¤„ç†çŠ¶æ€
    status = Column(Enum(VideoStatus), default=VideoStatus.PENDING)
    error_message = Column(Text, nullable=True)
    retry_count = Column(Integer, default=0)
    
    # æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºç§Ÿæˆ·ç›®å½•ï¼‰
    video_path = Column(String(500), nullable=True)
    audio_path = Column(String(500), nullable=True)
    transcript_path = Column(String(500), nullable=True)
    
    # AIç”Ÿæˆå†…å®¹
    summary = Column(Text, nullable=True)
    key_points = Column(Text, nullable=True)        # JSON
    concepts = Column(Text, nullable=True)          # JSON
    
    # å¤„ç†é…ç½®ï¼ˆè¦†ç›–ç§Ÿæˆ·é»˜è®¤ï¼‰
    asr_provider = Column(String(50), nullable=True)
    llm_provider = Column(String(50), nullable=True)
    
    # æ—¶é—´æˆ³
    collected_at = Column(DateTime)
    processed_at = Column(DateTime, nullable=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, onupdate=datetime.utcnow)
    
    # å…³ç³»
    tenant = relationship("Tenant", back_populates="videos")
    tags = relationship("VideoTag", back_populates="video")
    
    # å¤åˆå”¯ä¸€çº¦æŸï¼šåŒä¸€ç§Ÿæˆ·ä¸‹bvidå”¯ä¸€
    __table_args__ = (
        UniqueConstraint('tenant_id', 'bvid', name='uq_tenant_video'),
        Index('ix_tenant_status', 'tenant_id', 'status'),
    )


class Tag(Base):
    __tablename__ = "tags"
    
    id = Column(Integer, primary_key=True)
    name = Column(String(50), unique=True)
    category = Column(String(50))  # é¢†åŸŸåˆ†ç±»
    
    videos = relationship("VideoTag", back_populates="tag")


class VideoTag(Base):
    __tablename__ = "video_tags"
    
    video_id = Column(Integer, ForeignKey("videos.id"), primary_key=True)
    tag_id = Column(Integer, ForeignKey("tags.id"), primary_key=True)
    confidence = Column(Float, default=1.0)  # AIæ ‡ç­¾ç½®ä¿¡åº¦
    
    video = relationship("Video", back_populates="tags")
    tag = relationship("Tag", back_populates="videos")


class WatchedFolder(Base):
    """ç›‘æ§çš„æ”¶è—å¤¹"""
    __tablename__ = "watched_folders"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)  # ç§Ÿæˆ·éš”ç¦»
    
    folder_id = Column(String(50))
    folder_type = Column(String(20))  # favlist / season / subscription
    name = Column(String(200))
    platform = Column(String(20), default="bilibili")  # bilibili / youtube
    
    last_scan_at = Column(DateTime)
    is_active = Column(Boolean, default=True)
    
    __table_args__ = (
        UniqueConstraint('tenant_id', 'folder_id', name='uq_tenant_folder'),
    )


class LearningRecord(Base):
    """å­¦ä¹ è®°å½•"""
    __tablename__ = "learning_records"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)
    user_id = Column(Integer, ForeignKey("users.id"), index=True)
    video_id = Column(Integer, ForeignKey("videos.id"))
    
    action = Column(String(20))  # viewed / asked / reviewed / exported
    duration = Column(Integer, nullable=True)  # å­¦ä¹ æ—¶é•¿ï¼ˆç§’ï¼‰
    created_at = Column(DateTime, default=datetime.utcnow)
    metadata = Column(Text, nullable=True)  # JSONé¢å¤–æ•°æ®
    
    user = relationship("User", back_populates="learning_records")
```

### 3.4 RAGè®¾è®¡ï¼ˆåŸºäºRAGFlowï¼‰

#### ä¸ºä»€ä¹ˆé€‰æ‹©RAGFlow
| ç‰¹æ€§ | RAGFlow | è‡ªå»ºæ–¹æ¡ˆ |
|------|---------|----------|
| æ–‡æ¡£è§£æ | âœ… å†…ç½®å¤šæ ¼å¼è§£æ | éœ€è‡ªå·±å®ç° |
| æ™ºèƒ½åˆ†å— | âœ… è¯­ä¹‰åˆ†å— | éœ€è°ƒå‚ |
| å¤šç§æ£€ç´¢ | âœ… æ··åˆæ£€ç´¢(å‘é‡+å…³é”®è¯) | éœ€ç»„åˆ |
| çŸ¥è¯†åº“ç®¡ç† | âœ… å®Œæ•´UI | éœ€è‡ªå»º |
| å¤šç§Ÿæˆ· | âœ… åŸç”Ÿæ”¯æŒ | éœ€å®ç° |
| éƒ¨ç½² | âœ… Dockerä¸€é”®éƒ¨ç½² | å¤æ‚ |

#### æ¶æ„é›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AliceLM                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Processor  â”‚â”€â”€â”€â”€â–ºâ”‚  RAGFlow    â”‚â—„â”€â”€â”€â”€â”‚  AI Agent   â”‚       â”‚
â”‚  â”‚  (è½¬å†™æ–‡æœ¬)  â”‚     â”‚  (çŸ¥è¯†åº“)   â”‚     â”‚  (é—®ç­”)     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    RAGFlow Server                           â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚â”‚
â”‚  â”‚  â”‚ Dataset â”‚  â”‚ Chunkingâ”‚  â”‚Embeddingâ”‚  â”‚ Retrievalâ”‚        â”‚â”‚
â”‚  â”‚  â”‚ (ç§Ÿæˆ·)  â”‚  â”‚ (åˆ†å—)  â”‚  â”‚ (å‘é‡åŒ–)â”‚  â”‚ (æ£€ç´¢)   â”‚        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â”‚
â”‚  â”‚                         â”‚                                   â”‚â”‚
â”‚  â”‚                         â–¼                                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚  Elasticsearch + Minio + MySQL (RAGFlowå†…ç½®)            â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### RAGFlowå®¢æˆ·ç«¯å°è£…

```python
# packages/rag/ragflow_client.py

import httpx
from dataclasses import dataclass
from typing import List, Optional

@dataclass
class RAGFlowConfig:
    base_url: str = "http://localhost:9380"
    api_key: str = ""

@dataclass
class SearchResult:
    chunk_id: str
    content: str
    score: float
    metadata: dict
    source_video_id: int

class RAGFlowClient:
    """RAGFlow APIå®¢æˆ·ç«¯"""
    
    def __init__(self, config: RAGFlowConfig):
        self.config = config
        self.client = httpx.AsyncClient(
            base_url=config.base_url,
            headers={"Authorization": f"Bearer {config.api_key}"}
        )
    
    # ========== æ•°æ®é›†(Dataset)ç®¡ç† ==========
    
    async def create_dataset(self, tenant_id: str, name: str) -> str:
        """ä¸ºç§Ÿæˆ·åˆ›å»ºçŸ¥è¯†åº“"""
        resp = await self.client.post("/api/v1/dataset", json={
            "name": f"tenant_{tenant_id}_{name}",
            "description": f"AliceLMçŸ¥è¯†åº“ - ç§Ÿæˆ·{tenant_id}",
            "embedding_model": "BAAI/bge-large-zh-v1.5",
            "chunk_method": "naive",  # æˆ– "qa", "manual"
            "parser_config": {
                "chunk_token_count": 512,
                "layout_recognize": False,  # çº¯æ–‡æœ¬æ— éœ€å¸ƒå±€è¯†åˆ«
            }
        })
        return resp.json()["data"]["id"]
    
    async def get_or_create_dataset(self, tenant_id: str) -> str:
        """è·å–æˆ–åˆ›å»ºç§Ÿæˆ·çŸ¥è¯†åº“"""
        dataset_name = f"tenant_{tenant_id}_videos"
        
        # æŸ¥è¯¢æ˜¯å¦å­˜åœ¨
        resp = await self.client.get("/api/v1/dataset", params={
            "name": dataset_name
        })
        datasets = resp.json().get("data", [])
        
        if datasets:
            return datasets[0]["id"]
        
        return await self.create_dataset(tenant_id, "videos")
    
    # ========== æ–‡æ¡£ç®¡ç† ==========
    
    async def upload_transcript(
        self, 
        tenant_id: str,
        video_id: int,
        title: str,
        transcript: str,
        metadata: dict
    ) -> str:
        """ä¸Šä¼ è§†é¢‘è½¬å†™æ–‡æœ¬åˆ°çŸ¥è¯†åº“"""
        dataset_id = await self.get_or_create_dataset(tenant_id)
        
        # æ„å»ºæ–‡æ¡£å†…å®¹ï¼ˆå¸¦å…ƒæ•°æ®ï¼‰
        document_content = f"""# {title}

## è§†é¢‘ä¿¡æ¯
- è§†é¢‘ID: {video_id}
- ä½œè€…: {metadata.get('author', '')}
- æ—¶é•¿: {metadata.get('duration', 0)}ç§’

## è½¬å†™å†…å®¹
{transcript}
"""
        
        # ä¸Šä¼ æ–‡æ¡£
        resp = await self.client.post(
            f"/api/v1/dataset/{dataset_id}/document",
            files={"file": (f"video_{video_id}.txt", document_content, "text/plain")},
            data={
                "parser_id": "naive",  # ä½¿ç”¨æœ´ç´ åˆ†å—
                "run": "1"  # ç«‹å³è§£æ
            }
        )
        return resp.json()["data"]["id"]
    
    async def delete_document(self, tenant_id: str, video_id: int):
        """åˆ é™¤è§†é¢‘å¯¹åº”çš„æ–‡æ¡£"""
        dataset_id = await self.get_or_create_dataset(tenant_id)
        
        # æŸ¥æ‰¾æ–‡æ¡£
        resp = await self.client.get(
            f"/api/v1/dataset/{dataset_id}/document",
            params={"keywords": f"video_{video_id}"}
        )
        docs = resp.json().get("data", [])
        
        for doc in docs:
            await self.client.delete(
                f"/api/v1/dataset/{dataset_id}/document/{doc['id']}"
            )
    
    # ========== æ£€ç´¢ä¸é—®ç­” ==========
    
    async def search(
        self,
        tenant_id: str,
        query: str,
        top_k: int = 5,
        similarity_threshold: float = 0.2
    ) -> List[SearchResult]:
        """è¯­ä¹‰æ£€ç´¢"""
        dataset_id = await self.get_or_create_dataset(tenant_id)
        
        resp = await self.client.post(
            f"/api/v1/dataset/{dataset_id}/retrieval",
            json={
                "question": query,
                "top_k": top_k,
                "similarity_threshold": similarity_threshold,
                "rerank_model": "BAAI/bge-reranker-v2-m3",  # å¯é€‰é‡æ’
            }
        )
        
        results = []
        for chunk in resp.json().get("data", {}).get("chunks", []):
            # ä»chunkå†…å®¹ä¸­æå–video_id
            video_id = self._extract_video_id(chunk.get("content", ""))
            results.append(SearchResult(
                chunk_id=chunk["id"],
                content=chunk["content"],
                score=chunk["similarity"],
                metadata=chunk.get("metadata", {}),
                source_video_id=video_id
            ))
        
        return results
    
    async def chat(
        self,
        tenant_id: str,
        question: str,
        conversation_id: Optional[str] = None
    ) -> dict:
        """RAGå¯¹è¯ï¼ˆä½¿ç”¨RAGFlowå†…ç½®å¯¹è¯èƒ½åŠ›ï¼‰"""
        dataset_id = await self.get_or_create_dataset(tenant_id)
        
        # åˆ›å»ºæˆ–è·å–å¯¹è¯
        if not conversation_id:
            resp = await self.client.post("/api/v1/conversation", json={
                "dataset_ids": [dataset_id],
                "llm_model": "gpt-4o-mini",  # å¯é…ç½®
                "prompt": self._get_system_prompt()
            })
            conversation_id = resp.json()["data"]["id"]
        
        # å‘é€æ¶ˆæ¯
        resp = await self.client.post(
            f"/api/v1/conversation/{conversation_id}/message",
            json={"content": question}
        )
        
        return {
            "conversation_id": conversation_id,
            "answer": resp.json()["data"]["content"],
            "references": resp.json()["data"].get("references", [])
        }
    
    def _get_system_prompt(self) -> str:
        return """ä½ æ˜¯ä¸€ä¸ªå­¦ä¹ åŠ©æ‰‹ï¼ŒåŸºäºç”¨æˆ·æ”¶è—çš„è§†é¢‘å†…å®¹å›ç­”é—®é¢˜ã€‚
        
è§„åˆ™ï¼š
1. åªåŸºäºæä¾›çš„è§†é¢‘å†…å®¹å›ç­”ï¼Œä¸è¦ç¼–é€ 
2. å¼•ç”¨å…·ä½“è§†é¢‘æ¥æº
3. å¦‚æœå†…å®¹ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·
4. ç”¨ç®€æ´æ¸…æ™°çš„è¯­è¨€å›ç­”"""
    
    def _extract_video_id(self, content: str) -> int:
        """ä»å†…å®¹ä¸­æå–video_id"""
        import re
        match = re.search(r'è§†é¢‘ID:\s*(\d+)', content)
        return int(match.group(1)) if match else 0
```

#### RAGFlowéƒ¨ç½²é…ç½®

```yaml
# docker-compose.ragflow.yml
version: '3.8'

services:
  ragflow:
    image: infiniflow/ragflow:latest
    container_name: ragflow
    ports:
      - "9380:9380"  # API
      - "9443:443"   # Web UI
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_USER=root
      - MYSQL_PASSWORD=ragflow
      - MYSQL_DB=ragflow
      - MINIO_HOST=minio:9000
      - ES_HOST=elasticsearch:9200
    volumes:
      - ./data/ragflow:/ragflow/data
    depends_on:
      - mysql
      - elasticsearch
      - minio

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: ragflow
      MYSQL_DATABASE: ragflow
    volumes:
      - ./data/mysql:/var/lib/mysql

  elasticsearch:
    image: elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    volumes:
      - ./data/es:/usr/share/elasticsearch/data

  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    volumes:
      - ./data/minio:/data
```

#### é…ç½®ç¤ºä¾‹

```yaml
# config/rag.yaml
rag:
  provider: "ragflow"  # ragflow / chroma (fallback)
  
  ragflow:
    base_url: "http://localhost:9380"
    api_key: "${RAGFLOW_API_KEY}"
    
    # åˆ†å—é…ç½®
    chunk_method: "naive"
    chunk_token_count: 512
    
    # Embeddingæ¨¡å‹
    embedding_model: "BAAI/bge-large-zh-v1.5"
    
    # é‡æ’æ¨¡å‹ï¼ˆå¯é€‰ï¼‰
    rerank_model: "BAAI/bge-reranker-v2-m3"
    
    # æ£€ç´¢é…ç½®
    default_top_k: 5
    similarity_threshold: 0.2
  
  # é™çº§æ–¹æ¡ˆ
  fallback:
    provider: "chroma"
    persist_directory: "./data/chroma"
```

### 3.5 æ•°æ®éš”ç¦»ç­–ç•¥

| å±‚çº§ | éš”ç¦»æ–¹å¼ | è¯´æ˜ |
|------|----------|------|
| **å…³ç³»æ•°æ®åº“** | tenant_idå­—æ®µ | æ‰€æœ‰ä¸šåŠ¡è¡¨åŒ…å«tenant_idï¼ŒæŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤ |
| **RAGFlow** | ç‹¬ç«‹Dataset | æ¯ç§Ÿæˆ·ç‹¬ç«‹çŸ¥è¯†åº“ï¼š`tenant_{id}_videos` |
| **æ–‡ä»¶å­˜å‚¨** | ç›®å½•éš”ç¦» | `data/{tenant_id}/videos/`, `data/{tenant_id}/audio/` |
| **ç¼“å­˜** | Keyå‰ç¼€ | Redis keyæ ¼å¼ï¼š`{tenant_id}:{key}` |
| **ä»»åŠ¡é˜Ÿåˆ—** | é˜Ÿåˆ—åˆ†ç»„ | å¯æŒ‰ç§Ÿæˆ·ä¼˜å…ˆçº§è°ƒåº¦ |

```python
# packages/db/tenant_context.py

from contextvars import ContextVar
from sqlalchemy.orm import Query

# å½“å‰ç§Ÿæˆ·ä¸Šä¸‹æ–‡
current_tenant: ContextVar[int] = ContextVar('current_tenant')

class TenantQuery(Query):
    """è‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·è¿‡æ»¤çš„Query"""
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
    
    def _add_tenant_filter(self):
        tenant_id = current_tenant.get(None)
        if tenant_id and hasattr(self._entity_zero().entity, 'tenant_id'):
            return self.filter_by(tenant_id=tenant_id)
        return self

# ä¸­é—´ä»¶è‡ªåŠ¨è®¾ç½®ç§Ÿæˆ·ä¸Šä¸‹æ–‡
async def tenant_middleware(request, call_next):
    tenant_id = get_tenant_from_request(request)  # ä»JWT/headerè·å–
    token = current_tenant.set(tenant_id)
    try:
        response = await call_next(request)
        return response
    finally:
        current_tenant.reset(token)
```

### 3.6 ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Video       â”‚       â”‚      Tag        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚       â”‚ id              â”‚
â”‚ bvid            â”‚       â”‚ name            â”‚
â”‚ title           â”‚       â”‚ category        â”‚
â”‚ status          â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ summary         â”‚                â”‚
â”‚ key_points      â”‚                â”‚
â”‚ ...             â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚    VideoTag     â”‚
         â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ video_id        â”‚
         â”‚                â”‚ tag_id          â”‚
         â”‚                â”‚ confidence      â”‚
         â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”‚  TranscriptChunk    â”‚
         â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚        â”‚ id                  â”‚
         â”‚        â”‚ video_id            â”‚
         â”‚        â”‚ content             â”‚
         â”‚        â”‚ embedding           â”‚
         â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”‚   LearningRecord    â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚ id                  â”‚
                  â”‚ video_id            â”‚
                  â”‚ action              â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 4.1 Watcherï¼ˆç›‘æ§æœåŠ¡ï¼‰

```python
# services/watcher/scanner.py

class FolderScanner:
    """æ”¶è—å¤¹æ‰«æå™¨"""
    
    def __init__(self, db: Session, queue: TaskQueue):
        self.db = db
        self.queue = queue
    
    async def scan_all_folders(self):
        """æ‰«ææ‰€æœ‰ç›‘æ§çš„æ”¶è—å¤¹"""
        folders = self.db.query(WatchedFolder).filter(
            WatchedFolder.is_active == True
        ).all()
        
        for folder in folders:
            await self.scan_folder(folder)
    
    async def scan_folder(self, folder: WatchedFolder):
        """æ‰«æå•ä¸ªæ”¶è—å¤¹ï¼Œæ£€æµ‹æ–°è§†é¢‘"""
        # è·å–æ”¶è—å¤¹è§†é¢‘åˆ—è¡¨
        videos = await fetch_favlist(folder.folder_id)
        
        for video in videos:
            # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            exists = self.db.query(Video).filter(
                Video.bvid == video["bvid"]
            ).first()
            
            if not exists:
                # åˆ›å»ºæ–°è®°å½•
                new_video = Video(
                    bvid=video["bvid"],
                    title=video["title"],
                    author=video["upper"],
                    duration=video["duration"],
                    status=VideoStatus.PENDING,
                    collected_at=datetime.utcnow()
                )
                self.db.add(new_video)
                self.db.commit()
                
                # åŠ å…¥å¤„ç†é˜Ÿåˆ—
                await self.queue.enqueue("process_video", {
                    "video_id": new_video.id,
                    "bvid": new_video.bvid
                })
        
        # æ›´æ–°æ‰«ææ—¶é—´
        folder.last_scan_at = datetime.utcnow()
        self.db.commit()
```

### 4.2 Processorï¼ˆå¤„ç†ç®¡é“ï¼‰

```python
# services/processor/pipeline.py

class VideoPipeline:
    """è§†é¢‘å¤„ç†ç®¡é“"""
    
    def __init__(self, db: Session, ai: AIService, notifier: Notifier):
        self.db = db
        self.ai = ai
        self.notifier = notifier
    
    async def process(self, video_id: int):
        """å¤„ç†è§†é¢‘çš„å®Œæ•´æµç¨‹"""
        video = self.db.query(Video).get(video_id)
        
        try:
            # Step 1: ä¸‹è½½
            video.status = VideoStatus.DOWNLOADING
            self.db.commit()
            video.video_path = await self.download(video.bvid)
            
            # Step 2: æå–éŸ³é¢‘
            video.audio_path = await self.extract_audio(video.video_path)
            
            # Step 3: è½¬å†™
            video.status = VideoStatus.TRANSCRIBING
            self.db.commit()
            transcript = await self.transcribe(video.audio_path)
            video.transcript_path = await self.save_transcript(transcript)
            
            # Step 4: AIåˆ†æ
            video.status = VideoStatus.ANALYZING
            self.db.commit()
            
            analysis = await self.ai.analyze(transcript, video.title)
            video.summary = analysis["summary"]
            video.key_points = json.dumps(analysis["key_points"])
            video.concepts = json.dumps(analysis["concepts"])
            
            # Step 5: å‘é‡åŒ–å­˜å‚¨
            await self.create_embeddings(video, transcript)
            
            # Step 6: è‡ªåŠ¨æ‰“æ ‡ç­¾
            tags = await self.ai.suggest_tags(analysis)
            await self.apply_tags(video, tags)
            
            # å®Œæˆ
            video.status = VideoStatus.DONE
            video.processed_at = datetime.utcnow()
            self.db.commit()
            
            # Step 7: å‘é€é€šçŸ¥
            await self.notifier.notify_complete(video)
            
        except Exception as e:
            video.status = VideoStatus.FAILED
            video.error_message = str(e)
            self.db.commit()
            raise
```

### 4.3 AI Agent

```python
# services/ai/summarizer.py

class Summarizer:
    """AIæ‘˜è¦ç”Ÿæˆ"""
    
    def __init__(self, llm_client):
        self.llm = llm_client
    
    async def analyze(self, transcript: str, title: str) -> dict:
        """åˆ†æè§†é¢‘å†…å®¹"""
        
        prompt = f"""
        ä½ æ˜¯ä¸€ä¸ªå­¦ä¹ åŠ©æ‰‹ï¼Œè¯·åˆ†æä»¥ä¸‹è§†é¢‘å†…å®¹ã€‚
        
        è§†é¢‘æ ‡é¢˜ï¼š{title}
        
        è½¬å†™æ–‡æœ¬ï¼š
        {transcript[:8000]}  # é™åˆ¶é•¿åº¦
        
        è¯·æä¾›ï¼š
        1. æ‘˜è¦ï¼ˆ3å¥è¯ä»¥å†…ï¼Œæ¦‚æ‹¬æ ¸å¿ƒå†…å®¹ï¼‰
        2. æ ¸å¿ƒè§‚ç‚¹ï¼ˆ3-5æ¡ï¼Œæ¯æ¡ä¸€å¥è¯ï¼‰
        3. å…³é”®æ¦‚å¿µï¼ˆæå–3-5ä¸ªå…³é”®è¯/æ¦‚å¿µï¼‰
        4. é‡‘å¥ï¼ˆå¦‚æœæœ‰å€¼å¾—è®°ä½çš„ç²¾å½©è¡¨è¾¾ï¼‰
        
        ä»¥JSONæ ¼å¼è¿”å›ã€‚
        """
        
        response = await self.llm.chat(prompt)
        return json.loads(response)


# services/ai/qa.py

class QAService:
    """é—®ç­”æœåŠ¡"""
    
    def __init__(self, db: Session, llm_client, embedder):
        self.db = db
        self.llm = llm_client
        self.embedder = embedder
    
    async def ask(self, question: str, video_id: int = None) -> str:
        """å›ç­”é—®é¢˜"""
        
        # æ£€ç´¢ç›¸å…³å†…å®¹
        if video_id:
            # é’ˆå¯¹ç‰¹å®šè§†é¢‘
            chunks = await self.get_video_chunks(video_id, question)
        else:
            # è·¨è§†é¢‘æ£€ç´¢
            chunks = await self.semantic_search(question)
        
        context = "\n\n".join([c.content for c in chunks])
        
        prompt = f"""
        åŸºäºä»¥ä¸‹è§†é¢‘å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
        
        ç›¸å…³å†…å®¹ï¼š
        {context}
        
        ç”¨æˆ·é—®é¢˜ï¼š{question}
        
        è¯·åŸºäºå†…å®¹å›ç­”ï¼Œå¦‚æœå†…å®¹ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·è¯´æ˜ã€‚
        """
        
        return await self.llm.chat(prompt)
    
    async def semantic_search(self, query: str, top_k: int = 5):
        """è¯­ä¹‰æ£€ç´¢"""
        query_embedding = await self.embedder.embed(query)
        
        # ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢
        chunks = self.db.query(TranscriptChunk).order_by(
            TranscriptChunk.embedding.cosine_distance(query_embedding)
        ).limit(top_k).all()
        
        return chunks
```

### 4.4 Notifierï¼ˆé€šçŸ¥æœåŠ¡ï¼‰

```python
# services/notifier/wechat.py

class WeChatNotifier:
    """ä¼ä¸šå¾®ä¿¡é€šçŸ¥"""
    
    def __init__(self, webhook_url: str):
        self.webhook_url = webhook_url
    
    async def notify_complete(self, video: Video):
        """è§†é¢‘å¤„ç†å®Œæˆé€šçŸ¥"""
        
        key_points = json.loads(video.key_points)
        points_text = "\n".join([f"â€¢ {p}" for p in key_points[:3]])
        
        # æŸ¥æ‰¾ç›¸å…³è§†é¢‘
        related = await self.find_related(video)
        related_text = ""
        if related:
            related_text = f"\n\nğŸ”— ç›¸å…³è§†é¢‘ï¼š{related[0].title}"
        
        message = f"""ğŸ“º æ–°è§†é¢‘å·²å¤„ç†å®Œæˆ

ã€Œ{video.title}ã€
UPä¸»: {video.author} | {video.duration // 60}åˆ†é’Ÿ

ğŸ“ æ‘˜è¦:
{video.summary}

ğŸ’¡ æ ¸å¿ƒè§‚ç‚¹:
{points_text}
{related_text}

å›å¤æ•°å­—ç»§ç»­:
1-è¯¦ç»†ç¬”è®° 2-æé—® 3-å®Œæ•´æ–‡ç¨¿"""
        
        await self.send(message)
    
    async def send(self, message: str):
        """å‘é€æ¶ˆæ¯"""
        payload = {
            "msgtype": "text",
            "text": {"content": message}
        }
        async with aiohttp.ClientSession() as session:
            await session.post(self.webhook_url, json=payload)
```

### 4.5 ASRé€‚é…å±‚

```python
# services/asr/base.py

from abc import ABC, abstractmethod
from dataclasses import dataclass
from typing import List, Optional

@dataclass
class TranscriptSegment:
    """è½¬å†™ç‰‡æ®µ"""
    start: float      # å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰
    end: float        # ç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰
    text: str         # è½¬å†™æ–‡æœ¬
    confidence: float # ç½®ä¿¡åº¦

@dataclass  
class TranscriptResult:
    """è½¬å†™ç»“æœ"""
    text: str                        # å®Œæ•´æ–‡æœ¬
    segments: List[TranscriptSegment] # åˆ†æ®µä¿¡æ¯
    language: str                    # æ£€æµ‹åˆ°çš„è¯­è¨€
    duration: float                  # éŸ³é¢‘æ—¶é•¿

class ASRProvider(ABC):
    """ASRæä¾›è€…æŠ½è±¡åŸºç±»"""
    
    @property
    @abstractmethod
    def name(self) -> str:
        """æä¾›è€…åç§°"""
        pass
    
    @abstractmethod
    async def transcribe(
        self, 
        audio_path: str,
        language: Optional[str] = None,
        **kwargs
    ) -> TranscriptResult:
        """æ‰§è¡Œè½¬å†™"""
        pass
    
    @abstractmethod
    def is_available(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦å¯ç”¨"""
        pass


# services/asr/whisper_local.py

class WhisperLocalProvider(ASRProvider):
    """æœ¬åœ°Whisperæ¨¡å‹"""
    
    name = "whisper_local"
    
    def __init__(self, model_size: str = "medium"):
        self.model_size = model_size
        self._model = None
    
    def _load_model(self):
        if self._model is None:
            import whisper
            self._model = whisper.load_model(self.model_size)
        return self._model
    
    async def transcribe(self, audio_path: str, language: str = None, **kwargs) -> TranscriptResult:
        model = self._load_model()
        result = model.transcribe(
            audio_path,
            language=language,
            **kwargs
        )
        return TranscriptResult(
            text=result["text"],
            segments=[
                TranscriptSegment(
                    start=s["start"],
                    end=s["end"],
                    text=s["text"],
                    confidence=s.get("confidence", 1.0)
                )
                for s in result["segments"]
            ],
            language=result["language"],
            duration=result["segments"][-1]["end"] if result["segments"] else 0
        )


# services/asr/faster_whisper.py

class FasterWhisperProvider(ASRProvider):
    """Faster-Whisper (CTranslate2ä¼˜åŒ–ç‰ˆ)"""
    
    name = "faster_whisper"
    
    def __init__(self, model_size: str = "medium", device: str = "auto"):
        self.model_size = model_size
        self.device = device
        self._model = None
    
    async def transcribe(self, audio_path: str, language: str = None, **kwargs) -> TranscriptResult:
        from faster_whisper import WhisperModel
        
        if self._model is None:
            self._model = WhisperModel(self.model_size, device=self.device)
        
        segments, info = self._model.transcribe(audio_path, language=language)
        segments_list = list(segments)
        
        return TranscriptResult(
            text=" ".join(s.text for s in segments_list),
            segments=[
                TranscriptSegment(
                    start=s.start, end=s.end, 
                    text=s.text, confidence=s.avg_logprob
                )
                for s in segments_list
            ],
            language=info.language,
            duration=info.duration
        )


# services/asr/__init__.py

class ASRManager:
    """ASRç®¡ç†å™¨ - ç»Ÿä¸€è°ƒåº¦ä¸åŒASRæä¾›è€…"""
    
    providers = {
        "whisper_local": WhisperLocalProvider,
        "faster_whisper": FasterWhisperProvider,
        "xunfei": XunfeiProvider,
        "aliyun": AliyunProvider,
        "openai_whisper": OpenAIWhisperProvider,
    }
    
    def __init__(self, config: dict):
        self.config = config
        self.default_provider = config.get("default_asr", "whisper_local")
        self._instances = {}
    
    def get_provider(self, name: str = None) -> ASRProvider:
        """è·å–ASRæä¾›è€…å®ä¾‹"""
        name = name or self.default_provider
        
        if name not in self._instances:
            provider_class = self.providers.get(name)
            if not provider_class:
                raise ValueError(f"æœªçŸ¥çš„ASRæä¾›è€…: {name}")
            self._instances[name] = provider_class(**self.config.get(name, {}))
        
        return self._instances[name]
    
    async def transcribe(
        self, 
        audio_path: str, 
        provider: str = None,
        **kwargs
    ) -> TranscriptResult:
        """æ‰§è¡Œè½¬å†™"""
        asr = self.get_provider(provider)
        return await asr.transcribe(audio_path, **kwargs)
```

### 4.6 MCP Server

```python
# services/mcp/server.py

from mcp.server import Server
from mcp.types import Tool, Resource

class AliceLMMCPServer:
    """AliceLM MCP Server"""
    
    def __init__(self, db: Session, qa_service: QAService):
        self.db = db
        self.qa = qa_service
        self.server = Server("alice-lm")
        self._register_tools()
        self._register_resources()
    
    def _register_tools(self):
        """æ³¨å†ŒMCPå·¥å…·"""
        
        @self.server.tool()
        async def search_videos(query: str, limit: int = 5) -> list:
            """
            æœç´¢è§†é¢‘çŸ¥è¯†åº“
            
            Args:
                query: æœç´¢å…³é”®è¯æˆ–é—®é¢˜
                limit: è¿”å›ç»“æœæ•°é‡
            
            Returns:
                åŒ¹é…çš„è§†é¢‘åˆ—è¡¨ï¼ŒåŒ…å«æ ‡é¢˜ã€æ‘˜è¦ã€ç›¸å…³åº¦
            """
            results = await self.qa.semantic_search(query, top_k=limit)
            return [
                {
                    "video_id": r.video.id,
                    "bvid": r.video.bvid,
                    "title": r.video.title,
                    "summary": r.video.summary,
                    "relevance": r.score
                }
                for r in results
            ]
        
        @self.server.tool()
        async def get_video_detail(video_id: int = None, bvid: str = None) -> dict:
            """
            è·å–è§†é¢‘è¯¦ç»†ä¿¡æ¯
            
            Args:
                video_id: è§†é¢‘ID
                bvid: Bç«™BVå·
            
            Returns:
                è§†é¢‘è¯¦æƒ…ï¼ŒåŒ…å«æ–‡ç¨¿ã€æ‘˜è¦ã€æ ‡ç­¾ç­‰
            """
            if bvid:
                video = self.db.query(Video).filter(Video.bvid == bvid).first()
            else:
                video = self.db.query(Video).get(video_id)
            
            if not video:
                return {"error": "è§†é¢‘ä¸å­˜åœ¨"}
            
            return {
                "id": video.id,
                "bvid": video.bvid,
                "title": video.title,
                "author": video.author,
                "summary": video.summary,
                "key_points": json.loads(video.key_points or "[]"),
                "transcript": self._load_transcript(video),
                "tags": [t.tag.name for t in video.tags]
            }
        
        @self.server.tool()
        async def ask_knowledge(
            question: str, 
            video_ids: list = None
        ) -> dict:
            """
            åŸºäºçŸ¥è¯†åº“å›ç­”é—®é¢˜
            
            Args:
                question: ç”¨æˆ·é—®é¢˜
                video_ids: é™å®šæœç´¢çš„è§†é¢‘èŒƒå›´ï¼ˆå¯é€‰ï¼‰
            
            Returns:
                AIå›ç­”åŠå¼•ç”¨æ¥æº
            """
            answer = await self.qa.ask(question, video_ids)
            return {
                "answer": answer,
                "sources": [...]  # å¼•ç”¨çš„è§†é¢‘ç‰‡æ®µ
            }
        
        @self.server.tool()
        async def get_related_videos(
            video_id: int = None, 
            concept: str = None,
            limit: int = 5
        ) -> list:
            """
            è·å–ç›¸å…³è§†é¢‘
            
            Args:
                video_id: åŸºäºæŸè§†é¢‘æŸ¥æ‰¾ç›¸å…³
                concept: åŸºäºæŸæ¦‚å¿µæŸ¥æ‰¾ç›¸å…³
                limit: è¿”å›æ•°é‡
            
            Returns:
                ç›¸å…³è§†é¢‘åˆ—è¡¨
            """
            if video_id:
                return await self._find_related_by_video(video_id, limit)
            elif concept:
                return await self._find_related_by_concept(concept, limit)
            return []
    
    def _register_resources(self):
        """æ³¨å†ŒMCPèµ„æº"""
        
        @self.server.resource("videos://list")
        async def list_videos() -> str:
            """è§†é¢‘åˆ—è¡¨èµ„æº"""
            videos = self.db.query(Video).filter(
                Video.status == VideoStatus.DONE
            ).all()
            return json.dumps([
                {"id": v.id, "title": v.title, "bvid": v.bvid}
                for v in videos
            ])
        
        @self.server.resource("videos://{video_id}/transcript")
        async def get_transcript(video_id: int) -> str:
            """è§†é¢‘æ–‡ç¨¿èµ„æº"""
            video = self.db.query(Video).get(video_id)
            if video and video.transcript_path:
                with open(video.transcript_path) as f:
                    return f.read()
            return ""
    
    async def run(self, transport="stdio"):
        """è¿è¡ŒMCPæœåŠ¡"""
        await self.server.run(transport)


# å¯åŠ¨è„šæœ¬: python -m services.mcp
if __name__ == "__main__":
    import asyncio
    server = AliceLMMCPServer(db, qa_service)
    asyncio.run(server.run())
```

#### MCPé…ç½®ç¤ºä¾‹ï¼ˆClaude Desktopï¼‰

```json
// ~/Library/Application Support/Claude/claude_desktop_config.json
{
  "mcpServers": {
    "alice-lm": {
      "command": "python",
      "args": ["-m", "services.mcp"],
      "cwd": "/path/to/AliceLM"
    }
  }
}
```

---

## 5. APIè®¾è®¡

### 5.1 RESTful API

```yaml
# Videos API
GET    /api/videos              # è·å–è§†é¢‘åˆ—è¡¨
GET    /api/videos/:id          # è·å–è§†é¢‘è¯¦æƒ…
POST   /api/videos/upload       # ä¸Šä¼ æœ¬åœ°è§†é¢‘
DELETE /api/videos/:id          # åˆ é™¤è§†é¢‘

# Chat API
POST   /api/chat                # é—®ç­”
  body: { question: string, video_id?: number }
  response: { answer: string, sources: [] }

# Stats API
GET    /api/stats/overview      # å­¦ä¹ æ¦‚è§ˆ
GET    /api/stats/weekly        # å‘¨æŠ¥æ•°æ®
GET    /api/stats/tags          # æ ‡ç­¾åˆ†å¸ƒ

# Folders API
GET    /api/folders             # è·å–ç›‘æ§çš„æ”¶è—å¤¹
POST   /api/folders             # æ·»åŠ æ”¶è—å¤¹
DELETE /api/folders/:id         # ç§»é™¤æ”¶è—å¤¹

# WeChat Webhook
POST   /api/wechat/callback     # æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯
```

### 5.2 WebSocketï¼ˆå®æ—¶æ›´æ–°ï¼‰

```javascript
// å¤„ç†è¿›åº¦å®æ—¶æ¨é€
ws.on("video:progress", { video_id, status, progress })
ws.on("video:complete", { video_id, summary })
ws.on("video:failed", { video_id, error })
```

---

## 6. æŠ€æœ¯é€‰å‹

### 6.1 ç»„ä»¶é€‰å‹

| ç»„ä»¶ | é€‰å‹ | ç†ç”± |
|------|------|------|
| åç«¯æ¡†æ¶ | FastAPI | å¼‚æ­¥æ”¯æŒå¥½ã€ç±»å‹æç¤ºã€è‡ªåŠ¨æ–‡æ¡£ |
| å‰ç«¯æ¡†æ¶ | Next.js 14 | App Routerã€RSCã€è‰¯å¥½DX |
| æ•°æ®åº“ | SQLite | è½»é‡ã€æ— éœ€éƒ¨ç½²ã€å¤Ÿç”¨ |
| å‘é‡æ•°æ®åº“ | ChromaDB / SQLite-VSS | åµŒå…¥å¼ã€æ˜“éƒ¨ç½² |
| ä»»åŠ¡é˜Ÿåˆ— | APScheduler + asyncio | è½»é‡ã€PythonåŸç”Ÿ |
| LLM | OpenAI / Claude API | ä¸»æµã€ç¨³å®š |
| å¾®ä¿¡ | ä¼ä¸šå¾®ä¿¡Webhook | ç¨³å®šã€å®˜æ–¹æ”¯æŒ |
| MCP | mcp-python-sdk | å®˜æ–¹SDKã€ClaudeåŸç”Ÿæ”¯æŒ |

### 6.2 ASRæ¨¡å‹é€‰å‹

| æ¨¡å‹ | é€Ÿåº¦ | è´¨é‡ | æˆæœ¬ | æ¨èåœºæ™¯ |
|------|------|------|------|----------|
| **Whisper (æœ¬åœ°)** | â˜…â˜…â˜† | â˜…â˜…â˜…â˜… | å…è´¹ | é»˜è®¤é€‰é¡¹ã€è´¨é‡ä¼˜å…ˆ |
| **Faster-Whisper** | â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜… | å…è´¹ | æ‰¹é‡å¤„ç†ã€é€Ÿåº¦ä¼˜å…ˆ |
| **è®¯é£ASR** | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜… | ä»˜è´¹ | ä¸­æ–‡ä¼˜åŒ–ã€å®æ—¶åœºæ™¯ |
| **é˜¿é‡ŒParaformer** | â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜† | å…è´¹ | ä¸­æ–‡ã€æœ¬åœ°éƒ¨ç½² |
| **OpenAI Whisper API** | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜…â˜… | ä»˜è´¹ | äº‘ç«¯ã€ä¸æƒ³æœ¬åœ°éƒ¨ç½² |

### 6.3 æ¨èé…ç½®

```yaml
# config/asr.yaml
asr:
  default: "faster_whisper"  # é»˜è®¤ä½¿ç”¨Faster-Whisperå¹³è¡¡é€Ÿåº¦å’Œè´¨é‡
  
  whisper_local:
    model_size: "medium"
    device: "auto"
  
  faster_whisper:
    model_size: "medium"
    device: "auto"
    compute_type: "float16"
  
  xunfei:
    app_id: "${XUNFEI_APP_ID}"
    api_key: "${XUNFEI_API_KEY}"
  
  openai_whisper:
    api_key: "${OPENAI_API_KEY}"
    model: "whisper-1"
  
  # è‡ªåŠ¨åˆ‡æ¢è§„åˆ™
  auto_switch:
    enabled: true
    rules:
      - language: "zh"
        provider: "faster_whisper"  # ä¸­æ–‡ç”¨Faster-Whisper
      - duration_gt: 3600
        provider: "faster_whisper"  # é•¿è§†é¢‘ç”¨Faster-WhisperåŠ é€Ÿ
```

---

## 8. éƒ¨ç½²æ¶æ„

### 8.1 å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨åç«¯
cd apps/api && uvicorn main:app --reload

# å¯åŠ¨å‰ç«¯
cd apps/web && npm run dev

# å¯åŠ¨Worker
python -m services.worker
```

### 8.2 ç”Ÿäº§ç¯å¢ƒ

```yaml
# docker-compose.yml
version: '3.8'
services:
  api:
    build: ./apps/api
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
    environment:
      - DATABASE_URL=sqlite:///data/db.sqlite
      - OPENAI_API_KEY=${OPENAI_API_KEY}
  
  web:
    build: ./apps/web
    ports:
      - "3000:3000"
    depends_on:
      - api
  
  worker:
    build: ./services
    volumes:
      - ./data:/app/data
    depends_on:
      - api
```

---

## 9. å¼€æºä»£ç è¿ç§»ä¸å†…åŒ–è§„èŒƒï¼ˆç»™ AI åŠ©æ‰‹çœ‹çš„ï¼‰

> æœ¬ç« èŠ‚æ˜¯å†™ç»™ IDE é‡Œçš„ AI åŠ©æ‰‹ / å¼€å‘ä»£ç†çš„æ‰§è¡Œè¯´æ˜ï¼Œ  
> ç›®æ ‡æ˜¯**åŠ é€Ÿå¼€å‘**ï¼Œä½†å¯¹å¤–ä¿æŒ Alice çš„æŠ€æœ¯èº«ä»½ä¸å‘½åç©ºé—´ç»Ÿä¸€ã€‚

### 9.1 æ€»åŸåˆ™

1. **åªå€Ÿã€Œå†…åŠŸã€ï¼Œä¸æš´éœ²å“ç‰Œ**
   - å…è®¸ä»ä»¥ä¸‹å¼€æºé¡¹ç›®ä¸­æ‹·è´ / æ”¹å†™ä»£ç é€»è¾‘ï¼š
     - MindSearchï¼ˆå¤š Agent Web æœç´¢èŒƒå¼ï¼‰
     - OpenManusï¼ˆé€šç”¨ Agent æ¡†æ¶ / Flow / ReActï¼‰
     - Gemini CLIï¼ˆå·¥å…·è°ƒç”¨ / MCP å·¥ç¨‹å®è·µï¼‰
   - **ç¦æ­¢**åœ¨ Alice å¯¹å¤– API / æ—¥å¿— / é…ç½®ä¸­å‡ºç°ä¸Šè¿°é¡¹ç›®åã€åŸç±»åã€åŸæ¨¡å—åã€‚
   - å…è®¸åœ¨å†…éƒ¨æ³¨é‡Šé‡Œå†™æ˜æ¥æºå’Œé“¾æ¥ï¼Œå¹¶ä¿ç•™åŸ License è¯´æ˜ã€‚

2. **ç»Ÿä¸€æ”¶çº³åˆ° Alice å‘½åç©ºé—´**
   - æ‰€æœ‰è¿ç§»åçš„ä»£ç å¿…é¡»æ”¾åœ¨ `alice/` ä¸‹çš„æ¨¡å—ä¸­ï¼Œä¾‹å¦‚ï¼š
     - `alice/agent/task_planner.py`
     - `alice/agent/tool_executor.py`
     - `alice/search/search_agent.py`
   - ç¦æ­¢åœ¨è¿è¡Œæ—¶ä»£ç ä¸­ç›´æ¥ `import openmanus` æˆ– `import mindsearch` ç­‰ã€‚

3. **ç¬¬ä¸‰æ–¹ä»“åº“ç»Ÿä¸€æ”¾åœ¨ `third_party/` ç›®å½•**
   - ç»“æ„ç¤ºä¾‹ï¼š
     - `third_party/openmanus/`ï¼ˆå®Œæ•´ cloneï¼‰
     - `third_party/mindsearch/`
     - `third_party/gemini_cli/`
   - è¿™äº›ç›®å½•åªä½œä¸ºã€Œæºç å‚è€ƒ / ä¸´æ—¶ä¾èµ–ã€ï¼Œ**ä¸å…è®¸**ä»ä¸šåŠ¡ä»£ç ç›´æ¥ importï¼›
     åªèƒ½ç”± AI åŠ©æ‰‹åœ¨è¿ç§»æ—¶è¯»å–å’Œ copy ä»£ç ç‰‡æ®µã€‚

4. **è¿ç§»æ–¹å¼ä¼˜å…ˆçº§**
   - èƒ½ç”¨ã€Œ**è¯»ä»£ç  â†’ é‡å†™å®ç°**ã€è§£å†³çš„ï¼Œä¼˜å…ˆé‡å†™ï¼›
   - ä¸ºèŠ‚çœæ—¶é—´ï¼Œå…è®¸ã€Œ**ç›´æ¥æ‹·è´å‡½æ•° / ç±» â†’ é‡å‘½å + åˆ æ”¹**ã€ï¼š
     - æ‹·è´åç¬¬ä¸€æ­¥ï¼šæ”¹æˆ Alice å‘½åï¼›
     - ç¬¬äºŒæ­¥ï¼šå»æ‰ CLI / UI / demo ç‰¹æœ‰é€»è¾‘ï¼›
     - ç¬¬ä¸‰æ­¥ï¼šæŠŠé…ç½® / Provider æ¥å…¥ Alice çš„ Provider æŠ½è±¡å±‚ã€‚

---

### 9.2 MindSearch â†’ SearchAgentService è¿ç§»æŒ‡ä»¤ï¼ˆç»™ AIï¼‰

ç›®æ ‡ï¼šå®ç° `SearchAgentService` + `deep_web_research` Toolï¼Œè®© Alice å…·å¤‡ã€Œå¤šå­ query + å¤šè·¯æœç´¢ + èšåˆå›ç­”ã€çš„èƒ½åŠ›ã€‚

**æ­¥éª¤è¯´æ˜ï¼ˆè¯· IDE / AI åŠ©æ‰‹æ‰§è¡Œï¼‰ï¼š**

1. **å‡†å¤‡å·¥ä½œ**
   - åœ¨ä»“åº“æ ¹ç›®å½•åˆ›å»º `third_party/`ï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰ï¼š
     - `mkdir third_party`
   - Clone MindSearchï¼š
     - `git clone https://github.com/InternLM/MindSearch.git third_party/mindsearch`

2. **å®šä½æ ¸å¿ƒæœç´¢é€»è¾‘**
   - åœ¨ `third_party/mindsearch` é‡Œï¼Œé‡ç‚¹å…³æ³¨ï¼š
     - `mindsearch/agent/` ç›®å½•ä¸‹ä¸ Web Planner / Web Searcherã€æŸ¥è¯¢æ‹†è§£ã€ç½‘é¡µæŠ“å–ä¸æ‘˜è¦ç›¸å…³çš„ Python æ–‡ä»¶ï¼›
   - æœç´¢ä»¥ä¸‹å…³é”®è¯å®šä½æ ¸å¿ƒç±» / å‡½æ•°ï¼š
     - `"WebPlanner"` / `"WebSearcher"`
     - `"searcher_cfg"` / `"searcher_type"`
     - `"backend_example.py"`ï¼ˆä½œä¸ºè°ƒç”¨ç¤ºä¾‹ï¼‰

3. **åœ¨ Alice ä¸­åˆ›å»º SearchAgent æ¨¡å—**
   - æ–°å»ºæ–‡ä»¶ï¼š`alice/search/search_agent.py`
   - åˆ›å»ºç±»ï¼ˆå‘½åç¤ºä¾‹ï¼‰ï¼š
     - `SearchAgentService`
     - `SearchPlan` / `SearchStep`
   - åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ æ³¨é‡Šï¼š
     ```python
     # éƒ¨åˆ†æœç´¢è§„åˆ’ä¸æŠ“å–é€»è¾‘å‚è€ƒäº† MindSearch é¡¹ç›® (Apache-2.0 License)
     # https://github.com/InternLM/MindSearch
     ```

4. **æ‹·è´å¹¶æ”¹é€ é€»è¾‘ï¼ˆé‡ç‚¹ï¼‰**
   - ä» MindSearch çš„ç›¸å…³ Python æ–‡ä»¶ä¸­ï¼š
     - æ‹·è´ã€Œquery æ‹†è§£ã€ã€Œå¤šæ¬¡è°ƒç”¨æœç´¢ APIã€ã€Œå¯¹ç½‘é¡µç»“æœåšæŠ½å–å’Œæ€»ç»“ã€çš„ä»£ç ç‰‡æ®µï¼›
     - **ç¦æ­¢**æ‹·è´ FastAPI app / CLI / å‰ç«¯ç›¸å…³é€»è¾‘ã€‚
   - åŒæ­¥é‡å‘½åï¼š
     - æ‰€æœ‰ç±» / å‡½æ•°æ”¹ä¸º Alice å‘½åï¼šä¾‹å¦‚ `WebPlanner` â†’ `SearchPlanner`ï¼Œ`WebSearcher` â†’ `SearchRunner`
     - åˆ é™¤æˆ–æ›¿æ¢æ‰æ‰€æœ‰ `MindSearch`ã€`mindsearch` å­—æ ·ã€‚
   - ä¿®æ”¹ä¾èµ–ï¼š
     - ä½¿ç”¨ Alice çš„ `Provider` æŠ½è±¡æ¥è·å– LLM / HTTP Clientï¼›
     - æœç´¢å¼•æ“è°ƒç”¨ï¼ˆDuckDuckGo / Bing / Brave ç­‰ï¼‰å°è£…åˆ° `alice/search/web_client.py` ä¸­ã€‚

5. **ä»¥ Tool å½¢å¼å¯¹å¤–æš´éœ²**
   - åœ¨ `alice/agent/tools/search_tools.py` ä¸­æ³¨å†Œä¸€ä¸ª Toolï¼š
     - åç§°ï¼š`deep_web_research`
     - æè¿°ï¼šæ‰§è¡Œå¤šè½® Web æœç´¢å’Œèšåˆï¼Œè¿”å›ç»“æ„åŒ–æœç´¢ç»“æœåˆ—è¡¨å’Œæ€»ç»“ã€‚
   - è¯¥ Tool çš„ handler å†…éƒ¨è°ƒç”¨ï¼š`SearchAgentService.run(query, user_context, max_steps=...)`

6. **å¯¹æ¥ Strategy**
   - åœ¨ `AliceAgentCore` çš„ `ResearchStrategy` ä¸­ï¼š
     - å°† `deep_web_research` åŠ å…¥è¯¥ Strategy çš„ Tool ç™½åå•ï¼›
     - åœ¨ Planner çš„ prompt é‡Œå¢åŠ è¯´æ˜ï¼šã€Œå½“é—®é¢˜éœ€è¦æŸ¥é˜…äº’è”ç½‘æœ€æ–°ä¿¡æ¯æ—¶ï¼Œä¼˜å…ˆè°ƒç”¨ `deep_web_research`ã€ã€‚

---

### 9.3 OpenManus â†’ TaskPlanner / ToolExecutor è¿ç§»æŒ‡ä»¤ï¼ˆç»™ AIï¼‰

ç›®æ ‡ï¼šåˆ©ç”¨ OpenManus çš„ Flow / ReAct Agent æ€è·¯ï¼Œå¼ºåŒ– Alice çš„ Planner + Executor å®ç°ã€‚

1. **å‡†å¤‡å·¥ä½œ**
   - åœ¨ `third_party/` ä¸‹ cloneï¼š
     - `git clone https://github.com/FoundationAgents/OpenManus.git third_party/openmanus`

2. **å®šä½è§„åˆ’ & æ‰§è¡Œæ ¸å¿ƒ**
   - åœ¨ `third_party/openmanus` ä¸­ä¼˜å…ˆå…³æ³¨ï¼š
     - æ ¹ç›®å½•ä¸‹çš„ `main.py`, `run_flow.py`, `run_mcp.py`ï¼›
     - `app/` å’Œ `workspace/` ç›®å½•ä¸­ä¸ Agent è°ƒåº¦ã€Flow / TaskGraph æ‰§è¡Œã€Tool è°ƒç”¨å¾ªç¯ç›¸å…³çš„ä»£ç ã€‚
   - æœç´¢å…³é”®è¯ï¼š`"Flow"` / `"run_flow"` / `"agent"` / `"tool_call"` / `"ReAct"` ç­‰ã€‚

3. **åœ¨ Alice ä¸­åˆ›å»º Planner / Executor æ¨¡å—**
   - æ–°å»º / æ‰©å±•æ–‡ä»¶ï¼š
     - `alice/agent/task_planner.py`
     - `alice/agent/tool_executor.py`
   - æ–‡ä»¶å¤´éƒ¨åŠ å…¥æ³¨é‡Šï¼Œè¯´æ˜å‚è€ƒäº†è¯¥é¡¹ç›®ï¼ˆä¿ç•™é“¾æ¥å’Œ License ç®€è¿°ï¼‰ã€‚

4. **æ‹·è´å¹¶æ”¹å†™ Planner é€»è¾‘**
   - ç›®æ ‡ï¼šå¾—åˆ°ä¸€ä¸ª `TaskPlanner` ç±»ï¼š
     - `plan(task: AgentTask, context: AgentContext, strategy: Strategy) -> AgentPlan`
   - ä» OpenManus ä¸­æ‹·è´ï¼š
     - å°†è‡ªç„¶è¯­è¨€ä»»åŠ¡æ‹†æˆå¤šä¸ª step çš„ prompt æ¨¡æ¿ï¼›
     - Flow / TaskGraph çš„åŸºæœ¬æ•°æ®ç»“æ„ï¼ˆèŠ‚ç‚¹ / è¾¹ / çŠ¶æ€ï¼‰ã€‚
   - æ”¹å†™æ—¶æ³¨æ„ï¼š
     - åˆ é™¤ä¸åŸ UI / Terminal äº¤äº’ç›¸å…³çš„é€»è¾‘ï¼›
     - å°†åŸå…ˆçš„ã€Œä»»åŠ¡æè¿°ã€ç»“æ„ç»Ÿä¸€æ˜ å°„åˆ° Alice çš„ `AgentTask` / `AgentPlan` ç±»å‹ï¼›
     - æ‰€æœ‰ç±»åã€å‡½æ•°åä½¿ç”¨ Alice å‘½åã€‚

5. **æ‹·è´å¹¶æ”¹å†™ Tool æ‰§è¡Œå¾ªç¯**
   - ç›®æ ‡ï¼šå¾—åˆ°ä¸€ä¸ª `ToolExecutor` ç±»ï¼š
     - `execute(plan, task, context, tool_router) -> AgentResult`
   - ä» OpenManus ä¸­æ‹·è´ / æ”¹å†™ï¼š
     - ReAct é£æ ¼çš„ã€Œæ¨¡å‹æ€è€ƒ â†’ è°ƒç”¨å·¥å…· â†’ æ³¨å…¥è§‚å¯Ÿç»“æœ â†’ ç»§ç»­æ€è€ƒã€å¾ªç¯é€»è¾‘ï¼›
     - tool è°ƒç”¨é”™è¯¯å¤„ç†ï¼ˆé‡è¯•ã€å¤±è´¥ä¸­æ–­ï¼‰ï¼›
     - æœ€å¤§æ­¥æ•°æ§åˆ¶ / é€€å‡ºæ¡ä»¶ã€‚
   - æŠŠæ‰€æœ‰å’Œã€ŒOpenManusã€ã€ŒFlow runnerã€ç›¸å…³çš„æ—¥å¿—æ–‡æ¡ˆæ”¹å†™ä¸ºã€ŒAliceAgentCoreã€ã€‚

6. **è¿æ¥ AliceAgentCore**
   - åœ¨ `AliceAgentCore` åˆå§‹åŒ–æ—¶ï¼š
     - ä½¿ç”¨æ–°çš„ `TaskPlanner` / `ToolExecutor` å®ä¾‹ï¼›
     - ç§»é™¤åŸæ¥çš„ä¸´æ—¶ `AgentOrchestrator` åå­—ï¼Œç»Ÿä¸€æ”¹ç”¨ `AliceAgentCore`ã€‚

---

### 9.4 Gemini CLI â†’ ToolRouter / MCPClient è¿ç§»æŒ‡ä»¤ï¼ˆç»™ AIï¼‰

ç›®æ ‡ï¼šå€Ÿç”¨ Gemini CLI çš„å·¥å…·ç®¡ç† / MCP è°ƒç”¨æ¨¡å¼ï¼Œå®Œå–„ Alice çš„ ToolRouter å’Œ MCP é›†æˆã€‚

1. **å‡†å¤‡å·¥ä½œ**
   - åœ¨ `third_party/` ä¸‹ cloneï¼š
     - `git clone https://github.com/google-gemini/gemini-cli.git third_party/gemini_cli`

2. **å®šä½æ ¸å¿ƒå·¥å…· / MCP é€»è¾‘**
   - åœ¨ `third_party/gemini_cli` ä¸­å…³æ³¨ï¼š
     - `packages/core` ç›®å½•ï¼šå·¥å…·å®šä¹‰ä¸æ³¨å†Œã€MCP å®¢æˆ·ç«¯ã€å·¥å…·è°ƒç”¨åˆ†å‘ã€‚
     - æ–‡æ¡£ `docs/` ä¸­å…³äº tools / MCP çš„ç« èŠ‚ã€‚

3. **åœ¨ Alice ä¸­å®ç° ToolRouter**
   - æ–‡ä»¶ï¼š`alice/agent/tool_router.py`
   - å®ç°ç›®æ ‡æ¥å£ï¼š
     - `list_tool_schemas(task: AgentTask) -> List[ToolSchema]`
     - `execute(name: str, args: Dict) -> ToolResult`
   - å‚è€ƒ Gemini CLI çš„è®¾è®¡ï¼š
     - æ¯ä¸ªå·¥å…·æœ‰ï¼šname / description / parameters schemaï¼›
     - MCP å·¥å…·å’Œæœ¬åœ°å·¥å…·åœ¨åŒä¸€å¥—æŠ½è±¡ä¸‹è¢«ç»Ÿä¸€è°ƒç”¨ï¼›
     - å¯¹å±é™©å·¥å…·ï¼ˆshell / æ–‡ä»¶å†™å…¥ï¼‰ä¿ç•™ç™½åå•ä¸é…ç½®é™åˆ¶ã€‚

4. **å®ç° MCP Client**
   - æ–‡ä»¶ï¼š`alice/agent/mcp_client.py`
   - ä» Gemini CLI çš„ MCP å®¢æˆ·ç«¯å®ç°ä¸­æ‹·è´ï¼š
     - JSON-RPC äº¤äº’ç»“æ„ï¼›
     - å·¥å…·åˆ—è¡¨è·å–ï¼›
     - å•æ¬¡å·¥å…·è°ƒç”¨è¯·æ±‚ / å“åº”å¤„ç†ã€‚
   - æ›¿æ¢é¡¹ï¼š
     - å°†æ‰€æœ‰é¡¹ç›®å / æ—¥å¿—ä¸­çš„ "Gemini CLI" æ›¿æ¢ä¸ºå†…éƒ¨åç§°ï¼ˆå¦‚ï¼š`McpClientInternal`ï¼‰ï¼›
     - æŠŠé…ç½®æ¥å…¥ Alice çš„ Provider / Config ç³»ç»Ÿã€‚

5. **åœ¨ DESIGN ä¸­ä¿æŒæŠ½è±¡ï¼Œåœ¨å®ç°ä¸­éšè—æ¥æº**
   - DESIGN æ–‡æ¡£ä¸­åªæï¼š`ToolRouter` / `McpClient`ï¼›ã€Œæ”¯æŒ MCP åè®®çš„å¤–éƒ¨å·¥å…·ã€ã€‚
   - ä¸æ Gemini ç›¸å…³å…·ä½“å®ç°åï¼Œç›¸å…³è¯´æ˜åªå‡ºç°åœ¨ä»£ç æ³¨é‡Šä¸­ã€‚

---

### 9.5 strands-agents/tools â†’ Alice é€šç”¨å·¥å…·è¿ç§»è¯´æ˜ï¼ˆç»™ AI åŠ©æ‰‹ï¼‰

**1. ç›®æ ‡èƒ½åŠ›**

ä» `strands-agents/tools` è¿ç§»ä¸€æ‰¹é€šç”¨å·¥å…·ï¼Œç”¨äº Alice çš„ Tool å±‚ï¼ŒåŒ…æ‹¬ï¼š

- **åŸºç¡€å·¥å…·**ï¼šcalculator, current_time, sleep, environment, journal
- **æ–‡ä»¶ä¸ HTTP**ï¼šfile_read, file_write, http_request
- **Web æœç´¢ä¸æŠ“å–**ï¼štavily_search / tavily_extract / tavily_crawl / tavily_mapã€exa_search / exa_get_contents
- **RSS / cron ç­‰åŸºç¡€è‡ªåŠ¨åŒ–**ï¼šrss, cron
- **ï¼ˆåç»­ï¼‰é«˜æƒé™å·¥å…·**ï¼šshell, python_repl, browser, use_computer ç­‰ï¼ˆé»˜è®¤å…³é—­ï¼‰

è¿™äº›å·¥å…·å°†ä½œä¸º Alice ToolRouter çš„ä¸€ä¸ª"é€šç”¨å·¥å…·åŒ…"ï¼Œä¾›ä¸åŒ Strategy é€‰æ‹©ä½¿ç”¨ã€‚

**2. ä»“åº“ä¸ License**

- ä»“åº“åœ°å€ï¼š`https://github.com/strands-agents/tools`
- Licenseï¼šApache-2.0ï¼Œå…è®¸å•†ç”¨å’Œä¿®æ”¹ï¼Œä¿ç•™ç‰ˆæƒä¸ NOTICEã€‚

**3. å­˜æ”¾ä½ç½®**

- clone ä½ç½®ï¼ˆåªè¯»å‚è€ƒï¼Œä¸ç›´æ¥ importï¼‰ï¼š`third_party/strands_agents_tools/`
- è¿ç§»åçš„å·¥å…·ä»£ç ä½ç½®ï¼š`alice/agent/tools/ext/strands_like/`

**4. é‡ç‚¹æ–‡ä»¶ï¼ˆç»™ AI çš„"çœ‹è¿™é‡Œ"åˆ—è¡¨ï¼‰**

åœ¨ `third_party/strands_agents_tools/src/strands_tools/` ç›®å½•ä¸‹ï¼Œé‡ç‚¹å…³æ³¨ï¼š

- **åŸºç¡€å·¥å…·**ï¼š
  - `calculator.py`
  - `current_time.py`
  - `sleep.py`
  - `environment.py`
  - `journal.py`
- **æ–‡ä»¶ä¸ HTTP**ï¼š
  - `file_read.py`
  - `file_write.py`
  - `http_request.py`
- **Web æœç´¢ / æŠ“å–**ï¼š
  - `tavily.py`ï¼ˆtavily_search / tavily_extract / tavily_crawl / tavily_mapï¼‰
  - `exa.py`ï¼ˆexa_search / exa_get_contentsï¼‰
- **RSS / cron**ï¼š
  - `rss.py`
  - `cron.py`
- **ï¼ˆé«˜é£é™©å·¥å…·ï¼Œå…ˆè¿ä»£ç ã€åæœŸå†æ‰“å¼€ï¼‰**ï¼š
  - `shell.py`
  - `python_repl.py`
  - `browser/__init__.py` / `browser/*.py`
  - `use_computer.py`
  - `code_interpreter.py`
  - `use_aws.py`
  - `slack.py`

**5. åœ¨ Alice ä¸­çš„è½åœ°ä½ç½®ä¸å‘½å**

åœ¨ `alice/agent/tools/ext/strands_like/` ä¸‹åˆ›å»ºå¯¹åº”æ¨¡å—ï¼š

- `basic.py` â†’ åŒ…è£… calculator / current_time / sleep / environment / journal
- `files.py` â†’ åŒ…è£… file_read / file_write
- `http_web.py` â†’ åŒ…è£… http_request / tavily_* / exa_*
- `rss_cron.py` â†’ åŒ…è£… rss / cron
- `unsafe.py` â†’ åŒ…è£… shell / python_repl / browser / use_computer / use_aws / slack ç­‰ï¼ˆé»˜è®¤ä¸åœ¨å·¥å…·ç™½åå•é‡Œï¼‰

æ¯ä¸ªæ¨¡å—å†…å®šä¹‰ **Alice é£æ ¼çš„ Tool ç±»**ï¼Œç»Ÿä¸€å®ç°ï¼š

```python
class AliceTool:
    name: str
    description: str
    parameters: Dict[str, Any]

    async def run(self, args: Dict[str, Any]) -> Any:
        ...
```

ç¦æ­¢åœ¨å¯¹å¤–æ¥å£ä¸­ç›´æ¥ä½¿ç”¨ `strands_tools` åå­—ï¼Œåªèƒ½å‡ºç°åœ¨å†…éƒ¨æ³¨é‡Šä¸­ã€‚

**6. å…·ä½“æ‹·è´ / æ”¹å†™æŒ‡ä»¤ï¼ˆç»™ AI çš„æ“ä½œæ­¥éª¤ï¼‰**

ä»¥ä¸‹æ­¥éª¤å¯¹æ¯ä¸€ä¸ªè¦è¿ç§»çš„å·¥å…·æ¨¡å—æ‰§è¡Œä¸€éï¼š

1. **åˆ›å»ºç›®æ ‡æ–‡ä»¶**
   - ä¾‹å¦‚è¦è¿ç§» `calculator.py`ï¼š
   - åœ¨ `alice/agent/tools/ext/strands_like/basic.py` ä¸­æ·»åŠ å¤´éƒ¨æ³¨é‡Šï¼š
     ```python
     # éƒ¨åˆ†å®ç°å‚è€ƒäº† strands-agents/tools ä¸­çš„ calculator.py (Apache-2.0)
     # https://github.com/strands-agents/tools
     ```

2. **é˜…è¯»å¹¶æ‹·è´æ ¸å¿ƒé€»è¾‘**
   - æ‰“å¼€ï¼š`third_party/strands_agents_tools/src/strands_tools/calculator.py`
   - æ‰¾åˆ°ï¼š
     - ç”¨æ¥å®šä¹‰ calculator å·¥å…·çš„æ ¸å¿ƒå‡½æ•° / ç±»ï¼›
     - è¾“å…¥å‚æ•°è§£æã€è°ƒç”¨ sympy/æ•°å­¦åº“çš„éƒ¨åˆ†ã€‚
   - å°†ç›¸å…³é€»è¾‘æ‹·è´åˆ° `basic.py` ä¸­çš„æ–°ç±»ï¼š
     ```python
     class CalculatorTool(AliceTool):
         name = "calculator"
         description = "Perform mathematical operations and symbolic math."
         parameters = {
             "type": "object",
             "properties": {
                 "expression": {"type": "string", "description": "Math expression to evaluate"},
             },
             "required": ["expression"],
         }

         async def run(self, args: Dict[str, Any]) -> Any:
             expression = args["expression"]
             # è¿™é‡Œç²˜è´´å¹¶æ”¹å†™ strands_tools.calculator çš„æ ¸å¿ƒå®ç°
             ...
     ```
   - åˆ é™¤æˆ–æ”¹å†™ï¼š
     - å’Œ `strands.Agent`ã€`agent.tool.calculator(...)` ç»‘å®šçš„é‚£éƒ¨åˆ†ï¼›
     - ä»»ä½• CLI / ç¤ºä¾‹ä»£ç ã€‚

3. **æ¥å…¥ Alice çš„ Provider / Config**
   - å¦‚æœå·¥å…·éœ€è¦å¤–éƒ¨æœåŠ¡ï¼ˆTavily / Exa / AWS / Slack ç­‰ï¼‰ï¼š
     - ç”¨ Alice çš„ Config / Provider ç³»ç»Ÿè¯»å–ç¯å¢ƒå˜é‡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ strands è‡ªå·±çš„é…ç½®æ–¹å¼ï¼›
     - ä¾‹å¦‚åœ¨ `http_web.py` é‡Œå®šä¹‰ä¸€ä¸ªå†…éƒ¨ client å·¥å‚ï¼Œä» Alice çš„é…ç½®ä¸­è¯»å– API keyã€‚

4. **åœ¨ ToolRouter ä¸­æ³¨å†Œ**
   - æ‰“å¼€ `alice/agent/tool_router.py`ï¼Œå°†æ–°å·¥å…·åŠ å…¥æ³¨å†Œï¼š
     ```python
     from alice.agent.tools.ext.strands_like.basic import CalculatorTool, CurrentTimeTool, SleepTool
     from alice.agent.tools.ext.strands_like.http_web import TavilySearchTool, TavilyExtractTool, ExaSearchTool, HttpRequestTool
     from alice.agent.tools.ext.strands_like.rss_cron import RssTool, CronTool
     ...

     DEFAULT_COMMON_TOOLS = {
         "calculator": CalculatorTool(),
         "current_time": CurrentTimeTool(),
         ...
     }
     ```
   - åœ¨ Strategy å±‚æ§åˆ¶å“ªäº›å·¥å…·å¯è§ï¼š
     - `ChatStrategy`ï¼šcalculator / current_time / file_readï¼ˆåªè¯»ï¼‰
     - `ResearchStrategy`ï¼štavily_* / exa_* / http_request / rss
     - é«˜å±å·¥å…·ï¼ˆshell / python_repl / browser / use_computerï¼‰åªåœ¨ Console / Debug åœºæ™¯å¼€æ”¾ä¸”é»˜è®¤å…³é—­ã€‚

5. **ä¸ºæ¯ç±»å·¥å…·æ·»åŠ æœ€å°æµ‹è¯•**
   - ç»™æ¯ä¸ªæ–‡ä»¶åŠ  1â€“2 ä¸ªç®€å•çš„å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•ï¼Œä¾‹å¦‚ï¼š
     - calculatorï¼š"sqrt(1764)" -> 42ï¼ˆä¸åŸ README ç¤ºä¾‹ä¸€è‡´ï¼‰
     - tavily_searchï¼šè°ƒç”¨ mock clientï¼Œè¿”å›å›ºå®šç»“æœï¼›
     - file_read / file_writeï¼šåœ¨ä¸´æ—¶ç›®å½•åˆ›å»ºæ–‡ä»¶ï¼Œè¯»å†™æˆåŠŸã€‚

**7. å®‰å…¨ä¸æƒé™çº¦æŸï¼ˆéå¸¸é‡è¦ï¼‰**

ä»¥ä¸‹å·¥å…·è§†ä¸º**é«˜å±å·¥å…·**ï¼Œåªåšä»£ç è¿ç§»ï¼Œä¸åŠ å…¥é»˜è®¤ Tool ç™½åå•ï¼š

- `shell`ï¼ˆæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼‰
- `python_repl` / `code_interpreter`
- `browser`ï¼ˆè‡ªåŠ¨æ“ä½œæµè§ˆå™¨ï¼‰
- `use_computer`ï¼ˆæ¡Œé¢æ“ä½œï¼‰
- `use_aws`ï¼ˆäº‘èµ„æºæ“ä½œï¼‰
- `slack`ï¼ˆå¯¹å¤–å‘æ¶ˆæ¯ï¼‰

å¤„ç†æ–¹å¼ï¼š

- åœ¨ `alice/agent/tools/ext/strands_like/unsafe.py` ä¸­å…ˆå®ç°å¯¹åº”çš„ Tool ç±»ï¼›
- ToolRouter é»˜è®¤ä¸æ³¨å†Œå®ƒä»¬åˆ°ä»»ä½• Strategyï¼›
- ä»…åœ¨ Console / å†…éƒ¨æµ‹è¯•åœºæ™¯ã€å¹¶å¸¦æ˜¾å¼ç¡®è®¤ä¸‹æ‰å¯ç”¨ã€‚

**8. ä¸ SearchAgent çš„å…³ç³»**

- `TavilySearchTool` / `TavilyExtractTool` / `ExaSearchTool` å¯ç›´æ¥è¢« `SearchAgentService` å†…éƒ¨è°ƒç”¨ï¼›
- SearchAgentService çš„å¤šæ­¥æœç´¢æµç¨‹ï¼ˆæ¥è‡ª MindSearch èŒƒå¼ï¼‰+ åº•å±‚å·¥å…·å®ç°ï¼ˆæ¥è‡ª strandsï¼‰= Alice çš„å®Œæ•´ Web æœç´¢èƒ½åŠ›ï¼›
- å¯¹å¤–åªæš´éœ² `deep_web_research` Toolï¼Œå†…éƒ¨ç»„åˆä½¿ç”¨è¿™äº›åº•å±‚å·¥å…·ã€‚

**9. åç»­æ‰©å±•**

ç¬¬äºŒé˜¶æ®µå¯ä»¥è€ƒè™‘è¿ç§»ï¼š

- `memory.py` / `mem0_memory.py` / `mongodb_memory.py` / `elasticsearch_memory.py`ï¼Œ
  å°†å…¶é€»è¾‘èåˆåˆ° Alice çš„ MemoryManager / Timeline / Graph ä¸­ï¼Œè€Œä¸æ˜¯å¹³è¡Œç•™ä¸€å¥—ã€‚
- è¿™äº›å¯ä»¥åœ¨ ROADMAP çš„åç»­ Phase ä¸­å®šä¹‰å•ç‹¬ä»»åŠ¡ã€‚

---

### 9.x é€šç”¨å¼€æºè¿ç§»æ¨¡ç‰ˆï¼ˆç»™æœªæ¥çš„è‡ªå·±å’Œ AI åŠ©æ‰‹ï¼‰

> å½“æˆ‘ä»¬å†³å®šä»ä¸€ä¸ªæ–°çš„å¼€æºé¡¹ç›®è¿ç§»æŸäº›èƒ½åŠ›æ—¶ï¼Œ  
> è¯·ä¸ºè¯¥é¡¹ç›®å•ç‹¬æ–°å¢ä¸€èŠ‚ã€Œ9.x.y XXX â†’ Alice æ¨¡å—è¿ç§»è¯´æ˜ã€ï¼Œå¹¶æŒ‰ä»¥ä¸‹æ¨¡ç‰ˆå¡«å†™ã€‚

#### 9.x.y [é¡¹ç›®å] â†’ [Alice å†…éƒ¨æ¨¡å—å] è¿ç§»è¯´æ˜

**1. ç›®æ ‡èƒ½åŠ›**
- æƒ³ä»è¯¥é¡¹ç›®è·å¾—ä»€ä¹ˆèƒ½åŠ›ï¼Ÿ
- åœ¨ Alice é‡Œçš„ç›®æ ‡æ¨¡å—æ˜¯å“ªäº›ï¼Ÿ

**2. ä»“åº“ä¸ License**
- ä»“åº“åœ°å€ï¼š`https://github.com/.../...`
- License ç±»å‹ï¼šMIT / Apache-2.0 / ç­‰
- è¦æ±‚ï¼šå…è®¸å•†ç”¨ä¸ä¿®æ”¹ï¼›è¿ç§»åéœ€åœ¨ä»£ç æ³¨é‡Šä¸­ä¿ç•™æ¥æºä¸ License å£°æ˜ã€‚

**3. å­˜æ”¾ä½ç½®**
- å…‹éš†åˆ°æœ¬ä»“åº“çš„è·¯å¾„ï¼š`third_party/<project_name>/`
- ç¦æ­¢ï¼šåœ¨ä¸šåŠ¡ä»£ç ä¸­ç›´æ¥ `import <project_name>`ã€‚

**4. éœ€è¦é‡ç‚¹å‚è€ƒ / æ‹·è´çš„æ¨¡å—ï¼ˆç»™ AI çš„"çœ‹è¿™é‡Œ"åˆ—è¡¨ï¼‰**
- è¯·åˆ—å‡ºéœ€è¦é‡ç‚¹é˜…è¯»çš„ç›®å½• / æ–‡ä»¶åŠç®€å•è¯´æ˜ã€‚

**5. åœ¨ Alice ä¸­çš„è½åœ°ä½ç½®**
- å¯¹åº”çš„ Alice æ¨¡å—è·¯å¾„åŠæ–°ç±»/å‡½æ•°åã€‚

**6. æ‹·è´ä¸æ”¹å†™è§„åˆ™ï¼ˆç»™ AI åŠ©æ‰‹çš„ç¡¬è§„åˆ™ï¼‰**
- æ‹·è´åç¬¬ä¸€æ­¥ï¼šæ”¹æˆ Alice å‘½åï¼›
- ç¬¬äºŒæ­¥ï¼šå»æ‰ CLI / UI / demo ç‰¹æœ‰é€»è¾‘ï¼›
- ç¬¬ä¸‰æ­¥ï¼šæŠŠé…ç½® / Provider æ¥å…¥ Alice çš„ Provider æŠ½è±¡å±‚ï¼›
- ç¦æ­¢ï¼šå°†åŸé¡¹ç›®å / ç±»åæš´éœ²åˆ°å¯¹å¤– APIã€æ—¥å¿—ã€å‰ç«¯å­—ç¬¦ä¸²ä¸­ã€‚

**7. æµ‹è¯•ä¸éªŒæ”¶**
- ä¸ºè¿ç§»æ¨¡å—æ–°å¢æœ€å°æµ‹è¯•æˆ–éªŒè¯æ­¥éª¤ã€‚
- åœ¨ ROADMAP å¯¹åº” Phase ä¸‹å¢åŠ ä¸€ä¸ªå‹¾é€‰é¡¹ã€‚

---

> **æ€»ç»“ç»™æœªæ¥çš„ AI åŠ©æ‰‹ä¸€å¥è¯ï¼š**  
> å½“ä½ åœ¨å®ç° Alice çš„ SearchAgent / TaskPlanner / ToolExecutor / ToolRouter / é€šç”¨å·¥å…·æ—¶ï¼Œ  
> å…è®¸ä½ ä» `third_party/mindsearch`ã€`third_party/openmanus`ã€`third_party/gemini_cli`ã€`third_party/strands_agents_tools` ä¸­è¯»å–å¹¶æ‹·è´ä»£ç ï¼Œ  
> ä½† copy åå¿…é¡»ï¼š
> - æ”¹ä¸º Alice çš„æ¨¡å— / ç±»åï¼›
> - åˆ æ‰ UI / Demo ç‰¹æœ‰é€»è¾‘ï¼›
> - æ¥å…¥ Alice å·²æœ‰çš„ Provider / Config / Loggingï¼›
> - ä¸åœ¨å¯¹å¤–æ¥å£ä¸­å‡ºç°ç¬¬ä¸‰æ–¹é¡¹ç›®åï¼›
> - é«˜å±å·¥å…·ï¼ˆshell / python_repl / browser / use_computer ç­‰ï¼‰é»˜è®¤ä¸å¯ç”¨ã€‚

---

*æ–‡æ¡£ç‰ˆæœ¬: v0.6*  
*æœ€åæ›´æ–°: 2024-12-04*
