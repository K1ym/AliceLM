# ðŸ—ï¸ AliceLM æŠ€æœ¯è®¾è®¡æ–‡æ¡£

---

## 1. è®¾è®¡åŽŸåˆ™

### 1.1 æ ¸å¿ƒåŽŸåˆ™

| åŽŸåˆ™ | è¯´æ˜Ž | å®žè·µ |
|------|------|------|
| **æ¨¡å—åŒ–** | åŠŸèƒ½è§£è€¦ï¼Œç‹¬ç«‹æ¼”è¿› | æ’ä»¶å¼ASR/LLM/Notifier |
| **å¯æ‰©å±•** | é¢å‘æŽ¥å£ï¼Œæ˜“äºŽæ‰©å±• | ProvideræŠ½è±¡å±‚ |
| **å¤šç§Ÿæˆ·** | æ”¯æŒå¤šç”¨æˆ·éš”ç¦» | Tenant-awareæ•°æ®æ¨¡åž‹ |
| **æ•°æ®åˆ†å±‚** | ç»“æž„åŒ–+å‘é‡åŒ–åˆ†ç¦» | SQL + VectorDB |
| **é…ç½®é©±åŠ¨** | è¡Œä¸ºå¯é…ç½®ï¼Œæ— éœ€æ”¹ä»£ç  | YAML/ENVé…ç½® |

### 1.2 æ‰©å±•æ€§è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Plugin Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Source Plugins â”‚  â”‚   ASR Plugins   â”‚  â”‚   LLM Plugins   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â€¢ Bilibili      â”‚  â”‚ â€¢ Whisper       â”‚  â”‚ â€¢ OpenAI        â”‚ â”‚
â”‚  â”‚ â€¢ YouTube       â”‚  â”‚ â€¢ Faster-Whisperâ”‚  â”‚ â€¢ Claude        â”‚ â”‚
â”‚  â”‚ â€¢ Podcast       â”‚  â”‚ â€¢ è®¯é£ž          â”‚  â”‚ â€¢ Ollama(æœ¬åœ°)  â”‚ â”‚
â”‚  â”‚ â€¢ Local File    â”‚  â”‚ â€¢ é˜¿é‡Œ          â”‚  â”‚ â€¢ DeepSeek      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                   â”‚                   â”‚             â”‚
â”‚           â–¼                   â–¼                   â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Core Engine (Provider Interface)               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚           â”‚                   â”‚                   â”‚             â”‚
â”‚           â–¼                   â–¼                   â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Notify Plugins  â”‚  â”‚  Store Plugins  â”‚  â”‚ Export Plugins  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â€¢ ä¼ä¸šå¾®ä¿¡      â”‚  â”‚ â€¢ SQLite        â”‚  â”‚ â€¢ Markdown      â”‚ â”‚
â”‚  â”‚ â€¢ Telegram      â”‚  â”‚ â€¢ PostgreSQL    â”‚  â”‚ â€¢ Notion        â”‚ â”‚
â”‚  â”‚ â€¢ é‚®ä»¶          â”‚  â”‚ â€¢ MySQL         â”‚  â”‚ â€¢ Obsidian      â”‚ â”‚
â”‚  â”‚ â€¢ Webhook       â”‚  â”‚ â€¢ MongoDB       â”‚  â”‚ â€¢ Anki          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç³»ç»Ÿæž¶æž„

### 2.1 æ•´ä½“æž¶æž„ï¼ˆå¤šç§Ÿæˆ·ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Clients                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ å¾®ä¿¡Bot  â”‚  â”‚  Web UI  â”‚  â”‚   MCP    â”‚  â”‚  CLI     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Gateway + Auth                          â”‚
â”‚                   (FastAPI + JWT/OAuth)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ è®¤è¯/æŽˆæƒ    â€¢ ç§Ÿæˆ·è¯†åˆ«    â€¢ é™æµ    â€¢ æ—¥å¿—                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Service Layer                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Watcher  â”‚ â”‚ Processor â”‚ â”‚ AI Agent  â”‚ â”‚  Notifier â”‚       â”‚
â”‚  â”‚  Service  â”‚ â”‚  Service  â”‚ â”‚  Service  â”‚ â”‚  Service  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
â”‚        â”‚             â”‚             â”‚             â”‚              â”‚
â”‚        â–¼             â–¼             â–¼             â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Provider Layer (Pluggable)                     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  SourceProvider â”‚ ASRProvider â”‚ LLMProvider â”‚ NotifyProviderâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Task Queue Layer                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚           Redis / APScheduler (Per-Tenant Queue)            â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚downloadâ”‚ â”‚  asr   â”‚ â”‚analyze â”‚ â”‚ embed  â”‚ â”‚ notify â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Relational DB (Per-Tenant)                 â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚ users  â”‚ â”‚ videos â”‚ â”‚  tags  â”‚ â”‚configs â”‚ â”‚ logs   â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚          SQLite (å•æœº) / PostgreSQL (ç”Ÿäº§)                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Vector DB (Per-Tenant)                     â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚â”‚
â”‚  â”‚  â”‚  embeddings    â”‚  â”‚   indexes      â”‚                     â”‚â”‚
â”‚  â”‚  â”‚  (chunks)      â”‚  â”‚  (HNSW/IVF)    â”‚                     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚â”‚
â”‚  â”‚          ChromaDB (å•æœº) / Qdrant/Milvus (ç”Ÿäº§)              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  File Storage (Per-Tenant)                  â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚â”‚
â”‚  â”‚  â”‚ videos â”‚ â”‚ audios â”‚ â”‚transcriptsâ”‚                        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚â”‚
â”‚  â”‚          Local (å•æœº) / S3/OSS (ç”Ÿäº§)                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç›®å½•ç»“æž„

```
AliceLM/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/                    # FastAPIåŽç«¯
â”‚   â”‚   â”œâ”€â”€ main.py
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ videos.py
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py
â”‚   â”‚   â”‚   â”œâ”€â”€ wechat.py
â”‚   â”‚   â”‚   â””â”€â”€ stats.py
â”‚   â”‚   â””â”€â”€ dependencies.py
â”‚   â”‚
â”‚   â””â”€â”€ web/                    # Next.jså‰ç«¯
â”‚       â”œâ”€â”€ app/
â”‚       â”‚   â”œâ”€â”€ page.tsx        # Dashboard
â”‚       â”‚   â”œâ”€â”€ library/
â”‚       â”‚   â”œâ”€â”€ graph/
â”‚       â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ components/
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ watcher/                # æ”¶è—å¤¹ç›‘æŽ§æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ scanner.py          # æ‰«æé€»è¾‘
â”‚   â”‚   â””â”€â”€ scheduler.py        # å®šæ—¶è°ƒåº¦
â”‚   â”‚
â”‚   â”œâ”€â”€ processor/              # è§†é¢‘å¤„ç†ç®¡é“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ downloader.py       # ä¸‹è½½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ transcriber.py      # è½¬å†™æ¨¡å—ï¼ˆASRè°ƒåº¦ï¼‰
â”‚   â”‚   â””â”€â”€ pipeline.py         # ç®¡é“ç¼–æŽ’
â”‚   â”‚
â”‚   â”œâ”€â”€ asr/                    # ASRæ¨¡åž‹é€‚é…å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py             # æŠ½è±¡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ whisper_local.py    # æœ¬åœ°Whisper
â”‚   â”‚   â”œâ”€â”€ faster_whisper.py   # Faster-Whisper
â”‚   â”‚   â”œâ”€â”€ xunfei.py           # è®¯é£žASR
â”‚   â”‚   â”œâ”€â”€ aliyun.py           # é˜¿é‡ŒParaformer
â”‚   â”‚   â””â”€â”€ openai_whisper.py   # OpenAI Whisper API
â”‚   â”‚
â”‚   â”œâ”€â”€ ai/                     # AIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ summarizer.py       # æ‘˜è¦ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ tagger.py           # æ ‡ç­¾åˆ†ç±»
â”‚   â”‚   â”œâ”€â”€ qa.py               # é—®ç­”æœåŠ¡
â”‚   â”‚   â””â”€â”€ embedder.py         # å‘é‡åŒ–
â”‚   â”‚
â”‚   â”œâ”€â”€ mcp/                    # MCP Server
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ server.py           # MCPæœåŠ¡ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ tools.py            # MCPå·¥å…·å®šä¹‰
â”‚   â”‚   â””â”€â”€ resources.py        # MCPèµ„æºå®šä¹‰
â”‚   â”‚
â”‚   â””â”€â”€ notifier/               # é€šçŸ¥æœåŠ¡
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ wechat.py           # å¾®ä¿¡æŽ¨é€
â”‚       â””â”€â”€ templates.py        # æ¶ˆæ¯æ¨¡æ¿
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ db/                     # æ•°æ®åº“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ models.py           # SQLAlchemyæ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ crud.py             # CRUDæ“ä½œ
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚
â”‚   â”œâ”€â”€ queue/                  # ä»»åŠ¡é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ tasks.py
â”‚   â”‚   â””â”€â”€ worker.py
â”‚   â”‚
â”‚   â””â”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ settings.py
â”‚       â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ scan_favlist.py         # çŽ°æœ‰æ‰«æè„šæœ¬
â”‚   â””â”€â”€ migrate.py              # æ•°æ®è¿ç§»
â”‚
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•ï¼ˆgitignoreï¼‰
â”‚   â”œâ”€â”€ videos/                 # ä¸‹è½½çš„è§†é¢‘
â”‚   â”œâ”€â”€ audio/                  # æå–çš„éŸ³é¢‘
â”‚   â”œâ”€â”€ transcripts/            # è½¬å†™æ–‡æœ¬
â”‚   â””â”€â”€ db.sqlite               # SQLiteæ•°æ®åº“
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ PRD.md
â”‚   â””â”€â”€ DESIGN.md
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

---

## 3. æ•°æ®æ¨¡åž‹

### 3.1 æ•°æ®åº“æž¶æž„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Relational DB (SQLite/PostgreSQL)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Tenant    â”‚â”€â”€â”¬â”€â”€â–ºâ”‚    User     â”‚      â”‚   Config    â”‚     â”‚
â”‚  â”‚  (ç§Ÿæˆ·è¡¨)   â”‚  â”‚   â”‚  (ç”¨æˆ·è¡¨)   â”‚      â”‚  (é…ç½®è¡¨)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                   â”‚                                             â”‚
â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                   â”œâ”€â”€â–ºâ”‚   Video     â”‚â—„â”€â”€â”€â”€â–ºâ”‚    Tag      â”‚     â”‚
â”‚                   â”‚   â”‚  (è§†é¢‘è¡¨)   â”‚      â”‚  (æ ‡ç­¾è¡¨)   â”‚     â”‚
â”‚                   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                   â”‚          â”‚                                  â”‚
â”‚                   â”‚          â–¼                                  â”‚
â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                   â””â”€â”€â–ºâ”‚WatchedFolderâ”‚      â”‚LearningRecordâ”‚    â”‚
â”‚                       â”‚ (ç›‘æŽ§æ”¶è—å¤¹)â”‚      â”‚ (å­¦ä¹ è®°å½•)  â”‚     â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vector DB (ChromaDB/Qdrant)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Collection: {tenant_id}_video_chunks                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  id | video_id | chunk_idx | content | embedding | metadata â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  Collection: {tenant_id}_concepts                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  id | name | description | embedding | related_videos       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å¤šç§Ÿæˆ·ä¸Žç”¨æˆ·æ¨¡åž‹

```python
# packages/db/models/tenant.py

from sqlalchemy import Column, Integer, String, Boolean, DateTime, Enum, ForeignKey
from sqlalchemy.orm import relationship
from datetime import datetime
import enum

class TenantPlan(enum.Enum):
    FREE = "free"           # å…è´¹ç‰ˆ
    PRO = "pro"             # ä¸“ä¸šç‰ˆ
    TEAM = "team"           # å›¢é˜Ÿç‰ˆ
    ENTERPRISE = "enterprise"  # ä¼ä¸šç‰ˆ

class Tenant(Base):
    """ç§Ÿæˆ·/ç»„ç»‡"""
    __tablename__ = "tenants"
    
    id = Column(Integer, primary_key=True)
    name = Column(String(100))
    slug = Column(String(50), unique=True, index=True)  # å”¯ä¸€æ ‡è¯†ç¬¦
    
    # è®¢é˜…è®¡åˆ’
    plan = Column(Enum(TenantPlan), default=TenantPlan.FREE)
    plan_expires_at = Column(DateTime, nullable=True)
    
    # é…é¢é™åˆ¶
    max_videos = Column(Integer, default=100)         # æœ€å¤§è§†é¢‘æ•°
    max_storage_gb = Column(Integer, default=10)      # æœ€å¤§å­˜å‚¨GB
    max_users = Column(Integer, default=1)            # æœ€å¤§ç”¨æˆ·æ•°
    
    # çŠ¶æ€
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # å…³ç³»
    users = relationship("User", back_populates="tenant")
    videos = relationship("Video", back_populates="tenant")
    configs = relationship("TenantConfig", back_populates="tenant")


class UserRole(enum.Enum):
    OWNER = "owner"         # æ‰€æœ‰è€…
    ADMIN = "admin"         # ç®¡ç†å‘˜
    MEMBER = "member"       # æˆå‘˜
    VIEWER = "viewer"       # åªè¯»

class User(Base):
    """ç”¨æˆ·"""
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)
    
    # åŸºæœ¬ä¿¡æ¯
    email = Column(String(255), unique=True, index=True)
    username = Column(String(50))
    password_hash = Column(String(255), nullable=True)  # å¯é€‰ï¼Œæ”¯æŒOAuth
    
    # ç¬¬ä¸‰æ–¹ç»‘å®š
    wechat_openid = Column(String(100), nullable=True, index=True)
    bilibili_uid = Column(String(50), nullable=True)
    bilibili_sessdata = Column(Text, nullable=True)  # åŠ å¯†å­˜å‚¨
    
    # è§’è‰²ä¸Žæƒé™
    role = Column(Enum(UserRole), default=UserRole.MEMBER)
    
    # çŠ¶æ€
    is_active = Column(Boolean, default=True)
    last_login_at = Column(DateTime, nullable=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # å…³ç³»
    tenant = relationship("Tenant", back_populates="users")
    learning_records = relationship("LearningRecord", back_populates="user")


class TenantConfig(Base):
    """ç§Ÿæˆ·é…ç½®"""
    __tablename__ = "tenant_configs"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)
    
    key = Column(String(100))   # é…ç½®é”®
    value = Column(Text)        # é…ç½®å€¼ (JSON)
    
    # é…ç½®ç±»åž‹
    # asr_provider, asr_config, llm_provider, llm_config,
    # notify_channels, watched_folders, etc.
    
    tenant = relationship("Tenant", back_populates="configs")
    
    __table_args__ = (
        UniqueConstraint('tenant_id', 'key', name='uq_tenant_config'),
    )
```

### 3.3 æ ¸å¿ƒä¸šåŠ¡æ¨¡åž‹ï¼ˆç§Ÿæˆ·éš”ç¦»ï¼‰

```python
# packages/db/models/video.py

class VideoStatus(enum.Enum):
    PENDING = "pending"           # å¾…å¤„ç†
    DOWNLOADING = "downloading"   # ä¸‹è½½ä¸­
    TRANSCRIBING = "transcribing" # è½¬å†™ä¸­
    ANALYZING = "analyzing"       # AIåˆ†æžä¸­
    DONE = "done"                 # å®Œæˆ
    FAILED = "failed"             # å¤±è´¥

class Video(Base):
    __tablename__ = "videos"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)  # ç§Ÿæˆ·éš”ç¦»
    
    # è§†é¢‘ä¿¡æ¯
    bvid = Column(String(20), index=True)
    title = Column(String(500))
    author = Column(String(100))
    duration = Column(Integer)  # ç§’
    cover_url = Column(String(500))
    source_url = Column(String(500))
    source_type = Column(String(20), default="bilibili")  # bilibili/youtube/local
    
    # å¤„ç†çŠ¶æ€
    status = Column(Enum(VideoStatus), default=VideoStatus.PENDING)
    error_message = Column(Text, nullable=True)
    retry_count = Column(Integer, default=0)
    
    # æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºŽç§Ÿæˆ·ç›®å½•ï¼‰
    video_path = Column(String(500), nullable=True)
    audio_path = Column(String(500), nullable=True)
    transcript_path = Column(String(500), nullable=True)
    
    # AIç”Ÿæˆå†…å®¹
    summary = Column(Text, nullable=True)
    key_points = Column(Text, nullable=True)        # JSON
    concepts = Column(Text, nullable=True)          # JSON
    
    # å¤„ç†é…ç½®ï¼ˆè¦†ç›–ç§Ÿæˆ·é»˜è®¤ï¼‰
    asr_provider = Column(String(50), nullable=True)
    llm_provider = Column(String(50), nullable=True)
    
    # æ—¶é—´æˆ³
    collected_at = Column(DateTime)
    processed_at = Column(DateTime, nullable=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, onupdate=datetime.utcnow)
    
    # å…³ç³»
    tenant = relationship("Tenant", back_populates="videos")
    tags = relationship("VideoTag", back_populates="video")
    
    # å¤åˆå”¯ä¸€çº¦æŸï¼šåŒä¸€ç§Ÿæˆ·ä¸‹bvidå”¯ä¸€
    __table_args__ = (
        UniqueConstraint('tenant_id', 'bvid', name='uq_tenant_video'),
        Index('ix_tenant_status', 'tenant_id', 'status'),
    )


class Tag(Base):
    __tablename__ = "tags"
    
    id = Column(Integer, primary_key=True)
    name = Column(String(50), unique=True)
    category = Column(String(50))  # é¢†åŸŸåˆ†ç±»
    
    videos = relationship("VideoTag", back_populates="tag")


class VideoTag(Base):
    __tablename__ = "video_tags"
    
    video_id = Column(Integer, ForeignKey("videos.id"), primary_key=True)
    tag_id = Column(Integer, ForeignKey("tags.id"), primary_key=True)
    confidence = Column(Float, default=1.0)  # AIæ ‡ç­¾ç½®ä¿¡åº¦
    
    video = relationship("Video", back_populates="tags")
    tag = relationship("Tag", back_populates="videos")


class WatchedFolder(Base):
    """ç›‘æŽ§çš„æ”¶è—å¤¹"""
    __tablename__ = "watched_folders"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)  # ç§Ÿæˆ·éš”ç¦»
    
    folder_id = Column(String(50))
    folder_type = Column(String(20))  # favlist / season / subscription
    name = Column(String(200))
    platform = Column(String(20), default="bilibili")  # bilibili / youtube
    
    last_scan_at = Column(DateTime)
    is_active = Column(Boolean, default=True)
    
    __table_args__ = (
        UniqueConstraint('tenant_id', 'folder_id', name='uq_tenant_folder'),
    )


class LearningRecord(Base):
    """å­¦ä¹ è®°å½•"""
    __tablename__ = "learning_records"
    
    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), index=True)
    user_id = Column(Integer, ForeignKey("users.id"), index=True)
    video_id = Column(Integer, ForeignKey("videos.id"))
    
    action = Column(String(20))  # viewed / asked / reviewed / exported
    duration = Column(Integer, nullable=True)  # å­¦ä¹ æ—¶é•¿ï¼ˆç§’ï¼‰
    created_at = Column(DateTime, default=datetime.utcnow)
    metadata = Column(Text, nullable=True)  # JSONé¢å¤–æ•°æ®
    
    user = relationship("User", back_populates="learning_records")
```

### 3.4 RAGè®¾è®¡ï¼ˆåŸºäºŽRAGFlowï¼‰

#### ä¸ºä»€ä¹ˆé€‰æ‹©RAGFlow
| ç‰¹æ€§ | RAGFlow | è‡ªå»ºæ–¹æ¡ˆ |
|------|---------|----------|
| æ–‡æ¡£è§£æž | âœ… å†…ç½®å¤šæ ¼å¼è§£æž | éœ€è‡ªå·±å®žçŽ° |
| æ™ºèƒ½åˆ†å— | âœ… è¯­ä¹‰åˆ†å— | éœ€è°ƒå‚ |
| å¤šç§æ£€ç´¢ | âœ… æ··åˆæ£€ç´¢(å‘é‡+å…³é”®è¯) | éœ€ç»„åˆ |
| çŸ¥è¯†åº“ç®¡ç† | âœ… å®Œæ•´UI | éœ€è‡ªå»º |
| å¤šç§Ÿæˆ· | âœ… åŽŸç”Ÿæ”¯æŒ | éœ€å®žçŽ° |
| éƒ¨ç½² | âœ… Dockerä¸€é”®éƒ¨ç½² | å¤æ‚ |

#### æž¶æž„é›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AliceLM                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Processor  â”‚â”€â”€â”€â”€â–ºâ”‚  RAGFlow    â”‚â—„â”€â”€â”€â”€â”‚  AI Agent   â”‚       â”‚
â”‚  â”‚  (è½¬å†™æ–‡æœ¬)  â”‚     â”‚  (çŸ¥è¯†åº“)   â”‚     â”‚  (é—®ç­”)     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    RAGFlow Server                           â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚â”‚
â”‚  â”‚  â”‚ Dataset â”‚  â”‚ Chunkingâ”‚  â”‚Embeddingâ”‚  â”‚ Retrievalâ”‚        â”‚â”‚
â”‚  â”‚  â”‚ (ç§Ÿæˆ·)  â”‚  â”‚ (åˆ†å—)  â”‚  â”‚ (å‘é‡åŒ–)â”‚  â”‚ (æ£€ç´¢)   â”‚        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â”‚
â”‚  â”‚                         â”‚                                   â”‚â”‚
â”‚  â”‚                         â–¼                                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚  Elasticsearch + Minio + MySQL (RAGFlowå†…ç½®)            â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### RAGFlowå®¢æˆ·ç«¯å°è£…

```python
# packages/rag/ragflow_client.py

import httpx
from dataclasses import dataclass
from typing import List, Optional

@dataclass
class RAGFlowConfig:
    base_url: str = "http://localhost:9380"
    api_key: str = ""

@dataclass
class SearchResult:
    chunk_id: str
    content: str
    score: float
    metadata: dict
    source_video_id: int

class RAGFlowClient:
    """RAGFlow APIå®¢æˆ·ç«¯"""
    
    def __init__(self, config: RAGFlowConfig):
        self.config = config
        self.client = httpx.AsyncClient(
            base_url=config.base_url,
            headers={"Authorization": f"Bearer {config.api_key}"}
        )
    
    # ========== æ•°æ®é›†(Dataset)ç®¡ç† ==========
    
    async def create_dataset(self, tenant_id: str, name: str) -> str:
        """ä¸ºç§Ÿæˆ·åˆ›å»ºçŸ¥è¯†åº“"""
        resp = await self.client.post("/api/v1/dataset", json={
            "name": f"tenant_{tenant_id}_{name}",
            "description": f"AliceLMçŸ¥è¯†åº“ - ç§Ÿæˆ·{tenant_id}",
            "embedding_model": "BAAI/bge-large-zh-v1.5",
            "chunk_method": "naive",  # æˆ– "qa", "manual"
            "parser_config": {
                "chunk_token_count": 512,
                "layout_recognize": False,  # çº¯æ–‡æœ¬æ— éœ€å¸ƒå±€è¯†åˆ«
            }
        })
        return resp.json()["data"]["id"]
    
    async def get_or_create_dataset(self, tenant_id: str) -> str:
        """èŽ·å–æˆ–åˆ›å»ºç§Ÿæˆ·çŸ¥è¯†åº“"""
        dataset_name = f"tenant_{tenant_id}_videos"
        
        # æŸ¥è¯¢æ˜¯å¦å­˜åœ¨
        resp = await self.client.get("/api/v1/dataset", params={
            "name": dataset_name
        })
        datasets = resp.json().get("data", [])
        
        if datasets:
            return datasets[0]["id"]
        
        return await self.create_dataset(tenant_id, "videos")
    
    # ========== æ–‡æ¡£ç®¡ç† ==========
    
    async def upload_transcript(
        self, 
        tenant_id: str,
        video_id: int,
        title: str,
        transcript: str,
        metadata: dict
    ) -> str:
        """ä¸Šä¼ è§†é¢‘è½¬å†™æ–‡æœ¬åˆ°çŸ¥è¯†åº“"""
        dataset_id = await self.get_or_create_dataset(tenant_id)
        
        # æž„å»ºæ–‡æ¡£å†…å®¹ï¼ˆå¸¦å…ƒæ•°æ®ï¼‰
        document_content = f"""# {title}

## è§†é¢‘ä¿¡æ¯
- è§†é¢‘ID: {video_id}
- ä½œè€…: {metadata.get('author', '')}
- æ—¶é•¿: {metadata.get('duration', 0)}ç§’

## è½¬å†™å†…å®¹
{transcript}
"""
        
        # ä¸Šä¼ æ–‡æ¡£
        resp = await self.client.post(
            f"/api/v1/dataset/{dataset_id}/document",
            files={"file": (f"video_{video_id}.txt", document_content, "text/plain")},
            data={
                "parser_id": "naive",  # ä½¿ç”¨æœ´ç´ åˆ†å—
                "run": "1"  # ç«‹å³è§£æž
            }
        )
        return resp.json()["data"]["id"]
    
    async def delete_document(self, tenant_id: str, video_id: int):
        """åˆ é™¤è§†é¢‘å¯¹åº”çš„æ–‡æ¡£"""
        dataset_id = await self.get_or_create_dataset(tenant_id)
        
        # æŸ¥æ‰¾æ–‡æ¡£
        resp = await self.client.get(
            f"/api/v1/dataset/{dataset_id}/document",
            params={"keywords": f"video_{video_id}"}
        )
        docs = resp.json().get("data", [])
        
        for doc in docs:
            await self.client.delete(
                f"/api/v1/dataset/{dataset_id}/document/{doc['id']}"
            )
    
    # ========== æ£€ç´¢ä¸Žé—®ç­” ==========
    
    async def search(
        self,
        tenant_id: str,
        query: str,
        top_k: int = 5,
        similarity_threshold: float = 0.2
    ) -> List[SearchResult]:
        """è¯­ä¹‰æ£€ç´¢"""
        dataset_id = await self.get_or_create_dataset(tenant_id)
        
        resp = await self.client.post(
            f"/api/v1/dataset/{dataset_id}/retrieval",
            json={
                "question": query,
                "top_k": top_k,
                "similarity_threshold": similarity_threshold,
                "rerank_model": "BAAI/bge-reranker-v2-m3",  # å¯é€‰é‡æŽ’
            }
        )
        
        results = []
        for chunk in resp.json().get("data", {}).get("chunks", []):
            # ä»Žchunkå†…å®¹ä¸­æå–video_id
            video_id = self._extract_video_id(chunk.get("content", ""))
            results.append(SearchResult(
                chunk_id=chunk["id"],
                content=chunk["content"],
                score=chunk["similarity"],
                metadata=chunk.get("metadata", {}),
                source_video_id=video_id
            ))
        
        return results
    
    async def chat(
        self,
        tenant_id: str,
        question: str,
        conversation_id: Optional[str] = None
    ) -> dict:
        """RAGå¯¹è¯ï¼ˆä½¿ç”¨RAGFlowå†…ç½®å¯¹è¯èƒ½åŠ›ï¼‰"""
        dataset_id = await self.get_or_create_dataset(tenant_id)
        
        # åˆ›å»ºæˆ–èŽ·å–å¯¹è¯
        if not conversation_id:
            resp = await self.client.post("/api/v1/conversation", json={
                "dataset_ids": [dataset_id],
                "llm_model": "gpt-4o-mini",  # å¯é…ç½®
                "prompt": self._get_system_prompt()
            })
            conversation_id = resp.json()["data"]["id"]
        
        # å‘é€æ¶ˆæ¯
        resp = await self.client.post(
            f"/api/v1/conversation/{conversation_id}/message",
            json={"content": question}
        )
        
        return {
            "conversation_id": conversation_id,
            "answer": resp.json()["data"]["content"],
            "references": resp.json()["data"].get("references", [])
        }
    
    def _get_system_prompt(self) -> str:
        return """ä½ æ˜¯ä¸€ä¸ªå­¦ä¹ åŠ©æ‰‹ï¼ŒåŸºäºŽç”¨æˆ·æ”¶è—çš„è§†é¢‘å†…å®¹å›žç­”é—®é¢˜ã€‚
        
è§„åˆ™ï¼š
1. åªåŸºäºŽæä¾›çš„è§†é¢‘å†…å®¹å›žç­”ï¼Œä¸è¦ç¼–é€ 
2. å¼•ç”¨å…·ä½“è§†é¢‘æ¥æº
3. å¦‚æžœå†…å®¹ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜Žç¡®å‘ŠçŸ¥ç”¨æˆ·
4. ç”¨ç®€æ´æ¸…æ™°çš„è¯­è¨€å›žç­”"""
    
    def _extract_video_id(self, content: str) -> int:
        """ä»Žå†…å®¹ä¸­æå–video_id"""
        import re
        match = re.search(r'è§†é¢‘ID:\s*(\d+)', content)
        return int(match.group(1)) if match else 0
```

#### RAGFlowéƒ¨ç½²é…ç½®

```yaml
# docker-compose.ragflow.yml
version: '3.8'

services:
  ragflow:
    image: infiniflow/ragflow:latest
    container_name: ragflow
    ports:
      - "9380:9380"  # API
      - "9443:443"   # Web UI
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_USER=root
      - MYSQL_PASSWORD=ragflow
      - MYSQL_DB=ragflow
      - MINIO_HOST=minio:9000
      - ES_HOST=elasticsearch:9200
    volumes:
      - ./data/ragflow:/ragflow/data
    depends_on:
      - mysql
      - elasticsearch
      - minio

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: ragflow
      MYSQL_DATABASE: ragflow
    volumes:
      - ./data/mysql:/var/lib/mysql

  elasticsearch:
    image: elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    volumes:
      - ./data/es:/usr/share/elasticsearch/data

  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    volumes:
      - ./data/minio:/data
```

#### é…ç½®ç¤ºä¾‹

```yaml
# config/rag.yaml
rag:
  provider: "ragflow"  # ragflow / chroma (fallback)
  
  ragflow:
    base_url: "http://localhost:9380"
    api_key: "${RAGFLOW_API_KEY}"
    
    # åˆ†å—é…ç½®
    chunk_method: "naive"
    chunk_token_count: 512
    
    # Embeddingæ¨¡åž‹
    embedding_model: "BAAI/bge-large-zh-v1.5"
    
    # é‡æŽ’æ¨¡åž‹ï¼ˆå¯é€‰ï¼‰
    rerank_model: "BAAI/bge-reranker-v2-m3"
    
    # æ£€ç´¢é…ç½®
    default_top_k: 5
    similarity_threshold: 0.2
  
  # é™çº§æ–¹æ¡ˆ
  fallback:
    provider: "chroma"
    persist_directory: "./data/chroma"
```

### 3.5 æ•°æ®éš”ç¦»ç­–ç•¥

| å±‚çº§ | éš”ç¦»æ–¹å¼ | è¯´æ˜Ž |
|------|----------|------|
| **å…³ç³»æ•°æ®åº“** | tenant_idå­—æ®µ | æ‰€æœ‰ä¸šåŠ¡è¡¨åŒ…å«tenant_idï¼ŒæŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤ |
| **RAGFlow** | ç‹¬ç«‹Dataset | æ¯ç§Ÿæˆ·ç‹¬ç«‹çŸ¥è¯†åº“ï¼š`tenant_{id}_videos` |
| **æ–‡ä»¶å­˜å‚¨** | ç›®å½•éš”ç¦» | `data/{tenant_id}/videos/`, `data/{tenant_id}/audio/` |
| **ç¼“å­˜** | Keyå‰ç¼€ | Redis keyæ ¼å¼ï¼š`{tenant_id}:{key}` |
| **ä»»åŠ¡é˜Ÿåˆ—** | é˜Ÿåˆ—åˆ†ç»„ | å¯æŒ‰ç§Ÿæˆ·ä¼˜å…ˆçº§è°ƒåº¦ |

```python
# packages/db/tenant_context.py

from contextvars import ContextVar
from sqlalchemy.orm import Query

# å½“å‰ç§Ÿæˆ·ä¸Šä¸‹æ–‡
current_tenant: ContextVar[int] = ContextVar('current_tenant')

class TenantQuery(Query):
    """è‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·è¿‡æ»¤çš„Query"""
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
    
    def _add_tenant_filter(self):
        tenant_id = current_tenant.get(None)
        if tenant_id and hasattr(self._entity_zero().entity, 'tenant_id'):
            return self.filter_by(tenant_id=tenant_id)
        return self

# ä¸­é—´ä»¶è‡ªåŠ¨è®¾ç½®ç§Ÿæˆ·ä¸Šä¸‹æ–‡
async def tenant_middleware(request, call_next):
    tenant_id = get_tenant_from_request(request)  # ä»ŽJWT/headerèŽ·å–
    token = current_tenant.set(tenant_id)
    try:
        response = await call_next(request)
        return response
    finally:
        current_tenant.reset(token)
```

### 3.6 ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Video       â”‚       â”‚      Tag        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚       â”‚ id              â”‚
â”‚ bvid            â”‚       â”‚ name            â”‚
â”‚ title           â”‚       â”‚ category        â”‚
â”‚ status          â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ summary         â”‚                â”‚
â”‚ key_points      â”‚                â”‚
â”‚ ...             â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚    VideoTag     â”‚
         â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ video_id        â”‚
         â”‚                â”‚ tag_id          â”‚
         â”‚                â”‚ confidence      â”‚
         â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”‚  TranscriptChunk    â”‚
         â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚        â”‚ id                  â”‚
         â”‚        â”‚ video_id            â”‚
         â”‚        â”‚ content             â”‚
         â”‚        â”‚ embedding           â”‚
         â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”‚   LearningRecord    â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚ id                  â”‚
                  â”‚ video_id            â”‚
                  â”‚ action              â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 Watcherï¼ˆç›‘æŽ§æœåŠ¡ï¼‰

```python
# services/watcher/scanner.py

class FolderScanner:
    """æ”¶è—å¤¹æ‰«æå™¨"""
    
    def __init__(self, db: Session, queue: TaskQueue):
        self.db = db
        self.queue = queue
    
    async def scan_all_folders(self):
        """æ‰«ææ‰€æœ‰ç›‘æŽ§çš„æ”¶è—å¤¹"""
        folders = self.db.query(WatchedFolder).filter(
            WatchedFolder.is_active == True
        ).all()
        
        for folder in folders:
            await self.scan_folder(folder)
    
    async def scan_folder(self, folder: WatchedFolder):
        """æ‰«æå•ä¸ªæ”¶è—å¤¹ï¼Œæ£€æµ‹æ–°è§†é¢‘"""
        # èŽ·å–æ”¶è—å¤¹è§†é¢‘åˆ—è¡¨
        videos = await fetch_favlist(folder.folder_id)
        
        for video in videos:
            # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            exists = self.db.query(Video).filter(
                Video.bvid == video["bvid"]
            ).first()
            
            if not exists:
                # åˆ›å»ºæ–°è®°å½•
                new_video = Video(
                    bvid=video["bvid"],
                    title=video["title"],
                    author=video["upper"],
                    duration=video["duration"],
                    status=VideoStatus.PENDING,
                    collected_at=datetime.utcnow()
                )
                self.db.add(new_video)
                self.db.commit()
                
                # åŠ å…¥å¤„ç†é˜Ÿåˆ—
                await self.queue.enqueue("process_video", {
                    "video_id": new_video.id,
                    "bvid": new_video.bvid
                })
        
        # æ›´æ–°æ‰«ææ—¶é—´
        folder.last_scan_at = datetime.utcnow()
        self.db.commit()
```

### 3.2 Processorï¼ˆå¤„ç†ç®¡é“ï¼‰

```python
# services/processor/pipeline.py

class VideoPipeline:
    """è§†é¢‘å¤„ç†ç®¡é“"""
    
    def __init__(self, db: Session, ai: AIService, notifier: Notifier):
        self.db = db
        self.ai = ai
        self.notifier = notifier
    
    async def process(self, video_id: int):
        """å¤„ç†è§†é¢‘çš„å®Œæ•´æµç¨‹"""
        video = self.db.query(Video).get(video_id)
        
        try:
            # Step 1: ä¸‹è½½
            video.status = VideoStatus.DOWNLOADING
            self.db.commit()
            video.video_path = await self.download(video.bvid)
            
            # Step 2: æå–éŸ³é¢‘
            video.audio_path = await self.extract_audio(video.video_path)
            
            # Step 3: è½¬å†™
            video.status = VideoStatus.TRANSCRIBING
            self.db.commit()
            transcript = await self.transcribe(video.audio_path)
            video.transcript_path = await self.save_transcript(transcript)
            
            # Step 4: AIåˆ†æž
            video.status = VideoStatus.ANALYZING
            self.db.commit()
            
            analysis = await self.ai.analyze(transcript, video.title)
            video.summary = analysis["summary"]
            video.key_points = json.dumps(analysis["key_points"])
            video.concepts = json.dumps(analysis["concepts"])
            
            # Step 5: å‘é‡åŒ–å­˜å‚¨
            await self.create_embeddings(video, transcript)
            
            # Step 6: è‡ªåŠ¨æ‰“æ ‡ç­¾
            tags = await self.ai.suggest_tags(analysis)
            await self.apply_tags(video, tags)
            
            # å®Œæˆ
            video.status = VideoStatus.DONE
            video.processed_at = datetime.utcnow()
            self.db.commit()
            
            # Step 7: å‘é€é€šçŸ¥
            await self.notifier.notify_complete(video)
            
        except Exception as e:
            video.status = VideoStatus.FAILED
            video.error_message = str(e)
            self.db.commit()
            raise
```

### 3.3 AI Agent

```python
# services/ai/summarizer.py

class Summarizer:
    """AIæ‘˜è¦ç”Ÿæˆ"""
    
    def __init__(self, llm_client):
        self.llm = llm_client
    
    async def analyze(self, transcript: str, title: str) -> dict:
        """åˆ†æžè§†é¢‘å†…å®¹"""
        
        prompt = f"""
        ä½ æ˜¯ä¸€ä¸ªå­¦ä¹ åŠ©æ‰‹ï¼Œè¯·åˆ†æžä»¥ä¸‹è§†é¢‘å†…å®¹ã€‚
        
        è§†é¢‘æ ‡é¢˜ï¼š{title}
        
        è½¬å†™æ–‡æœ¬ï¼š
        {transcript[:8000]}  # é™åˆ¶é•¿åº¦
        
        è¯·æä¾›ï¼š
        1. æ‘˜è¦ï¼ˆ3å¥è¯ä»¥å†…ï¼Œæ¦‚æ‹¬æ ¸å¿ƒå†…å®¹ï¼‰
        2. æ ¸å¿ƒè§‚ç‚¹ï¼ˆ3-5æ¡ï¼Œæ¯æ¡ä¸€å¥è¯ï¼‰
        3. å…³é”®æ¦‚å¿µï¼ˆæå–3-5ä¸ªå…³é”®è¯/æ¦‚å¿µï¼‰
        4. é‡‘å¥ï¼ˆå¦‚æžœæœ‰å€¼å¾—è®°ä½çš„ç²¾å½©è¡¨è¾¾ï¼‰
        
        ä»¥JSONæ ¼å¼è¿”å›žã€‚
        """
        
        response = await self.llm.chat(prompt)
        return json.loads(response)


# services/ai/qa.py

class QAService:
    """é—®ç­”æœåŠ¡"""
    
    def __init__(self, db: Session, llm_client, embedder):
        self.db = db
        self.llm = llm_client
        self.embedder = embedder
    
    async def ask(self, question: str, video_id: int = None) -> str:
        """å›žç­”é—®é¢˜"""
        
        # æ£€ç´¢ç›¸å…³å†…å®¹
        if video_id:
            # é’ˆå¯¹ç‰¹å®šè§†é¢‘
            chunks = await self.get_video_chunks(video_id, question)
        else:
            # è·¨è§†é¢‘æ£€ç´¢
            chunks = await self.semantic_search(question)
        
        context = "\n\n".join([c.content for c in chunks])
        
        prompt = f"""
        åŸºäºŽä»¥ä¸‹è§†é¢‘å†…å®¹å›žç­”ç”¨æˆ·é—®é¢˜ã€‚
        
        ç›¸å…³å†…å®¹ï¼š
        {context}
        
        ç”¨æˆ·é—®é¢˜ï¼š{question}
        
        è¯·åŸºäºŽå†…å®¹å›žç­”ï¼Œå¦‚æžœå†…å®¹ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·è¯´æ˜Žã€‚
        """
        
        return await self.llm.chat(prompt)
    
    async def semantic_search(self, query: str, top_k: int = 5):
        """è¯­ä¹‰æ£€ç´¢"""
        query_embedding = await self.embedder.embed(query)
        
        # ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢
        chunks = self.db.query(TranscriptChunk).order_by(
            TranscriptChunk.embedding.cosine_distance(query_embedding)
        ).limit(top_k).all()
        
        return chunks
```

### 3.4 Notifierï¼ˆé€šçŸ¥æœåŠ¡ï¼‰

```python
# services/notifier/wechat.py

class WeChatNotifier:
    """ä¼ä¸šå¾®ä¿¡é€šçŸ¥"""
    
    def __init__(self, webhook_url: str):
        self.webhook_url = webhook_url
    
    async def notify_complete(self, video: Video):
        """è§†é¢‘å¤„ç†å®Œæˆé€šçŸ¥"""
        
        key_points = json.loads(video.key_points)
        points_text = "\n".join([f"â€¢ {p}" for p in key_points[:3]])
        
        # æŸ¥æ‰¾ç›¸å…³è§†é¢‘
        related = await self.find_related(video)
        related_text = ""
        if related:
            related_text = f"\n\nðŸ”— ç›¸å…³è§†é¢‘ï¼š{related[0].title}"
        
        message = f"""ðŸ“º æ–°è§†é¢‘å·²å¤„ç†å®Œæˆ

ã€Œ{video.title}ã€
UPä¸»: {video.author} | {video.duration // 60}åˆ†é’Ÿ

ðŸ“ æ‘˜è¦:
{video.summary}

ðŸ’¡ æ ¸å¿ƒè§‚ç‚¹:
{points_text}
{related_text}

å›žå¤æ•°å­—ç»§ç»­:
1-è¯¦ç»†ç¬”è®° 2-æé—® 3-å®Œæ•´æ–‡ç¨¿"""
        
        await self.send(message)
    
    async def send(self, message: str):
        """å‘é€æ¶ˆæ¯"""
        payload = {
            "msgtype": "text",
            "text": {"content": message}
        }
        async with aiohttp.ClientSession() as session:
            await session.post(self.webhook_url, json=payload)
```

### 3.5 ASRé€‚é…å±‚

```python
# services/asr/base.py

from abc import ABC, abstractmethod
from dataclasses import dataclass
from typing import List, Optional

@dataclass
class TranscriptSegment:
    """è½¬å†™ç‰‡æ®µ"""
    start: float      # å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰
    end: float        # ç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰
    text: str         # è½¬å†™æ–‡æœ¬
    confidence: float # ç½®ä¿¡åº¦

@dataclass  
class TranscriptResult:
    """è½¬å†™ç»“æžœ"""
    text: str                        # å®Œæ•´æ–‡æœ¬
    segments: List[TranscriptSegment] # åˆ†æ®µä¿¡æ¯
    language: str                    # æ£€æµ‹åˆ°çš„è¯­è¨€
    duration: float                  # éŸ³é¢‘æ—¶é•¿

class ASRProvider(ABC):
    """ASRæä¾›è€…æŠ½è±¡åŸºç±»"""
    
    @property
    @abstractmethod
    def name(self) -> str:
        """æä¾›è€…åç§°"""
        pass
    
    @abstractmethod
    async def transcribe(
        self, 
        audio_path: str,
        language: Optional[str] = None,
        **kwargs
    ) -> TranscriptResult:
        """æ‰§è¡Œè½¬å†™"""
        pass
    
    @abstractmethod
    def is_available(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦å¯ç”¨"""
        pass


# services/asr/whisper_local.py

class WhisperLocalProvider(ASRProvider):
    """æœ¬åœ°Whisperæ¨¡åž‹"""
    
    name = "whisper_local"
    
    def __init__(self, model_size: str = "medium"):
        self.model_size = model_size
        self._model = None
    
    def _load_model(self):
        if self._model is None:
            import whisper
            self._model = whisper.load_model(self.model_size)
        return self._model
    
    async def transcribe(self, audio_path: str, language: str = None, **kwargs) -> TranscriptResult:
        model = self._load_model()
        result = model.transcribe(
            audio_path,
            language=language,
            **kwargs
        )
        return TranscriptResult(
            text=result["text"],
            segments=[
                TranscriptSegment(
                    start=s["start"],
                    end=s["end"],
                    text=s["text"],
                    confidence=s.get("confidence", 1.0)
                )
                for s in result["segments"]
            ],
            language=result["language"],
            duration=result["segments"][-1]["end"] if result["segments"] else 0
        )


# services/asr/faster_whisper.py

class FasterWhisperProvider(ASRProvider):
    """Faster-Whisper (CTranslate2ä¼˜åŒ–ç‰ˆ)"""
    
    name = "faster_whisper"
    
    def __init__(self, model_size: str = "medium", device: str = "auto"):
        self.model_size = model_size
        self.device = device
        self._model = None
    
    async def transcribe(self, audio_path: str, language: str = None, **kwargs) -> TranscriptResult:
        from faster_whisper import WhisperModel
        
        if self._model is None:
            self._model = WhisperModel(self.model_size, device=self.device)
        
        segments, info = self._model.transcribe(audio_path, language=language)
        segments_list = list(segments)
        
        return TranscriptResult(
            text=" ".join(s.text for s in segments_list),
            segments=[
                TranscriptSegment(
                    start=s.start, end=s.end, 
                    text=s.text, confidence=s.avg_logprob
                )
                for s in segments_list
            ],
            language=info.language,
            duration=info.duration
        )


# services/asr/__init__.py

class ASRManager:
    """ASRç®¡ç†å™¨ - ç»Ÿä¸€è°ƒåº¦ä¸åŒASRæä¾›è€…"""
    
    providers = {
        "whisper_local": WhisperLocalProvider,
        "faster_whisper": FasterWhisperProvider,
        "xunfei": XunfeiProvider,
        "aliyun": AliyunProvider,
        "openai_whisper": OpenAIWhisperProvider,
    }
    
    def __init__(self, config: dict):
        self.config = config
        self.default_provider = config.get("default_asr", "whisper_local")
        self._instances = {}
    
    def get_provider(self, name: str = None) -> ASRProvider:
        """èŽ·å–ASRæä¾›è€…å®žä¾‹"""
        name = name or self.default_provider
        
        if name not in self._instances:
            provider_class = self.providers.get(name)
            if not provider_class:
                raise ValueError(f"æœªçŸ¥çš„ASRæä¾›è€…: {name}")
            self._instances[name] = provider_class(**self.config.get(name, {}))
        
        return self._instances[name]
    
    async def transcribe(
        self, 
        audio_path: str, 
        provider: str = None,
        **kwargs
    ) -> TranscriptResult:
        """æ‰§è¡Œè½¬å†™"""
        asr = self.get_provider(provider)
        return await asr.transcribe(audio_path, **kwargs)
```

### 3.6 MCP Server

```python
# services/mcp/server.py

from mcp.server import Server
from mcp.types import Tool, Resource

class AliceLMMCPServer:
    """AliceLM MCP Server"""
    
    def __init__(self, db: Session, qa_service: QAService):
        self.db = db
        self.qa = qa_service
        self.server = Server("alice-lm")
        self._register_tools()
        self._register_resources()
    
    def _register_tools(self):
        """æ³¨å†ŒMCPå·¥å…·"""
        
        @self.server.tool()
        async def search_videos(query: str, limit: int = 5) -> list:
            """
            æœç´¢è§†é¢‘çŸ¥è¯†åº“
            
            Args:
                query: æœç´¢å…³é”®è¯æˆ–é—®é¢˜
                limit: è¿”å›žç»“æžœæ•°é‡
            
            Returns:
                åŒ¹é…çš„è§†é¢‘åˆ—è¡¨ï¼ŒåŒ…å«æ ‡é¢˜ã€æ‘˜è¦ã€ç›¸å…³åº¦
            """
            results = await self.qa.semantic_search(query, top_k=limit)
            return [
                {
                    "video_id": r.video.id,
                    "bvid": r.video.bvid,
                    "title": r.video.title,
                    "summary": r.video.summary,
                    "relevance": r.score
                }
                for r in results
            ]
        
        @self.server.tool()
        async def get_video_detail(video_id: int = None, bvid: str = None) -> dict:
            """
            èŽ·å–è§†é¢‘è¯¦ç»†ä¿¡æ¯
            
            Args:
                video_id: è§†é¢‘ID
                bvid: Bç«™BVå·
            
            Returns:
                è§†é¢‘è¯¦æƒ…ï¼ŒåŒ…å«æ–‡ç¨¿ã€æ‘˜è¦ã€æ ‡ç­¾ç­‰
            """
            if bvid:
                video = self.db.query(Video).filter(Video.bvid == bvid).first()
            else:
                video = self.db.query(Video).get(video_id)
            
            if not video:
                return {"error": "è§†é¢‘ä¸å­˜åœ¨"}
            
            return {
                "id": video.id,
                "bvid": video.bvid,
                "title": video.title,
                "author": video.author,
                "summary": video.summary,
                "key_points": json.loads(video.key_points or "[]"),
                "transcript": self._load_transcript(video),
                "tags": [t.tag.name for t in video.tags]
            }
        
        @self.server.tool()
        async def ask_knowledge(
            question: str, 
            video_ids: list = None
        ) -> dict:
            """
            åŸºäºŽçŸ¥è¯†åº“å›žç­”é—®é¢˜
            
            Args:
                question: ç”¨æˆ·é—®é¢˜
                video_ids: é™å®šæœç´¢çš„è§†é¢‘èŒƒå›´ï¼ˆå¯é€‰ï¼‰
            
            Returns:
                AIå›žç­”åŠå¼•ç”¨æ¥æº
            """
            answer = await self.qa.ask(question, video_ids)
            return {
                "answer": answer,
                "sources": [...]  # å¼•ç”¨çš„è§†é¢‘ç‰‡æ®µ
            }
        
        @self.server.tool()
        async def get_related_videos(
            video_id: int = None, 
            concept: str = None,
            limit: int = 5
        ) -> list:
            """
            èŽ·å–ç›¸å…³è§†é¢‘
            
            Args:
                video_id: åŸºäºŽæŸè§†é¢‘æŸ¥æ‰¾ç›¸å…³
                concept: åŸºäºŽæŸæ¦‚å¿µæŸ¥æ‰¾ç›¸å…³
                limit: è¿”å›žæ•°é‡
            
            Returns:
                ç›¸å…³è§†é¢‘åˆ—è¡¨
            """
            if video_id:
                return await self._find_related_by_video(video_id, limit)
            elif concept:
                return await self._find_related_by_concept(concept, limit)
            return []
    
    def _register_resources(self):
        """æ³¨å†ŒMCPèµ„æº"""
        
        @self.server.resource("videos://list")
        async def list_videos() -> str:
            """è§†é¢‘åˆ—è¡¨èµ„æº"""
            videos = self.db.query(Video).filter(
                Video.status == VideoStatus.DONE
            ).all()
            return json.dumps([
                {"id": v.id, "title": v.title, "bvid": v.bvid}
                for v in videos
            ])
        
        @self.server.resource("videos://{video_id}/transcript")
        async def get_transcript(video_id: int) -> str:
            """è§†é¢‘æ–‡ç¨¿èµ„æº"""
            video = self.db.query(Video).get(video_id)
            if video and video.transcript_path:
                with open(video.transcript_path) as f:
                    return f.read()
            return ""
    
    async def run(self, transport="stdio"):
        """è¿è¡ŒMCPæœåŠ¡"""
        await self.server.run(transport)


# å¯åŠ¨è„šæœ¬: python -m services.mcp
if __name__ == "__main__":
    import asyncio
    server = AliceLMMCPServer(db, qa_service)
    asyncio.run(server.run())
```

#### MCPé…ç½®ç¤ºä¾‹ï¼ˆClaude Desktopï¼‰

```json
// ~/Library/Application Support/Claude/claude_desktop_config.json
{
  "mcpServers": {
    "alice-lm": {
      "command": "python",
      "args": ["-m", "services.mcp"],
      "cwd": "/path/to/AliceLM"
    }
  }
}
```

---

## 4. APIè®¾è®¡

### 4.1 RESTful API

```yaml
# Videos API
GET    /api/videos              # èŽ·å–è§†é¢‘åˆ—è¡¨
GET    /api/videos/:id          # èŽ·å–è§†é¢‘è¯¦æƒ…
POST   /api/videos/upload       # ä¸Šä¼ æœ¬åœ°è§†é¢‘
DELETE /api/videos/:id          # åˆ é™¤è§†é¢‘

# Chat API
POST   /api/chat                # é—®ç­”
  body: { question: string, video_id?: number }
  response: { answer: string, sources: [] }

# Stats API
GET    /api/stats/overview      # å­¦ä¹ æ¦‚è§ˆ
GET    /api/stats/weekly        # å‘¨æŠ¥æ•°æ®
GET    /api/stats/tags          # æ ‡ç­¾åˆ†å¸ƒ

# Folders API
GET    /api/folders             # èŽ·å–ç›‘æŽ§çš„æ”¶è—å¤¹
POST   /api/folders             # æ·»åŠ æ”¶è—å¤¹
DELETE /api/folders/:id         # ç§»é™¤æ”¶è—å¤¹

# WeChat Webhook
POST   /api/wechat/callback     # æŽ¥æ”¶å¾®ä¿¡æ¶ˆæ¯
```

### 4.2 WebSocketï¼ˆå®žæ—¶æ›´æ–°ï¼‰

```javascript
// å¤„ç†è¿›åº¦å®žæ—¶æŽ¨é€
ws.on("video:progress", { video_id, status, progress })
ws.on("video:complete", { video_id, summary })
ws.on("video:failed", { video_id, error })
```

---

## 5. æŠ€æœ¯é€‰åž‹

| ç»„ä»¶ | é€‰åž‹ | ç†ç”± |
|------|------|------|
| åŽç«¯æ¡†æž¶ | FastAPI | å¼‚æ­¥æ”¯æŒå¥½ã€ç±»åž‹æç¤ºã€è‡ªåŠ¨æ–‡æ¡£ |
| å‰ç«¯æ¡†æž¶ | Next.js 14 | App Routerã€RSCã€è‰¯å¥½DX |
| æ•°æ®åº“ | SQLite | è½»é‡ã€æ— éœ€éƒ¨ç½²ã€å¤Ÿç”¨ |
| å‘é‡æ•°æ®åº“ | ChromaDB / SQLite-VSS | åµŒå…¥å¼ã€æ˜“éƒ¨ç½² |
| ä»»åŠ¡é˜Ÿåˆ— | APScheduler + asyncio | è½»é‡ã€PythonåŽŸç”Ÿ |
| LLM | OpenAI / Claude API | ä¸»æµã€ç¨³å®š |
| å¾®ä¿¡ | ä¼ä¸šå¾®ä¿¡Webhook | ç¨³å®šã€å®˜æ–¹æ”¯æŒ |
| MCP | mcp-python-sdk | å®˜æ–¹SDKã€ClaudeåŽŸç”Ÿæ”¯æŒ |

### 5.1 ASRæ¨¡åž‹é€‰åž‹

| æ¨¡åž‹ | é€Ÿåº¦ | è´¨é‡ | æˆæœ¬ | æŽ¨èåœºæ™¯ |
|------|------|------|------|----------|
| **Whisper (æœ¬åœ°)** | â˜…â˜…â˜† | â˜…â˜…â˜…â˜… | å…è´¹ | é»˜è®¤é€‰é¡¹ã€è´¨é‡ä¼˜å…ˆ |
| **Faster-Whisper** | â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜… | å…è´¹ | æ‰¹é‡å¤„ç†ã€é€Ÿåº¦ä¼˜å…ˆ |
| **è®¯é£žASR** | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜… | ä»˜è´¹ | ä¸­æ–‡ä¼˜åŒ–ã€å®žæ—¶åœºæ™¯ |
| **é˜¿é‡ŒParaformer** | â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜† | å…è´¹ | ä¸­æ–‡ã€æœ¬åœ°éƒ¨ç½² |
| **OpenAI Whisper API** | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜…â˜… | ä»˜è´¹ | äº‘ç«¯ã€ä¸æƒ³æœ¬åœ°éƒ¨ç½² |

### 5.2 æŽ¨èé…ç½®

```yaml
# config/asr.yaml
asr:
  default: "faster_whisper"  # é»˜è®¤ä½¿ç”¨Faster-Whisperå¹³è¡¡é€Ÿåº¦å’Œè´¨é‡
  
  whisper_local:
    model_size: "medium"
    device: "auto"
  
  faster_whisper:
    model_size: "medium"
    device: "auto"
    compute_type: "float16"
  
  xunfei:
    app_id: "${XUNFEI_APP_ID}"
    api_key: "${XUNFEI_API_KEY}"
  
  openai_whisper:
    api_key: "${OPENAI_API_KEY}"
    model: "whisper-1"
  
  # è‡ªåŠ¨åˆ‡æ¢è§„åˆ™
  auto_switch:
    enabled: true
    rules:
      - language: "zh"
        provider: "faster_whisper"  # ä¸­æ–‡ç”¨Faster-Whisper
      - duration_gt: 3600
        provider: "faster_whisper"  # é•¿è§†é¢‘ç”¨Faster-WhisperåŠ é€Ÿ
```

---

## 6. éƒ¨ç½²æž¶æž„

### 6.1 å¼€å‘çŽ¯å¢ƒ

```bash
# å¯åŠ¨åŽç«¯
cd apps/api && uvicorn main:app --reload

# å¯åŠ¨å‰ç«¯
cd apps/web && npm run dev

# å¯åŠ¨Worker
python -m services.worker
```

### 6.2 ç”Ÿäº§çŽ¯å¢ƒ

```yaml
# docker-compose.yml
version: '3.8'
services:
  api:
    build: ./apps/api
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
    environment:
      - DATABASE_URL=sqlite:///data/db.sqlite
      - OPENAI_API_KEY=${OPENAI_API_KEY}
  
  web:
    build: ./apps/web
    ports:
      - "3000:3000"
    depends_on:
      - api
  
  worker:
    build: ./services
    volumes:
      - ./data:/app/data
    depends_on:
      - api
```

---

## 7. å¼€å‘è®¡åˆ’

### Week 1-2: åŸºç¡€è®¾æ–½
- [ ] é¡¹ç›®è„šæ‰‹æž¶æ­å»º
- [ ] æ•°æ®åº“æ¨¡åž‹å®žçŽ°
- [ ] çŽ°æœ‰è„šæœ¬è¿ç§»æ•´åˆ
- [ ] WatcheræœåŠ¡å®žçŽ°
- [ ] åŸºç¡€å¤„ç†ç®¡é“

### Week 3-4: æ ¸å¿ƒåŠŸèƒ½
- [ ] AIæ‘˜è¦æœåŠ¡
- [ ] å¾®ä¿¡é€šçŸ¥é›†æˆ
- [ ] Web UIåŸºç¡€é¡µé¢
- [ ] é—®ç­”åŠŸèƒ½

### Week 5-6: çŸ¥è¯†å¢žå¼º
- [ ] å‘é‡æ£€ç´¢å®žçŽ°
- [ ] è·¨è§†é¢‘å…³è”
- [ ] çŸ¥è¯†å›¾è°±å¯è§†åŒ–
- [ ] å­¦ä¹ ç»Ÿè®¡

---

*æ–‡æ¡£ç‰ˆæœ¬: v0.1*  
*æœ€åŽæ›´æ–°: 2024-12-01*
